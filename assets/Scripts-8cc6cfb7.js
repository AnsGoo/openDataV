import{d as b,v,V as J,J as x,o as g,l as w,w as a,a as y,b as t,g as R,C as $,_ as k,W as P,X as V,S as I,L as U,u as s,N as z,I as B,Y as O,Z as T,E as C,G as L,z as D,A,$ as W,a0 as F,H as S,x as G,c as K,F as Y,f as M,D as Q,h as X,e as Z,y as j,P as q,Q as H,B as ee,U as te,n as ae,T as se}from"./index-70139cdd.js";import{a as E}from"./index-c2b5f845.js";import{N as ne,T as le}from"./Toolbar-2ca0bf9c.js";import{N as oe}from"./li-2617c3fc.js";import{N as ce}from"./Scrollbar-14215757.js";import"./LogoView-911735ce.js";import"./ToolBar-14249bde.js";const re=async i=>E.get({url:`/dataset/script/${i}/`}),ie=async()=>E.get({url:"/dataset/script/"}),de=async(i,e)=>E.put({url:`/dataset/script/${i}/`,data:{...e,id:i}}),ue=async i=>E.post({url:"/dataset/script/",data:i}),_e={class:"buttons"},pe={class:"footer"},ve=b({__name:"Editor",props:{value:{},config:{default:()=>({height:"600px",tabSize:4,indentWithTab:!0,autofocus:!0,disabled:!1})},mode:{default:"use"}},emits:["update:value","change"],setup(i,{emit:e}){const c=i,p=v(!0),o=v(c.value),u=()=>{e("update:value",o.value),e("change",o.value)},r=v(null),d=()=>{const _=r.value.handleRedo;_&&_()},f=()=>{const _=r.value.handleUndo;_&&_()};return J(()=>c.value,()=>{c.value&&(o.value=c.value)}),(_,l)=>{const n=x("x-icon"),m=x("OCodeEditor");return g(),w(m,{ref_key:"cm",ref:r,value:o.value,"onUpdate:value":[l[0]||(l[0]=N=>o.value=N),u]},{"tool-bar":a(()=>[y("div",null,[y("div",_e,[t(n,{class:"item button",name:"back",onClick:f}),t(n,{class:"item button",name:"next",onClick:d})])])]),footer:a(()=>[y("div",pe,[y("div",{class:R(["saved-status",p.value?"save":"unsave"])},$(p.value?"已保存":"未保存"),3)])]),_:1},8,["value"])}}});const fe=k(ve,[["__scopeId","data-v-95b5addf"]]),me={class:"static-data"},ye=b({__name:"Conetent",setup(i){const e=P({id:"",title:"",code:""}),c=v(JSON.stringify({},null,"	")),p=l=>{c.value=l},o=async l=>{e.code=l};V(I.SRCIPT_KEY,async l=>{await d(l)});const u=v(""),r=()=>{const l=e.code?F("Javascript",e.code,["resp","options"]):void 0;if(l&&l.handler)try{u.value=JSON.stringify(l.handler(JSON.parse(c.value),{}),null,"	")}catch(n){u.value=n.message||n}else u.value=JSON.stringify(c.value,null,"	")},d=async l=>{try{const n=await re(l);if(n.status===200){const m=n.data;e.id=m.id,e.title=m.name,e.code=m.code}}catch(n){U.log(n||n.message)}},f=async()=>{try{const l=await ue({code:e.code,name:e.title||"未命名"});if(l.status===201){const n=l.data;e.id=n.id,e.title=n.name,e.code=n.code,S.info("数据保存成功")}else S.warning("数据保存失败")}catch{S.warning("数据保存失败")}},_=async()=>{if(e.id)try{(await de(e.id,{code:e.code,name:e.title||"未命名"})).status===200?S.info("数据更新成功"):S.warning("数据更新失败")}catch{S.warning("数据更新失败")}};return(l,n)=>{const m=x("x-icon"),N=x("OCodeEditor");return g(),w(s(L),null,{default:a(()=>[y("div",me,[t(s(z),{value:e.title,"onUpdate:value":n[0]||(n[0]=h=>e.title=h),class:"title"},{prefix:a(()=>[t(m,{name:"code"})]),_:1},8,["value"]),t(s(B),null,{default:a(()=>[t(s(O),{class:"save"},{default:a(()=>[t(s(T),{type:"success",onClick:r},{default:a(()=>[C("运行")]),_:1})]),_:1})]),_:1}),t(s(B),null,{default:a(()=>[t(s(O),{class:"save"},{default:a(()=>[t(s(T),{onClick:n[1]||(n[1]=h=>e.id?_():f())},{default:a(()=>[C("保存")]),_:1})]),_:1})]),_:1})]),t(s(L),null,{default:a(()=>[t(s(D),null,{default:a(()=>[t(s(A),{name:"脚本"},{default:a(()=>[t(fe,{value:e.code,class:"content","onUpdate:value":o},null,8,["value"])]),_:1}),t(s(A),{name:"入参"},{default:a(()=>[t(N,{value:c.value,"onUpdate:value":[n[2]||(n[2]=h=>c.value=h),p]},null,8,["value"])]),_:1})]),_:1}),t(s(W),{"title-placement":"left"},{default:a(()=>[C(" 输出 ")]),_:1}),t(N,{value:u.value,"onUpdate:value":[n[3]||(n[3]=h=>u.value=h),o],class:"content",disable:!0},null,8,["value"])]),_:1})]),_:1})}}});const ge=k(ye,[["__scopeId","data-v-5fb5eb91"]]),he={class:"rest-detail"},Se=b({__name:"History",setup(i){const e=v([]),c=async()=>{try{const o=await ie();o.status===200&&(e.value=o.data)}catch(o){U.log(o||o.message)}},p=o=>{X.emit(I.SRCIPT_KEY,o)};return G(async()=>{await c()}),(o,u)=>(g(),w(s(L),{title:"脚本",size:"small"},{default:a(()=>[t(s(z),{placeholder:"请输入搜索条件"}),t(s(D),null,{default:a(()=>[t(s(A),{name:"脚本列表"},{default:a(()=>[t(s(ne),{"align-text":""},{default:a(()=>[(g(!0),K(Y,null,M(e.value,r=>(g(),w(s(oe),{key:r.id,class:"data-item",onClick:d=>p(r.id)},{default:a(()=>[y("div",he,[y("div",null,[t(s(Q),{type:"success",style:{"font-weight":"800"}},{default:a(()=>[C($("JS"))]),_:1}),C(" "+$(r.name),1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}});const we=k(Se,[["__scopeId","data-v-9237a8cd"]]),Ce=b({__name:"Scripts",setup(i){const e=v(!1),c=v(0),p=v(0),o=Z(()=>({width:c.value+"px",height:p.value+"px"})),u=r=>{const{width:d,height:f}=r.contentRect;c.value=d,p.value=f};return(r,d)=>{const f=j("resize");return g(),w(s(H),{class:"home"},{default:a(()=>[t(s(q),{class:"header"},{default:a(()=>[t(s(le))]),_:1}),t(s(H),{"has-sider":"","sider-placement":"right",class:"main"},{default:a(()=>[ee((g(),w(s(te),{class:"content"},{default:a(()=>[t(s(ce),{"x-scrollable":"",style:ae(o.value)},{default:a(()=>[t(ge)]),_:1},8,["style"])]),_:1})),[[f,u]]),t(s(se),{class:"right",width:"240",collapsed:e.value,"native-scrollbar":!1,bordered:"","collapsed-width":35,"collapse-mode":"width","show-trigger":"arrow-circle",onCollapse:d[0]||(d[0]=_=>e.value=!0),onExpand:d[1]||(d[1]=_=>e.value=!1)},{default:a(()=>[t(we)]),_:1},8,["collapsed"])]),_:1})]),_:1})}}});const Ae=k(Ce,[["__scopeId","data-v-4249a075"]]);export{Ae as default};
