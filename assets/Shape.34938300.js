var zt=Object.defineProperty;var lt=Object.getOwnPropertySymbols;var Mt=Object.prototype.hasOwnProperty,Bt=Object.prototype.propertyIsEnumerable;var ut=(o,t,e)=>t in o?zt(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,O=(o,t)=>{for(var e in t||(t={}))Mt.call(t,e)&&ut(o,e,t[e]);if(lt)for(var e of lt(t))Bt.call(t,e)&&ut(o,e,t[e]);return o};import{d as Rt,a6 as It,k as j,r as W,B as J,a7 as Pt,e as At,w as Yt,U as Xt,a5 as Ft,u as C,O as pt,X as dt,Y as E,Z as G,v as w,c as ft,G as a,a2 as S,A as mt,a3 as K}from"./@vue.a2815691.js";import{u as U,d as yt,e as Tt,h as Wt,i as Nt,j as $,s as Ct,m as Ht,r as v,_ as Ot,k as ht,l as xt,n as Gt}from"./index.2ad55fca.js";import{d as vt}from"./pinia.6e1173f7.js";import{c as Z}from"./lodash-es.5f1bdab1.js";const g=U(),$t=vt({id:"compose",state:()=>({style:{top:0,left:0,width:0,height:0,rotate:0},components:[]}),getters:{canCompose(){return this.components.length>1},canDecompose(){return!(g.curComponent&&!g.curComponent.isLock&&g.curComponent.component==="Group")}},actions:{isActived(o){return this.components.findIndex(t=>t.id===o.id)!==-1},setAreaData(o,t){this.style=o||{},this.components=t||[]},appendComponent(o){this.components.findIndex(t=>t.id===o.id)===-1&&(this.components.push(o),this.components.length>1&&(this.style=O(O({},this.style),yt(this.components))))},compose(){this.style.width===0&&(this.style=O(O({},this.style),yt(this.components)));const o={component:"Group",id:Tt(),display:!0,icon:"",style:this.style,subComponents:Z(this.components),label:""};Wt(o),this.batchDeleteComponent(this.components),g.appendComponent(o);const t=g.componentData.length-1;g.setCurComponent(g.componentData[t],t.toString()),this.components=[]},batchDeleteComponent(o){o.forEach(t=>{for(let e=0,s=g.componentData.length;e<s;e++)if(t.id===g.componentData[e].id){g.componentData.splice(e,1);break}})},decompose(){var e;const o=g.curComponent.style,t=((e=g.curComponent)==null?void 0:e.subComponents)||[];if(t.length>0){const s=g.getComponentIndexById(g.curComponent.id);g.removeComponent(s.toString()),t.forEach(c=>{Nt(c,o),g.appendComponent(c)})}},flushRight(){const{right:o,items:t}=$(this.components);t.forEach(e=>{const s=o-e.right;e.component.style.left=e.component.style.left+s}),g.saveComponentData()},flushLeft(){const{left:o,items:t}=$(this.components);t.forEach(e=>{const s=e.left-o;e.component.style.left=e.component.style.left-s}),g.saveComponentData()},flushTop(){const{top:o,items:t}=$(this.components);t.forEach(e=>{const s=e.top-o;e.component.style.top=e.component.style.top-s}),g.saveComponentData()},flushBottom(){const{bottom:o,items:t}=$(this.components);t.forEach(e=>{const s=o-e.bottom;e.component.style.top=e.component.style.top+s}),g.saveComponentData()},flushRow(){const{top:o,bottom:t,items:e}=$(this.components);e.forEach(s=>{const c=(t+o)/2-s.center.y;s.component.style.top=s.component.style.top+c}),g.saveComponentData()},flushColumn(){const{left:o,right:t,items:e}=$(this.components);e.forEach(s=>{const c=(o+t)/2-s.center.x;s.component.style.left=s.component.style.left+c}),g.saveComponentData()}}}),qt=()=>$t(Ct),Ut=vt({id:"copy",state:()=>({copyData:void 0,isCut:!1}),actions:{copy(){const t=U().curComponent;!t||(this.copyData=Z(t))},paste(o,t,e){if(!this.copyData){Ht.info("\u8BF7\u9009\u62E9\u7EC4\u4EF6");return}const s=U();o?(this.copyData.style.top=e,this.copyData.style.left=t):(this.copyData.style.top=this.copyData.style.top+10,this.copyData.style.left=this.copyData.style.left+10),s.appendComponent(Z(this.copyData))}}});function Vt(){return Ut(Ct)}const jt={lt:Jt,t:_t,rt:te,r:oe,rb:ee,b:Qt,lb:Zt,l:Kt};function X(o){const{top:t,left:e,height:s,width:c}=o;return{y:t+s/2,x:e+c/2}}function wt(o,t,e){return o*(e-t.x)+t.y}function gt(o,t,e){return t.x-(t.y-e)/o}function Jt(o,t){const{top:e,left:s,rotate:c,width:m,height:h}=o,y=X(o),d={x:s+m,y:e+h},l=v(d,y,c),u={x:(l.x+t.x)/2,y:(l.y+t.y)/2},f=v(t,u,-c),D=v(l,u,-c),L=D.y-f.y,M=D.x-f.x;return{top:f.y,left:f.x,width:M,height:L}}function Kt(o,t){const{left:e,rotate:s,width:c,height:m,top:h}=o,y=X(o),d={x:e+c,y:h+m/2},l=v(d,y,s);if(s%180!=90){const M=(y.y-l.y)/(y.x-l.x),A=wt(M,y,t.x);t.y=A}else t.x=y.x;const u={x:(l.x+t.x)/2,y:(l.y+t.y)/2},f=v(t,u,-s),L=v(l,u,-s).x-f.x;return{top:u.y-m/2,left:f.x,width:L,height:m}}function Zt(o,t){const{top:e,left:s,rotate:c,width:m}=o,h=X(o),y={x:s+m,y:e},d=v(y,h,c),l={x:(d.x+t.x)/2,y:(d.y+t.y)/2},u=v(t,l,-c),f=v(d,l,-c),D=u.y-f.y,L=f.x-u.x;return{top:u.y-D,left:u.x,width:L,height:D}}function Qt(o,t){const{top:e,left:s,rotate:c,width:m}=o,h=X(o),y={x:s+m/2,y:e},d=v(y,h,c);if(c%180!=90){const L=(h.y-d.y)/(h.x-d.x),M=gt(L,h,t.y);t.x=M}else t.y=h.y;const l={x:(d.x+t.x)/2,y:(d.y+t.y)/2},u=v(t,l,-c),f=v(d,l,-c),D=u.y-f.y;return{top:u.y-D,left:l.x-m/2,width:m,height:D}}function _t(o,t){const{top:e,left:s,rotate:c,width:m,height:h}=o,y=X(o),d={x:s+m/2,y:e+h},l=v(d,y,c);if(c%180!=90){const M=(y.y-l.y)/(y.x-l.x),A=gt(M,y,t.y);t.x=A}else t.y=y.y;const u={x:(l.x+t.x)/2,y:(l.y+t.y)/2},f=v(t,u,-c),L=v(l,u,-c).y-f.y;return{top:f.y,left:u.x-m/2,width:m,height:L}}function te(o,t){const{top:e,left:s,rotate:c,height:m}=o,h=X(o),y={x:s,y:e+m},d=v(y,h,c),l={x:(d.x+t.x)/2,y:(d.y+t.y)/2},u=v(t,l,-c),f=v(d,l,-c),D=f.y-u.y,L=u.x-f.x;return{top:u.y,left:f.x,width:L,height:D}}function ee(o,t){const{top:e,left:s,rotate:c}=o,m=X(o),y=v({x:s,y:e},m,c),d={x:(y.x+t.x)/2,y:(y.y+t.y)/2},l=v(t,d,-c),u=v(y,d,-c),f=l.y-u.y,D=l.x-u.x;return{top:u.y,left:u.x,width:D,height:f}}function oe(o,t){const{top:e,left:s,rotate:c,height:m}=o,h=X(o),y={x:s,y:e+m/2},d=v(y,h,c);if(c%180!=90){const L=(h.y-d.y)/(h.x-d.x),M=wt(L,h,t.x);t.y=M}else t.x=h.x;const l={x:(d.x+t.x)/2,y:(d.y+t.y)/2},u=v(t,l,-c),f=v(d,l,-c),D=u.x-f.x;return{top:f.y-m/2,left:f.x,width:D,height:m}}function ne(o,t,e){const{top:s,left:c,width:m,height:h}=jt[o](t,e);return{top:Math.round(s),left:Math.round(c),width:Math.round(m),height:Math.round(h)}}const se=["onDblclick"],re=["onClick"],ie=Rt({__name:"Shape",props:{active:{type:Boolean,default:!1},info:null,defaultStyle:null,index:null,isInner:{type:Boolean,default:!1}},setup(o){const t=o;It(r=>({"00a0d822":tt.value,"00ec4c82":et.value,"006dc80d":ot.value}));const e=U(),s=qt(),c=Vt(),m=()=>{c.copy(),xt(JSON.stringify(e.curComponent))},h=()=>{t.index&&e.removeComponent(t.index)},y=()=>{t.index&&e.upComponent(t.index)},d=()=>{t.index&&e.downComponent(t.index)},l=()=>{t.index&&e.topComponent(t.index)},u=()=>{if(t.index){let r=e.curComponent.id;xt(r)}},f=()=>{t.index&&e.bottomComponent(t.index)},D=()=>{s.decompose()},L=()=>(e.setCurComponent(t.info,t.index),[{text:"\u62C6\u5206",subText:"",disable:s.canDecompose,handler:D},{divider:!0},{text:"\u590D\u5236",subText:"Ctrl + C",handler:m},{text:"\u590D\u5236ID",subText:"",handler:u},{text:"\u5220\u9664",subText:"",handler:h},{divider:!0},{text:"\u7F6E\u4E8E\u9876\u5C42",handler:l,children:[{text:"\u7F6E\u4E8E\u9876\u5C42",handler:l},{text:"\u4E0A\u79FB\u4E00\u5C42",handler:y}]},{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:f,children:[{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:f},{text:"\u4E0B\u79FB\u4E00\u5C42",handler:d}]}]),M=j(()=>e.isShowEm),A=W(null),bt=J(["lt","t","rt","r","rb","b","lb","l"]),Et=J({lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315}),Q=J([{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}]),_=W({}),tt=W("0px"),et=W("#fff0"),ot=W("none"),V=W(!1),q=W("");Pt((r,n,p)=>{if(console.log(r),p==="render function"){if(e.isEditMode){if(n){const{id:x,label:i}=n.info||{};q.value=`\u7EC4\u4EF6[${i}][${x}]\u6E32\u67D3\u5F02\u5E38`}else q.value="\u7EC4\u4EF6\u6E32\u67D3\u5F02\u5E38";tt.value="5px",et.value="red",ot.value="dashed",V.value=!0}return!1}else return!0});const b=j(()=>t.active&&!t.info.isLock||s.isActived(t.info)),Dt=()=>{s.appendComponent(t.info)},nt=r=>{if(r.button===0){if(r.preventDefault(),r.stopPropagation(),!(e.curComponent&&t.info.id===e.curComponent.id)||t.info.isLock)return;const n=t.index.split("-").map(P=>Number(P));n.pop();const p=e.getComponentByIndex(n);_.value=it();let{top:x,left:i}=t.defaultStyle;const Y=r.clientY,B=r.clientX,R=x,I=i,F=P=>{const H=P.clientX;x=P.clientY-Y+R,i=H-B+I,e.syncComponentLoction({top:x,left:i},p.component==="Root"?void 0:p)},N=()=>{Gt.emit("unmove"),document.removeEventListener("mousemove",F),document.removeEventListener("mouseup",N),p&&e.resizeAutoComponent(n)};document.addEventListener("mousemove",F),document.addEventListener("mouseup",N)}},st=r=>{r.preventDefault(),r.stopPropagation(),e.setCurComponent(t.info,t.index)},k=(r,n)=>{if(n.button===0){if(!(e.curComponent&&t.info.id===e.curComponent.id))return;n.stopPropagation(),n.preventDefault();const p=t.index.split("-").map(I=>Number(I));p.pop();const x=e.getComponentByIndex(p),i={top:t.defaultStyle.top,left:t.defaultStyle.left,height:t.defaultStyle.height,width:t.defaultStyle.width,rotate:t.defaultStyle.rotate},Y=document.querySelector("#editor").getBoundingClientRect(),B=I=>{const F={x:I.clientX-Y.left,y:I.clientY-Y.top},{top:N,left:P,width:H,height:T}=ne(r,i,F);e.syncComponentLoction({top:N,left:P,width:H,height:T},x.component==="Root"?void 0:x)},R=()=>{document.removeEventListener("mousemove",B),document.removeEventListener("mouseup",R),x&&e.resizeAutoComponent(p)};document.addEventListener("mousemove",B),document.addEventListener("mouseup",R)}},rt=r=>{if(r.button===0){if(!A.value||(r.preventDefault(),r.stopPropagation(),!(e.curComponent&&t.info.id===e.curComponent.id))||t.info.isLock)return;const n=t.index.split("-").map(T=>Number(T));n.pop();const p=e.getComponentByIndex(n);let{rotate:x}=O({},t.defaultStyle);const i=r.clientY,Y=r.clientX,B=x,R=A.value.getBoundingClientRect(),I=R.left+R.width/2,F=R.top+R.height/2,N=Math.atan2(i-F,Y-I)/(Math.PI/180),P=T=>{const St=T.clientX,Lt=T.clientY,kt=Math.atan2(Lt-F,St-I)/(Math.PI/180);x=B+kt-N,e.syncComponentLoction({rotate:x},p.component==="Root"?void 0:p)},H=()=>{document.removeEventListener("mousemove",P),document.removeEventListener("mouseup",H),p&&e.resizeAutoComponent(n)};document.addEventListener("mousemove",P),document.addEventListener("mouseup",H)}},it=()=>{if(!e.curComponent)return{};const r=ht(e.curComponent.style.rotate),n={};let p=-1;return bt.forEach(x=>{const i=ht(Et[x]+r),Y=Q.length;for(;;){p=(p+1)%Y;const B=Q[p];if(i<23||i>=338){n[x]="nw-resize";return}if(B.start<=i&&i<B.end){n[x]=B.cursor+"-resize";return}}}),n},z=j(()=>{const r="rotate-",n=t.defaultStyle.rotate;return n>-22.5&&n<=22.5?r+0:n>22.5&&n<=67.5?r+45:n>67.5&&n<=112.5?r+90:n>112.5&&n<=157.5?r+135:n>157.5||n<=-157.5?r+0:n>-157.5&&n<=-112.5?r+45:n>-112.5&&n<=-67.5?r+90:n>-67.5&&n<=-22.5?r+135:r+0}),ct=r=>{if(document.addEventListener("keyup",at),!(e.curComponent&&t.info.id===e.curComponent.id))return;const n=t.index.split("-").map(x=>Number(x));n.pop(),r.stopPropagation();const p=e.getComponentByIndex(n);if(t.info&&r.ctrlKey)switch(r.key){case"ArrowLeft":r.preventDefault(),e.syncComponentLoction({left:t.info.style.left-1},p.component==="Root"?void 0:p);break;case"ArrowUp":r.preventDefault(),e.syncComponentLoction({top:t.info.style.top-1},p.component==="Root"?void 0:p);break;case"ArrowRight":r.preventDefault(),e.syncComponentLoction({left:t.info.style.left+1},p.component==="Root"?void 0:p);break;case"ArrowDown":r.preventDefault(),e.syncComponentLoction({top:t.info.style.top+1},p.component==="Root"?void 0:p);break;default:return}},at=r=>{if(!(e.curComponent&&t.info.id===e.curComponent.id))return;const n=t.index.split("-").map(x=>Number(x));n.pop(),r.stopPropagation();const p=e.getComponentByIndex(n);t.info&&p&&e.resizeAutoComponent(n),document.removeEventListener("keyup",at)};return At(()=>{_.value=it()}),Yt(()=>e.curComponent,r=>{r&&t.info.id===r.id?document.addEventListener("keydown",ct):document.removeEventListener("keydown",ct)}),(r,n)=>{const p=Xt("icon-park"),x=Ft("contextmenu");return o.isInner?C((pt(),dt("div",{key:0,ref_key:"shape",ref:A,class:S(["shape",{active:a(b)||o.active}]),onDblclick:K(st,["exact"]),onMousedown:nt},[C(E("span",{class:"error-info"},G(q.value),513),[[w,V.value]]),C(ft(p,{class:"rotation",name:"one-third-rotation",color:"#fff",onMousedown:rt},null,512),[[w,a(b)]]),C(E("em",null,"("+G(o.defaultStyle.left)+","+G(o.defaultStyle.top)+")",513),[[w,a(M)]]),C(E("div",{class:S(["shape-point","lt",a(z)]),style:{top:"0%",left:"0%"},onMousedown:n[0]||(n[0]=i=>k("lt",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","t",a(z)]),style:{top:"0%",left:"50%"},onMousedown:n[1]||(n[1]=i=>k("t",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","rt",a(z)]),style:{top:"0%",left:"100%"},onMousedown:n[2]||(n[2]=i=>k("rt",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","r",a(z)]),style:{top:"50%",left:"100%"},onMousedown:n[3]||(n[3]=i=>k("r",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","rb",a(z)]),style:{top:"100%",left:"100%"},onMousedown:n[4]||(n[4]=i=>k("rb",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","b",a(z)]),style:{top:"100%",left:"50%"},onMousedown:n[5]||(n[5]=i=>k("b",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point",["shape-point","lb",a(z)]]),style:{top:"100%",left:"0%"},onMousedown:n[6]||(n[6]=i=>k("lb",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","l",a(z)]),style:{top:"50%",left:"0%"},onMousedown:n[7]||(n[7]=i=>k("l",i))},null,34),[[w,a(b)]]),mt(r.$slots,"default",{},void 0,!0)],42,se)),[[x,L]]):C((pt(),dt("div",{key:1,ref_key:"shape",ref:A,class:S(["shape",{active:a(b)||o.active}]),onClick:[K(Dt,["ctrl","exact"]),K(st,["exact"])],onMousedown:nt},[C(E("span",{class:"error-info"},G(q.value),513),[[w,V.value]]),C(ft(p,{class:"rotation",name:"one-third-rotation",color:"#fff",onMousedown:rt},null,512),[[w,a(b)]]),C(E("em",null,"("+G(o.defaultStyle.left)+","+G(o.defaultStyle.top)+")",513),[[w,a(M)]]),C(E("div",{class:S(["shape-point","lt",a(z)]),style:{top:"0%",left:"0%"},onMousedown:n[8]||(n[8]=i=>k("lt",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","t",a(z)]),style:{top:"0%",left:"50%"},onMousedown:n[9]||(n[9]=i=>k("t",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","rt",a(z)]),style:{top:"0%",left:"100%"},onMousedown:n[10]||(n[10]=i=>k("rt",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","r",a(z)]),style:{top:"50%",left:"100%"},onMousedown:n[11]||(n[11]=i=>k("r",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","rb",a(z)]),style:{top:"100%",left:"100%"},onMousedown:n[12]||(n[12]=i=>k("rb",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","b",a(z)]),style:{top:"100%",left:"50%"},onMousedown:n[13]||(n[13]=i=>k("b",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point",["shape-point","lb",a(z)]]),style:{top:"100%",left:"0%"},onMousedown:n[14]||(n[14]=i=>k("lb",i))},null,34),[[w,a(b)]]),C(E("div",{class:S(["shape-point","l",a(z)]),style:{top:"50%",left:"0%"},onMousedown:n[15]||(n[15]=i=>k("l",i))},null,34),[[w,a(b)]]),mt(r.$slots,"default",{},void 0,!0)],42,re)),[[x,L]])}}});var de=Ot(ie,[["__scopeId","data-v-d1de16e4"]]);export{de as S,Vt as a,qt as u};
