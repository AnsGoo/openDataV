var d=(g,a,c)=>new Promise((h,e)=>{var l=n=>{try{o(c.next(n))}catch(m){e(m)}},u=n=>{try{o(c.throw(n))}catch(m){e(m)}},o=n=>n.done?h(n.value):Promise.resolve(n.value).then(l,u);o((c=c.apply(g,a)).next())});import{r as _,h as M}from"./echarts.4f9736bc.js";import{h as x}from"./index.59b178ec.js";import{u as E,w}from"./index.2fc0df38.js";import{t as O}from"./mydark.8efe4250.js";import{p as k,r as z,q as I,w as D,o as A,a7 as T,P as B,y as J,x as N}from"./@vue.7df1a0ef.js";import"./zrender.706c9170.js";import"./tslib.34a40861.js";import"./axios.19d3e859.js";import"./vue-router.e129948e.js";import"./@vueuse.fe63d129.js";import"./pinia.685e9614.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./element-plus.54ccd689.js";import"./lodash.8679a684.js";import"./nprogress.5f640c6a.js";import"./async-validator.5d25c98b.js";import"./@popperjs.a8a4a6a0.js";import"./resize-observer-polyfill.8deb1e21.js";import"./lodash-es.4775bb8f.js";import"./dexie.c25c286a.js";import"./@icon-park.87123711.js";const le=k({props:{element:null,propValue:null},setup(g){const a=g;_("mydark",O);const c=E(),h=z(null);let e=null,l=[],u,o=[];I(()=>d(this,null,function*(){yield n(),S(),clearInterval(u),u=setInterval(V,a.propValue.interval)}));const n=()=>d(this,null,function*(){let s=null;try{s=JSON.parse(a.propValue.data)}catch(t){w(t.message)}if(s){const t=a.propValue.history;try{yield v(t,s)}catch(i){if(console.log(i),c.isEditMode){l=[],o=[];for(let r=0;r<100;r++)l.push(Math.round(Math.random()*600)),o.push(String(r))}}finally{yield V()}}}),m=s=>{const t=s[0],{width:i,height:r}=t.contentRect;e==null||e.resize({width:i,height:r})},j=()=>{let s=[],t=[];const i=o.length;for(let f=0;f<i;f++)a.propValue.highflag&&s.push(a.propValue.highflag),a.propValue.lowflag&&t.push(a.propValue.lowflag);let r={grid:{top:"10%",left:"3%",right:"4%",bottom:"10%",containLabel:!0},title:{text:a.propValue.title,subtext:a.propValue.subTitle,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[]},p=[{data:l,type:"line",symbol:"none",smooth:!0}];return t.length>0&&p.push({data:t,type:"line",symbol:"none"}),s.length>0&&p.push({data:s,type:"line",symbol:"none"}),r.series=p,r},v=(s,t)=>d(this,null,function*(){const i=a.propValue.method?a.propValue.method:"GET";let r;i==="GET"?r=yield x.get({url:s,params:t}):r=yield x.post({url:s,data:t});const f=JSON.parse(r)[0].Records;l=[],o=[],f.map(y=>(l.push(parseInt(y.Values._value)),o.push(y.Values._time),{time:y.Values._time,value:parseInt(y.Values._value)}))}),V=()=>d(this,null,function*(){let s=j(),t=null;try{t=JSON.parse(a.propValue.data)}catch(i){w(i.message)}if(t){const i=a.propValue.history;try{yield v(i,t)}catch(r){if(c.isEditMode){l=[],o=[];for(let p=0;p<100;p++)l.push(Math.round(Math.random()*600)),o.push(String(p))}}finally{s.series[0].data=l,e&&e.setOption({xAxis:{data:o},series:s.series})}}}),S=()=>{e=M(h.value,"mydark"),e.clear(),e.setOption(j())};let b=()=>{console.log("stop")};return c.isEditMode&&(b=D(()=>a.propValue,()=>{e&&(e.clear(),e.setOption(j()))},{deep:!0})),A(()=>{clearInterval(u),b(),e&&(e.clear(),e.dispose())}),(s,t)=>{const i=T("resize");return B((N(),J("div",{ref:(r,p)=>{p.chartEl=r,h.value=r}},null,512)),[[i,m]])}}});export{le as default};
