var St=Object.defineProperty;var rt=Object.getOwnPropertySymbols;var Dt=Object.prototype.hasOwnProperty,Mt=Object.prototype.propertyIsEnumerable;var ct=(o,t,e)=>t in o?St(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e,A=(o,t)=>{for(var e in t||(t={}))Dt.call(t,e)&&ct(o,e,t[e]);if(rt)for(var e of rt(t))Mt.call(t,e)&&ct(o,e,t[e]);return o};import{d as zt,a6 as kt,k as V,r as F,B as j,a7 as Lt,e as Bt,U as Pt,a5 as It,u as y,O as it,X as lt,Y as g,Z as H,v as C,c as at,G as i,a2 as b,A as ut,a3 as J}from"./@vue.a2815691.js";import{u as $,d as pt,e as Yt,h as Rt,i as Xt,j as O,s as mt,m as Ft,r as x,_ as Tt,k as dt,l as ft,n as Wt}from"./index.395efaf1.js";import{d as ht}from"./pinia.6e1173f7.js";import{c as U}from"./lodash-es.5f1bdab1.js";const v=$(),At=ht({id:"compose",state:()=>({style:{top:0,left:0,width:0,height:0,rotate:0},components:[]}),getters:{canCompose(){return this.components.length>1},canDecompose(){return!(v.curComponent&&!v.curComponent.isLock&&v.curComponent.component==="Group")}},actions:{isActived(o){return this.components.findIndex(t=>t.id===o.id)!==-1},setAreaData(o,t){this.style=o||{},this.components=t||[]},appendComponent(o){this.components.findIndex(t=>t.id===o.id)===-1&&(this.components.push(o),this.components.length>1&&(this.style=A(A({},this.style),pt(this.components))))},compose(){this.style.width===0&&(this.style=A(A({},this.style),pt(this.components)));const o={component:"Group",id:Yt(),display:!0,icon:"",style:this.style,subComponents:U(this.components),label:""};Rt(o),this.batchDeleteComponent(this.components),v.appendComponent(o);const t=v.componentData.length-1;v.setCurComponent(v.componentData[t]),this.components=[]},batchDeleteComponent(o){o.forEach(t=>{for(let e=0,s=v.componentData.length;e<s;e++)if(t.id===v.componentData[e].id){v.componentData.splice(e,1);break}})},decompose(){var e;const o=v.curComponent.style,t=((e=v.curComponent)==null?void 0:e.subComponents)||[];if(t.length>0){const s=v.getComponentIndexById(v.curComponent.id);v.removeComponent(s.toString()),t.forEach(r=>{Xt(r,o),v.appendComponent(r)})}},flushRight(){const{right:o,items:t}=O(this.components);t.forEach(e=>{const s=o-e.right;e.component.style.left=e.component.style.left+s}),v.saveComponentData()},flushLeft(){const{left:o,items:t}=O(this.components);t.forEach(e=>{const s=e.left-o;e.component.style.left=e.component.style.left-s}),v.saveComponentData()},flushTop(){const{top:o,items:t}=O(this.components);t.forEach(e=>{const s=e.top-o;e.component.style.top=e.component.style.top-s}),v.saveComponentData()},flushBottom(){const{bottom:o,items:t}=O(this.components);t.forEach(e=>{const s=o-e.bottom;e.component.style.top=e.component.style.top+s}),v.saveComponentData()},flushRow(){const{top:o,bottom:t,items:e}=O(this.components);e.forEach(s=>{const r=(t+o)/2-s.center.y;s.component.style.top=s.component.style.top+r}),v.saveComponentData()},flushColumn(){const{left:o,right:t,items:e}=O(this.components);e.forEach(s=>{const r=(o+t)/2-s.center.x;s.component.style.left=s.component.style.left+r}),v.saveComponentData()}}}),Ht=()=>At(mt),Ot=ht({id:"copy",state:()=>({copyData:void 0,isCut:!1}),actions:{copy(){const t=$().curComponent;!t||(this.copyData=U(t))},paste(o,t,e){if(!this.copyData){Ft.info("\u8BF7\u9009\u62E9\u7EC4\u4EF6");return}const s=$();o?(this.copyData.style.top=e,this.copyData.style.left=t):(this.copyData.style.top=this.copyData.style.top+10,this.copyData.style.left=this.copyData.style.left+10),s.appendComponent(U(this.copyData))}}});function Gt(){return Ot(mt)}const Nt={lt:$t,t:Jt,rt:Ut,r:Kt,rb:Zt,b:jt,lb:Vt,l:qt};function Y(o){const{top:t,left:e,height:s,width:r}=o;return{y:t+s/2,x:e+r/2}}function yt(o,t,e){return o*(e-t.x)+t.y}function xt(o,t,e){return t.x-(t.y-e)/o}function $t(o,t){const{top:e,left:s,rotate:r,width:f,height:h}=o,m=Y(o),p={x:s+f,y:e+h},a=x(p,m,r),u={x:(a.x+t.x)/2,y:(a.y+t.y)/2},d=x(t,u,-r),E=x(a,u,-r),S=E.y-d.y,L=E.x-d.x;return{top:d.y,left:d.x,width:L,height:S}}function qt(o,t){const{left:e,rotate:s,width:r,height:f,top:h}=o,m=Y(o),p={x:e+r,y:h+f/2},a=x(p,m,s);if(s%180!=90){const L=(m.y-a.y)/(m.x-a.x),I=yt(L,m,t.x);t.y=I}else t.x=m.x;const u={x:(a.x+t.x)/2,y:(a.y+t.y)/2},d=x(t,u,-s),S=x(a,u,-s).x-d.x;return{top:u.y-f/2,left:d.x,width:S,height:f}}function Vt(o,t){const{top:e,left:s,rotate:r,width:f}=o,h=Y(o),m={x:s+f,y:e},p=x(m,h,r),a={x:(p.x+t.x)/2,y:(p.y+t.y)/2},u=x(t,a,-r),d=x(p,a,-r),E=u.y-d.y,S=d.x-u.x;return{top:u.y-E,left:u.x,width:S,height:E}}function jt(o,t){const{top:e,left:s,rotate:r,width:f}=o,h=Y(o),m={x:s+f/2,y:e},p=x(m,h,r);if(r%180!=90){const S=(h.y-p.y)/(h.x-p.x),L=xt(S,h,t.y);t.x=L}else t.y=h.y;const a={x:(p.x+t.x)/2,y:(p.y+t.y)/2},u=x(t,a,-r),d=x(p,a,-r),E=u.y-d.y;return{top:u.y-E,left:a.x-f/2,width:f,height:E}}function Jt(o,t){const{top:e,left:s,rotate:r,width:f,height:h}=o,m=Y(o),p={x:s+f/2,y:e+h},a=x(p,m,r);if(r%180!=90){const L=(m.y-a.y)/(m.x-a.x),I=xt(L,m,t.y);t.x=I}else t.y=m.y;const u={x:(a.x+t.x)/2,y:(a.y+t.y)/2},d=x(t,u,-r),S=x(a,u,-r).y-d.y;return{top:d.y,left:u.x-f/2,width:f,height:S}}function Ut(o,t){const{top:e,left:s,rotate:r,height:f}=o,h=Y(o),m={x:s,y:e+f},p=x(m,h,r),a={x:(p.x+t.x)/2,y:(p.y+t.y)/2},u=x(t,a,-r),d=x(p,a,-r),E=d.y-u.y,S=u.x-d.x;return{top:u.y,left:d.x,width:S,height:E}}function Zt(o,t){const{top:e,left:s,rotate:r}=o,f=Y(o),m=x({x:s,y:e},f,r),p={x:(m.x+t.x)/2,y:(m.y+t.y)/2},a=x(t,p,-r),u=x(m,p,-r),d=a.y-u.y,E=a.x-u.x;return{top:u.y,left:u.x,width:E,height:d}}function Kt(o,t){const{top:e,left:s,rotate:r,height:f}=o,h=Y(o),m={x:s,y:e+f/2},p=x(m,h,r);if(r%180!=90){const S=(h.y-p.y)/(h.x-p.x),L=yt(S,h,t.x);t.y=L}else t.x=h.x;const a={x:(p.x+t.x)/2,y:(p.y+t.y)/2},u=x(t,a,-r),d=x(p,a,-r),E=u.x-d.x;return{top:d.y-f/2,left:d.x,width:E,height:f}}function Qt(o,t,e){const{top:s,left:r,width:f,height:h}=Nt[o](t,e);return{top:Math.round(s),left:Math.round(r),width:Math.round(f),height:Math.round(h)}}const _t=["onDblclick"],te=["onClick"],ee=zt({__name:"Shape",props:{active:{type:Boolean,default:!1},info:null,defaultStyle:null,index:null,isInner:{type:Boolean,default:!1}},setup(o){const t=o;kt(l=>({"0927d9ce":Q.value,"0810db6b":_.value,"08f4c9b9":tt.value}));const e=$(),s=Ht(),r=Gt(),f=()=>{r.copy(),ft(JSON.stringify(e.curComponent))},h=()=>{t.index&&e.removeComponent(t.index)},m=()=>{t.index&&e.upComponent(t.index)},p=()=>{t.index&&e.downComponent(t.index)},a=()=>{t.index&&e.topComponent(t.index)},u=()=>{if(t.index){let l=e.curComponent.id;ft(l)}},d=()=>{t.index&&e.bottomComponent(t.index)},E=()=>{s.decompose()},S=()=>(e.setCurComponent(t.info),[{text:"\u62C6\u5206",subText:"",disable:s.canDecompose,handler:E},{divider:!0},{text:"\u590D\u5236",subText:"Ctrl + C",handler:f},{text:"\u590D\u5236ID",subText:"",handler:u},{text:"\u5220\u9664",subText:"",handler:h},{divider:!0},{text:"\u7F6E\u4E8E\u9876\u5C42",handler:a,children:[{text:"\u7F6E\u4E8E\u9876\u5C42",handler:a},{text:"\u4E0A\u79FB\u4E00\u5C42",handler:m}]},{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:d,children:[{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:d},{text:"\u4E0B\u79FB\u4E00\u5C42",handler:p}]}]),L=V(()=>e.isShowEm),I=F(null),Ct=j(["lt","t","rt","r","rb","b","lb","l"]),vt=j({lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315}),Z=j([{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}]),K=F({}),Q=F("0px"),_=F("#fff0"),tt=F("none"),q=F(!1),N=F("");Lt((l,n,z)=>{if(console.log(l),z==="render function"){if(e.isEditMode){if(n){const{id:k,label:c}=n.info||{};N.value=`\u7EC4\u4EF6[${c}][${k}]\u6E32\u67D3\u5F02\u5E38`}else N.value="\u7EC4\u4EF6\u6E32\u67D3\u5F02\u5E38";Q.value="5px",_.value="red",tt.value="dashed",q.value=!0}return!1}else return!0});const w=V(()=>t.active&&!t.info.isLock||s.isActived(t.info)),wt=()=>{s.appendComponent(t.info)},et=l=>{if(l.button===0){if(e.setClickComponentStatus(!0),l.preventDefault(),l.stopPropagation(),!(e.curComponent&&t.info.id===e.curComponent.id)||t.info.isLock)return;K.value=st();let{top:n,left:z}=t.defaultStyle;const k=l.clientY,c=l.clientX,B=n,P=z,R=X=>{const W=X.clientX;n=X.clientY-k+B,z=W-c+P,e.syncComponentLoction({top:n,left:z})},T=()=>{Wt.emit("unmove"),document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",T)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",T)}},ot=l=>{l.preventDefault(),l.stopPropagation(),e.setCurComponent(t.info)},D=(l,n)=>{if(n.button===0){e.setClickComponentStatus(!0),n.stopPropagation(),n.preventDefault();const z={top:t.defaultStyle.top,left:t.defaultStyle.left,height:t.defaultStyle.height,width:t.defaultStyle.width,rotate:t.defaultStyle.rotate},k=document.querySelector("#editor").getBoundingClientRect(),c=P=>{const R={x:P.clientX-k.left,y:P.clientY-k.top},{top:T,left:X,width:W,height:G}=Qt(l,z,R);e.syncComponentLoction({top:T,left:X,width:W,height:G})},B=()=>{document.removeEventListener("mousemove",c),document.removeEventListener("mouseup",B)};document.addEventListener("mousemove",c),document.addEventListener("mouseup",B)}},nt=l=>{if(e.setCurComponent(t.info),l.button===0){if(!I.value)return;e.setClickComponentStatus(!0),l.preventDefault(),l.stopPropagation();let{rotate:n}=A({},t.defaultStyle);const z=l.clientY,k=l.clientX,c=n,B=I.value.getBoundingClientRect(),P=B.left+B.width/2,R=B.top+B.height/2,T=Math.atan2(z-R,k-P)/(Math.PI/180),X=G=>{const gt=G.clientX,Et=G.clientY,bt=Math.atan2(Et-R,gt-P)/(Math.PI/180);n=c+bt-T,e.syncComponentLoction({rotate:n})},W=()=>{document.removeEventListener("mousemove",X),document.removeEventListener("mouseup",W)};document.addEventListener("mousemove",X),document.addEventListener("mouseup",W)}},st=()=>{if(!e.curComponent)return{};const l=dt(e.curComponent.style.rotate),n={};let z=-1;return Ct.forEach(k=>{const c=dt(vt[k]+l),B=Z.length;for(;;){z=(z+1)%B;const P=Z[z];if(c<23||c>=338){n[k]="nw-resize";return}if(P.start<=c&&c<P.end){n[k]=P.cursor+"-resize";return}}}),n},M=V(()=>{const l="rotate-",n=t.defaultStyle.rotate;return n>-22.5&&n<=22.5?l+0:n>22.5&&n<=67.5?l+45:n>67.5&&n<=112.5?l+90:n>112.5&&n<=157.5?l+135:n>157.5||n<=-157.5?l+0:n>-157.5&&n<=-112.5?l+45:n>-112.5&&n<=-67.5?l+90:n>-67.5&&n<=-22.5?l+135:l+0});return Bt(()=>{K.value=st()}),(l,n)=>{const z=Pt("icon-park"),k=It("contextmenu");return o.isInner?y((it(),lt("div",{key:0,ref_key:"shape",ref:I,class:b(["shape",{active:i(w)||o.active}]),onDblclick:J(ot,["exact"]),onMousedownCapture:et},[y(g("span",{class:"error-info"},H(N.value),513),[[C,q.value]]),y(at(z,{class:"rotation",name:"one-third-rotation",color:"#fff",onMousedown:nt},null,512),[[C,i(w)]]),y(g("em",null,"("+H(o.defaultStyle.left)+","+H(o.defaultStyle.top)+")",513),[[C,i(L)]]),y(g("div",{class:b(["shape-point","lt",i(M)]),style:{top:"0%",left:"0%"},onMousedown:n[0]||(n[0]=c=>D("lt",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","t",i(M)]),style:{top:"0%",left:"50%"},onMousedown:n[1]||(n[1]=c=>D("t",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","rt",i(M)]),style:{top:"0%",left:"100%"},onMousedown:n[2]||(n[2]=c=>D("rt",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","r",i(M)]),style:{top:"50%",left:"100%"},onMousedown:n[3]||(n[3]=c=>D("r",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","rb",i(M)]),style:{top:"100%",left:"100%"},onMousedown:n[4]||(n[4]=c=>D("rb",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","b",i(M)]),style:{top:"100%",left:"50%"},onMousedown:n[5]||(n[5]=c=>D("b",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point",["shape-point","lb",i(M)]]),style:{top:"100%",left:"0%"},onMousedown:n[6]||(n[6]=c=>D("lb",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","l",i(M)]),style:{top:"50%",left:"0%"},onMousedown:n[7]||(n[7]=c=>D("l",c))},null,34),[[C,i(w)]]),ut(l.$slots,"default",{},void 0,!0)],42,_t)),[[k,S]]):y((it(),lt("div",{key:1,ref_key:"shape",ref:I,class:b(["shape",{active:i(w)||o.active}]),onClick:[J(wt,["ctrl","exact"]),J(ot,["exact"])],onMousedownCapture:et},[y(g("span",{class:"error-info"},H(N.value),513),[[C,q.value]]),y(at(z,{class:"rotation",name:"one-third-rotation",color:"#fff",onMousedown:nt},null,512),[[C,i(w)]]),y(g("em",null,"("+H(o.defaultStyle.left)+","+H(o.defaultStyle.top)+")",513),[[C,i(L)]]),y(g("div",{class:b(["shape-point","lt",i(M)]),style:{top:"0%",left:"0%"},onMousedown:n[8]||(n[8]=c=>D("lt",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","t",i(M)]),style:{top:"0%",left:"50%"},onMousedown:n[9]||(n[9]=c=>D("t",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","rt",i(M)]),style:{top:"0%",left:"100%"},onMousedown:n[10]||(n[10]=c=>D("rt",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","r",i(M)]),style:{top:"50%",left:"100%"},onMousedown:n[11]||(n[11]=c=>D("r",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","rb",i(M)]),style:{top:"100%",left:"100%"},onMousedown:n[12]||(n[12]=c=>D("rb",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","b",i(M)]),style:{top:"100%",left:"50%"},onMousedown:n[13]||(n[13]=c=>D("b",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point",["shape-point","lb",i(M)]]),style:{top:"100%",left:"0%"},onMousedown:n[14]||(n[14]=c=>D("lb",c))},null,34),[[C,i(w)]]),y(g("div",{class:b(["shape-point","l",i(M)]),style:{top:"50%",left:"0%"},onMousedown:n[15]||(n[15]=c=>D("l",c))},null,34),[[C,i(w)]]),ut(l.$slots,"default",{},void 0,!0)],42,te)),[[k,S]])}}});var ie=Tt(ee,[["__scopeId","data-v-207d5e50"]]);export{ie as S,Gt as a,Ht as u};
