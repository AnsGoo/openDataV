var W=(b,y,r)=>new Promise((u,n)=>{var c=s=>{try{i(r.next(s))}catch(_){n(_)}},m=s=>{try{i(r.throw(s))}catch(_){n(_)}},i=s=>s.done?u(s.value):Promise.resolve(s.value).then(c,m);i((r=r.apply(b,y)).next())});import{h as P}from"./index.52c73ba8.js";import{u as E}from"./useProp.afe31ed3.js";import{_ as F,d as H,B as g,y as $,E as L,c as o,J as T,o as p,b as v,K as f,F as w,r as z,a as t,L as j,f as J,I as K}from"./index.530c5dc4.js";import{u as M}from"./useEventBus.26b7d597.js";const O={class:"dv-percent-pond"},X=["id"],q=["offset","stop-color"],A=["id","x2"],Q=["offset","stop-color"],U=["x","y","rx","ry","stroke-width","stroke","width","height"],Y=["stroke-width","stroke-dasharray","stroke","points"],Z=["stroke","fill","x","y"],ee=H({__name:"Progress",props:{component:null},setup(b){const y=b,{propValue:r}=E(y.component),u=g(150),n=g(150),c=g(60),m=g(`percent-pond-gradientId1-${$()}`),i=g(`percent-pond-gradientId2-${$()}`),s=a=>{const h=a[0].contentRect;u.value=h.width,n.value=h.height},_=a=>{const l=a;r.data.datatag&&l.TagName===r.data.datatag&&(c.value=Number((Number(l.TagValue)*100/Number(r.data.maxValue)).toFixed(2)))};L(()=>W(this,null,function*(){yield S()}));const S=()=>W(this,null,function*(){if(r.data.history)try{const a=yield P.post({url:r.data.history,data:[r.data.datatag]});a.ErrorCode===200&&(c.value=(Number(a.Results[0].TagValue)||0)*100/Number(r.data.maxValue))}catch(a){console.log(a.message||a)}}),e=o(()=>({colors:[r.attr.color1,r.attr.color2],borderWidth:Number(r.attr.borderWidth),borderGap:Number(r.attr.borderGap),lineDash:r.attr.lineDash,gapWeight:r.attr.gapWeight,textColor:r.attr.textColor,fontSize:Number(r.attr.fontSize),borderRadius:Number(r.attr.borderRadius),localGradient:Boolean(r.attr.localGradient),formatter:r.attr.formatter})),k=o(()=>e.value.borderWidth?u.value-e.value.borderWidth:0),G=o(()=>e.value.borderWidth?n.value-e.value.borderWidth:0),C=o(()=>e.value?n.value-(e.value.borderWidth+e.value.borderGap)*2:0),D=o(()=>e.value&&e.value.localGradient?m.value:i.value),V=o(()=>{const a=n.value/2;if(!e.value)return`0, ${a} 0, ${a}`;const l=(u.value-(e.value.borderWidth+e.value.borderGap)*2)/100*c.value;return`
        ${e.value.borderWidth+e.value.borderGap}, ${a}
        ${e.value.borderWidth+e.value.borderGap+l}, ${a+.001}`}),N=o(()=>{if(!e.value.colors)return[];const a=e.value.colors.length,l=100/(a-1);return e.value.colors.map((h,d)=>[l*d,h])}),B=o(()=>e.value?"200%":"100%"),I=o(()=>e.value.formatter?e.value.formatter.replace("{value}",c.value.toString()):""),R=o(()=>({fontSize:(r.attr.fontSize||12)+"px"}));return M("actual",_),(a,l)=>{const h=K("resize");return T((p(),v("div",O,[(p(),v("svg",null,[f("defs",null,[f("linearGradient",{id:m.value,x1:"0%",y1:"0%",x2:"100%",y2:"0%"},[(p(!0),v(w,null,z(t(N),(d,x)=>(p(),v("stop",{key:x,offset:`${d[0]}%`,"stop-color":d[1]},null,8,q))),128))],8,X),f("linearGradient",{id:i.value,x1:"0%",y1:"0%",x2:t(B),y2:"0%"},[(p(!0),v(w,null,z(t(N),(d,x)=>(p(),v("stop",{key:x,offset:`${d[0]}%`,"stop-color":d[1]},null,8,Q))),128))],8,A)]),f("rect",{x:t(e)?t(e).borderWidth/2:"0",y:t(e)?t(e).borderWidth/2:"0",rx:t(e)?t(e).borderRadius:"0",ry:t(e)?t(e).borderRadius:"0",fill:"transparent","stroke-width":t(e)?t(e).borderWidth:"0",stroke:`url(#${m.value})`,width:t(k)>0?t(k):0,height:t(G)>0?t(G):0},null,8,U),f("polyline",{"stroke-width":t(C),"stroke-dasharray":t(e)?[t(e).lineDash,t(e).gapWeight].join(","):"0",stroke:`url(#${t(D)})`,points:t(V)},null,8,Y),f("text",{style:J(t(R)),stroke:t(e)?t(e).textColor:"#fff",fill:t(e)?t(e).textColor:"#fff",x:u.value/2,y:n.value/2},j(t(I)),13,Z)]))])),[[h,s]])}}});var ne=F(ee,[["__scopeId","data-v-1479d4b6"]]);export{ne as default};
