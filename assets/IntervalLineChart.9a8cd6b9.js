var m=(j,s,c)=>new Promise((f,e)=>{var l=n=>{try{o(c.next(n))}catch(d){e(d)}},u=n=>{try{o(c.throw(n))}catch(d){e(d)}},o=n=>n.done?f(n.value):Promise.resolve(n.value).then(l,u);o((c=c.apply(j,s)).next())});import{r as _,h as E}from"./echarts.4f9736bc.js";import{h as x}from"./index.1f44d164.js";import{u as M,m as w}from"./index.ef2789db.js";import{t as O}from"./mydark.e6801489.js";import{f as k,r as I,q as z,w as D,o as A,a4 as N,G as T,N as B,W as G}from"./@vue.f8650cf9.js";import"./zrender.706c9170.js";import"./tslib.34a40861.js";import"./axios.19d3e859.js";import"./vue-router.32a64423.js";import"./pinia.30c42674.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./naive-ui.2edb364b.js";import"./date-fns.3ef01b04.js";import"./seemly.5d1c4af6.js";import"./vueuc.ebfd6ddc.js";import"./evtd.79485e8d.js";import"./@css-render.7ab96087.js";import"./vooks.ee7b0837.js";import"./vdirs.8ff5d312.js";import"./@juggle.37ed2144.js";import"./css-render.d5050412.js";import"./@emotion.6322e2ae.js";import"./treemate.80cdf2c2.js";import"./async-validator.fb49d0f5.js";import"./lodash-es.5f1bdab1.js";import"./dexie.78e6a997.js";import"./nprogress.5f640c6a.js";import"./@icon-park.f4b03c54.js";const fe=k({props:{componentId:null,propValue:null},setup(j){const s=j;_("mydark",O);const c=M(),f=I(null);let e=null,l=[],u,o=[];z(()=>m(this,null,function*(){yield n(),S(),clearInterval(u),u=setInterval(b,s.propValue.interval)}));const n=()=>m(this,null,function*(){let r=null;try{r=JSON.parse(s.propValue.data)}catch(t){w.warning(t.message)}if(r){const t=s.propValue.history;try{yield v(t,r)}catch(i){if(console.log(i),c.isEditMode){l=[],o=[];for(let a=0;a<100;a++)l.push(Math.round(Math.random()*600)),o.push(String(a))}}finally{yield b()}}}),d=r=>{const t=r[0],{width:i,height:a}=t.contentRect;e==null||e.resize({width:i,height:a})},y=()=>{let r=[],t=[];const i=o.length;for(let h=0;h<i;h++)s.propValue.highflag&&r.push(s.propValue.highflag),s.propValue.lowflag&&t.push(s.propValue.lowflag);let a={grid:{top:"10%",left:"3%",right:"4%",bottom:"10%",containLabel:!0},title:{text:s.propValue.title,subtext:s.propValue.subTitle,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:o},yAxis:{type:"value"},series:[]},p=[{data:l,type:"line",symbol:"none",smooth:!0}];return t.length>0&&p.push({data:t,type:"line",symbol:"none"}),r.length>0&&p.push({data:r,type:"line",symbol:"none"}),a.series=p,a},v=(r,t)=>m(this,null,function*(){const i=s.propValue.method?s.propValue.method:"GET";let a;i==="GET"?a=yield x.get({url:r,params:t}):a=yield x.post({url:r,data:t});const h=JSON.parse(a)[0].Records;l=[],o=[],h.map(g=>(l.push(parseInt(g.Values._value)),o.push(g.Values._time),{time:g.Values._time,value:parseInt(g.Values._value)}))}),b=()=>m(this,null,function*(){let r=y(),t=null;try{t=JSON.parse(s.propValue.data)}catch(i){w.error(i.message)}if(t){const i=s.propValue.history;try{yield v(i,t)}catch(a){if(c.isEditMode){l=[],o=[];for(let p=0;p<100;p++)l.push(Math.round(Math.random()*600)),o.push(String(p))}}finally{r.series[0].data=l,e&&e.setOption({xAxis:{data:o},series:r.series})}}}),S=()=>{e=E(f.value,"mydark"),e.clear(),e.setOption(y())};let V=()=>{console.log("stop")};return c.isEditMode&&(V=D(()=>s.propValue,()=>{e&&(e.clear(),e.setOption(y()))},{deep:!0})),A(()=>{clearInterval(u),V(),e&&(e.clear(),e.dispose())}),(r,t)=>{const i=N("resize");return T((B(),G("div",{ref:(a,p)=>{p.chartEl=a,f.value=a}},null,512)),[[i,d]])}}});export{fe as default};
