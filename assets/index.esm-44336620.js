import{bI as e,d as a,r as t,p as l,aq as o,o as s,c as r,w as n,f as u,a as p,I as i,az as c,am as d,v,u as f,s as m,bJ as y,g as b,a1 as h,h as k,bK as C,F as x,a6 as g,O as w,t as U,bL as O,bM as _,a2 as V,l as j,P,bN as S,bO as E,i as L,bP as A,D as N}from"./index-40170f2c.js";function T(e,a,t,l){if("Javascript"===e)return function(e,a,t){try{return{handler:new Function(...a,e)}}catch(l){return{error:l}}}(a,t)}var I=Object.defineProperty,J=(e,a,t)=>(((e,a,t)=>{a in e?I(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t})(e,"symbol"!=typeof a?a+"":a,t),t);let M=class{constructor(e){J(this,"type","Custom"),J(this,"key"),J(this,"afterCallback"),this.key=e,this.buildAfterCallback()}buildAfterCallback(){const e=T("Javascript",this.key,["data","options"]);e&&e.handler&&(this.afterCallback=(a,t)=>e.handler(a,t))}toJSON(){return{key:this.key,type:this.type}}};const R=new e("script"),q={class:"buttons"},z={class:"footer"},B=((e,a)=>{const t=e.__vccOpts||e;for(const[l,o]of a)t[l]=o;return t})(a({__name:"ScriptsEditor",props:{code:{default:""},mode:{default:"use"}},emits:["update:code","change"],setup(e,{emit:a}){const d=t(!0),v=e,f=a,m=e=>{f("update:code",e),d.value=!1},y=t(null),b=()=>{f("change",v.code),f("update:code",v.code),d.value=!0,R.success("图层已经到底了")};return l((async()=>{})),(e,a)=>{const t=o("x-icon"),l=o("OCodeEditor");return s(),r(l,{ref_key:"cm",ref:y,value:e.code,"onUpdate:value":m,onChange:m},{"tool-bar":n((()=>[u("div",null,[u("div",q,[p(t,{class:"item button",name:"save",onClick:b})])])])),footer:n((()=>[u("div",z,[u("div",{class:i(["saved-status",d.value?"save":"unsave"])},c(d.value?"已保存":"未保存"),3)])])),_:1},8,["value"])}}}),[["__scopeId","data-v-95cb727a"]]),F={class:"justify-center flex-row flex-nowrap flex items-center"},D={type:"Custom",name:"自定义脚本",component:g(a({__name:"View",props:{slotter:{}},setup(e){const a=t(!1),o=t(void 0),r=e,i=async()=>{if(r.slotter.scriptConfig&&"Custom"===r.slotter.scriptConfig.type){const e=r.slotter.scriptConfig;o.value=e.key}else o.value=""},c=e=>{o.value=e,g()},g=()=>{if(o.value&&r.slotter){const e=new M(o.value);r.slotter.afterCallbackChange(e)}};return l((async()=>{await i()})),d((()=>r.slotter),(e=>{e&&i()})),(e,t)=>(s(),v(x,null,[p(f(h),{key:"data",label:"自定义脚本"},{default:n((()=>[u("div",F,[p(f(m),{value:o.value},null,8,["value"]),p(f(y),{type:"primary",onClick:t[0]||(t[0]=e=>a.value=!0)},{default:n((()=>[b(" 编辑 ")])),_:1})])])),_:1}),p(f(C),{show:a.value,"onUpdate:show":t[3]||(t[3]=e=>a.value=e)},{default:n((()=>[p(f(k),{title:"自定义脚本",bordered:!1,size:"small",role:"dialog",closable:"","aria-modal":"true",onClose:t[2]||(t[2]=e=>a.value=!1)},{default:n((()=>[p(B,{code:o.value,"onUpdate:code":t[1]||(t[1]=e=>o.value=e),onChange:c},null,8,["code"])])),_:1})])),_:1},8,["show"])],64))}})),handler:M},H={filterValue:{key:"filterValue",name:"过滤数据",extendParams:[{label:"过滤key",prop:"key",type:w.TEXT,props:{defaultValue:"value",placeholder:"请输入过滤key值"}},{label:"上限",prop:"topLimit",type:w.NUMBER,props:{defaultValue:void 0,placeholder:"过滤的最大值"}},{label:"下限",prop:"lowLimit",type:w.NUMBER,props:{defaultValue:void 0,placeholder:"过滤的最小值"}}],func:(e,a={key:"value",topLimit:1/0,lowLimit:-1/0})=>{const{key:t,topLimit:l,lowLimit:o}=a;return e.filter((e=>e[t]>o&&e[t]<l))}}};var K=Object.defineProperty,W=(e,a,t)=>(((e,a,t)=>{a in e?K(e,a,{enumerable:!0,configurable:!0,writable:!0,value:t}):e[a]=t})(e,"symbol"!=typeof a?a+"":a,t),t);class X{constructor(e,a={}){W(this,"type","System"),W(this,"key"),W(this,"extendParams"),W(this,"afterCallback"),this.key=e,this.extendParams=a,this.buildAfterCallback()}buildAfterCallback(){const e=H[this.key];e&&(this.afterCallback=(a,t)=>e.func(a,this.extendParams))}getFuncs(){return H}toJSON(){return{key:this.key,extendParams:this.extendParams,type:"System"}}}const $=a({props:{args:{type:Object,default:()=>{}},component:{type:Object,default:()=>{}},value:{type:Object}},emits:["updateValue"],setup(e,{emit:a}){const t=e=>{a("updateValue",e)};return()=>[U(e.component,{args:e.args,value:e.value,onUpdateValue:t})]}});const G=a({components:{OSwitch:O},props:{items:{type:Array,required:!0},data:{type:Object,required:!0}},emits:["change","update:data"],setup(e,{emit:a}){const t=(e,t)=>{a("change",t,e)},l=(e,a)=>{let l;if(!a)return p(x,null,[b(" ")]);const o=e.props||{},s=(null==o?void 0:o.options)||[];function r(e,a){return e in o?o[e]:a}switch(e.type){case w.COLOR:return p(L,{value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,swatches:E,onUpdateValue:a=>t(a,e.prop)},null);case w.SELECT:return p(S,{value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,placeholder:e.label,onUpdateValue:a=>t(a,e.prop),options:s,clearable:!0},null);case w.RADIO:return p(P,{value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,onUpdateValue:a=>t(a,e.prop)},function(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!A(e)}(l=s.map((e=>p(j,{value:e.value,key:e.value},{default:()=>[e.label]}))))?l:{default:()=>[l]});case w.NUMBER:const n=r("max",9999999999),u=r("min",-9999999999);return p(V,{value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,onUpdateValue:a=>t(a,e.prop),max:n,min:u,clearable:!0},{prefix:o.prefix,suffix:o.suffix});case w.SWITCH:return U(O,{value:a[e.prop],onUpdateValue:l=>{a[e.prop]=l,t(l,e.prop)}});case w.CUSTOM:return p($,{value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,onUpdateValue:a=>t(a,e.prop),component:o.componentType,args:o.args},null);default:return p(m,{clearable:!0,value:a[e.prop],"onUpdate:value":t=>a[e.prop]=t,onUpdateValue:a=>t(a,e.prop),readonly:!1===o.editable,disabled:o.disabled},{prefix:o.prefix,suffix:o.suffix})}};return()=>p(x,null,[e.items.map((a=>p(h,{prop:`${a.prop}`,label:a.label},{default:()=>[_(e.data)?p(x,null,null):l(a,e.data)]})))])}}),Q={class:"justify-center flex-row flex-nowrap flex items-center"},Y={type:"System",name:"系统脚本",component:g(a({__name:"View",props:{slotter:{}},setup(e){const a=e,o=t(!1),r=N((()=>Object.keys(H).map((e=>{const a=H[e];return{label:a.name,value:a.key}})))),i=t([]),c=t({}),m=t(null),g=(e,a)=>{U()},w=e=>{var a;m.value=e,i.value=(null==(a=H[e])?void 0:a.extendParams)||[];const t={};i.value.forEach((e=>{var a;t[e.prop]=null==(a=e.props)?void 0:a.defaultValue})),c.value=t,U()};l((async()=>{await O()}));const U=()=>{if(m.value&&a.slotter){const e=new X(m.value,c.value);a.slotter.afterCallbackChange(e)}},O=async()=>{var e;if(a.slotter.scriptConfig&&"System"===a.slotter.scriptConfig.type){const t=a.slotter.scriptConfig,l=t.key;m.value=l,i.value=(null==(e=H[l])?void 0:e.extendParams)||[],c.value=t.extendParams||{}}else m.value=null,i.value=[],c.value={}};return d((()=>a.slotter),(e=>{e&&O()})),(e,a)=>(s(),v(x,null,[p(f(h),{key:"data",label:"系统脚本"},{default:n((()=>[u("div",Q,[p(f(S),{value:m.value,"onUpdate:value":[a[0]||(a[0]=e=>m.value=e),w],options:r.value},null,8,["value","options"]),p(f(y),{type:"primary",onClick:a[1]||(a[1]=e=>o.value=!0)},{default:n((()=>[b(" 文档 ")])),_:1})])])),_:1}),p(f(G),{data:c.value,"onUpdate:data":a[2]||(a[2]=e=>c.value=e),items:i.value,onChange:g},null,8,["data","items"]),p(f(C),{show:o.value,"onUpdate:show":a[4]||(a[4]=e=>o.value=e)},{default:n((()=>[p(f(k),{title:"文档",bordered:!1,size:"small",role:"dialog",closable:"","aria-modal":"true",onClose:a[3]||(a[3]=e=>o.value=!1)},{default:n((()=>[b("我还没有写文档")])),_:1})])),_:1},8,["show"])],64))}})),funcs:H,handler:X};export{T as a,Y as i,D as p};
