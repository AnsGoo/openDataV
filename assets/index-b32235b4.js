import"./index-c2b5f845.js";import{c as V,a as Z,e as j,u as tt,f as at,g as et,h as st,i as nt}from"./staticData-3b11f627.js";import{d as U,v as x,X as F,S as H,W as I,x as q,V as M,J as Q,o as D,l as b,w as p,b as u,u as c,aH as Y,aG as z,N as G,Z as P,E as B,s as J,O as ot,H as m,_ as W,c as it,aF as dt,G as rt,b2 as lt,F as ct,b8 as X,b9 as L,ba as h,bb as A,bc as ut,I as pt,Y as ft,R as mt,L as gt,bd as yt,be as S,bf as vt,bg as ht}from"./index-70139cdd.js";const T="QUICK";class _t{id;title;constructor({id:o}){this.id=o}toJSON(){return{options:{id:this.id||"",title:this.title},type:"STATIC"}}static dumps(o,n=!1){return n?JSON.stringify(o,null,"	"):JSON.stringify(o)}static loads(o){return JSON.parse(o)}async connect(o,n){const d=await this.getRespData(n);o(d)}async getRespData(o){const n={status:"SUCCESS",data:""};if(!this.id)return n;try{const d=await V(this.id);if(d.status<400){const g=d.data;this.title=g.name,n.data=g.data}}catch(d){n.status="FAILED",n.data=d.stack||d.message}return n}}const $=_t,wt=U({__name:"Content",props:{options:{default:()=>({id:"",title:"",script:{code:"",type:"Javascript"}})},mode:{default:"debug"}},emits:["dataChange"],setup(w,{emit:o}){const n=w,d=console,g=x([]);n.mode==="debug"&&F(H.STATIC_KEY,async s=>{await t(s)});const v=I({data:""}),C=async()=>{try{const s=await Z();s.status===200&&(g.value=s.data.map(l=>({label:l.name,value:l.id.toString()})))}catch(s){d.log(s||s.message)}},a=I({id:n.options.id,title:n.options.title||"",originData:""}),r=()=>{a.id=void 0},t=async s=>{if(s){const l=await _(s);l&&(v.data=JSON.stringify(l.data,null,"	"),a.originData=l.data,a.id=s,a.title=l.name)}else v.data="",a.originData="";o("dataChange",a.id,a.title)},_=async s=>{try{const l=await V(s);if(l.status===200)return l.data}catch{return}},R=async()=>{try{const s=await j({data:a.originData,name:a.title||"未命名"});if(s.status===201){const l=s.data;a.id=l.id.toString(),a.title=l.name,a.originData=l.data,v.data=JSON.stringify(l.data,null,"	"),m.info("数据保存成功"),await C()}else m.warning("数据保存失败")}catch{m.warning("数据保存失败")}},N=async()=>{try{(await tt(a.id,{data:a.originData,name:a.title||"未命名"})).status===200?(m.info("数据更新成功"),await C()):m.warning("数据更新失败")}catch{m.warning("数据更新失败")}},O=async()=>{a.id?R():N()};q(async()=>{await C(),await E()});const E=async()=>{if(n.options&&n.options.id){const s=await _(n.options.id);s&&(a.id=s.id,a.title=s.name,a.originData=s.data,v.data=JSON.stringify(a.originData,null,"	"),o("dataChange",n.options.id,s.name))}else a.id="",a.title="",a.originData="",v.data=""};return M(()=>n.options.id,async()=>{await E()},{deep:!0}),(s,l)=>{const e=Q("x-icon");return D(),b(c(ot),{title:a.title,options:v,mode:s.mode,onSave:O},{"data-select":p(()=>[u(c(Y),{value:a.id,"onUpdate:value":[l[0]||(l[0]=i=>a.id=i),t],options:g.value,class:"selected",clearable:"",placeholder:"请选择数据",onClear:r},null,8,["value","options"]),s.mode==="debug"?(D(),b(c(z),{key:0},{default:p(()=>[u(c(G),{value:a.title,"onUpdate:value":l[1]||(l[1]=i=>a.title=i),class:"title"},{prefix:p(()=>[u(e,{name:"data"})]),_:1},8,["value"]),u(c(P),{type:"primary",onClick:R},{default:p(()=>[B("保存")]),_:1})]),_:1})):J("",!0)]),_:1},8,["title","options","mode"])}}});const Ct=W(wt,[["__scopeId","data-v-0351fc71"]]),Dt=U({__name:"Pane",props:{slotter:{}},setup(w){const o=w,n=x(!1),d=I({id:"",title:"",data:""});q(async()=>{await g()});const g=async()=>{const a=o.slotter.dataConfig;if(a&&a.type===T){const r=o.slotter.dataConfig?.dataInstance,{options:t}=r.toJSON();d.id=t.id,d.title=t.title}else{const r={type:T,dataInstance:new $({id:d.id})};await o.slotter.changeDataConfig(r)}},v=()=>{const a={type:T,dataInstance:new $({id:d.id})};o.slotter.changeDataConfig(a)},C=(a,r)=>{d.id=a,d.title=r,v()};return M(()=>o.slotter,async()=>{o.slotter&&await g()},{immediate:!0}),(a,r)=>(D(),it(ct,null,[u(c(dt),{key:"title",label:"快速数据"},{default:p(()=>[u(c(z),null,{default:p(()=>[u(c(G),{value:d.title,"onUpdate:value":r[0]||(r[0]=t=>d.title=t),readonly:!0,placeholder:"编辑请点击",onClick:r[1]||(r[1]=t=>n.value=!0)},null,8,["value"]),u(c(P),{type:"primary",onClick:r[2]||(r[2]=t=>n.value=!0)},{default:p(()=>[B(" 编辑 ")]),_:1})]),_:1})]),_:1}),u(c(lt),{show:n.value,"onUpdate:show":r[5]||(r[5]=t=>n.value=t),"display-directive":"show"},{default:p(()=>[u(c(rt),{style:{width:"800px"},title:"快速数据",bordered:!1,size:"small",role:"dialog","aria-modal":"true",closable:"",onClose:r[4]||(r[4]=t=>n.value=!1)},{default:p(()=>[u(Ct,{options:d,"onUpdate:options":r[3]||(r[3]=t=>d=t),mode:"use",onDataChange:C},null,8,["options"])]),_:1})]),_:1},8,["show"])],64))}}),Et={type:T,name:"快速数据",component:X(Dt),handler:$,useTo:"COMPONENT"},St=U({__name:"DynamicExtendContent",props:{options:{default:()=>({method:L.GET,url:"/getRiskArea",headers:[{key:"",value:"",disable:!1,id:h()}],params:[{key:"",value:"",disable:!1,id:h()}],data:[{key:"",value:"",disable:!1,id:h()}],otherConfig:{isRepeat:!1,interval:1e3}})},mode:{default:"use"}},emits:["update:options","change"],setup(w,{emit:o}){const n=w,d=()=>[{key:"",value:"",disable:!1,id:h()}],g=x([]),v=async()=>{try{const e=await et();e.status===200&&(g.value=e.data.map(i=>({label:i.name,value:i.id})))}catch(e){gt.log(e||e.message)}},C=()=>{t.id=void 0,t.title=void 0,t.headers=[{key:"",value:"",disable:!1,id:h()}],t.data=[{key:"",value:"",disable:!1,id:h()}],t.params=[{key:"",value:"",disable:!1,id:h()}],t.method=L.GET,t.url=""};let a;n.mode==="debug"&&F(H.REST_KEY,async e=>{await r(e),await N()});const r=async e=>{try{const i=await at(e);if(i.status===200){const f=i.data;if(t.method=f.method,t.url=f.url,!f.data)return;const y=A(f.data||{});t.data=y.length>0?y:d();const k=A(f.params||{});t.params=k.length>0?k:d(),t.title=f.name,t.id=f.id;const K=A(f.headers||{});t.headers=K.length>0?K:d()}}catch{return}},t=I(n.options),_=x({status:0,data:"",headers:{}}),R=yt(),N=async()=>{try{const e=await R.request(ut(t));_.value.status=e.status,_.value.data=JSON.stringify(e.data,null,"	"),_.value.headers=e.headers,t.id&&a&&a.save(t)}catch(e){const i=e.response||(e.toJSON?e.toJSON():{});_.value.status=i.status,_.value.data=e.stack||e.message,_.value.headers=i.headers||i?.config?.headers||{}}},O=()=>{o("change",t),o("update:options",t)},E=async e=>{await r(e),await N(),o("update:options",t),o("change",t)},s=async()=>{try{const e=S(t.headers),i=S(t.headers),f=S(t.data),y=await st({data:f,name:t.title||"未命名",url:t.url,method:t.method,headers:e,params:i});if(y.status===201){const k=y.data;t.id=k.id,t.title=k.name,m.info("数据保存成功")}else m.warning("数据保存失败")}catch{m.warning("数据保存失败")}},l=async()=>{try{const e=S(t.headers),i=S(t.headers),f=S(t.data);(await nt(t.id,{data:f,name:t.title||"未命名",url:t.url,method:t.method,headers:e,params:i})).status===200?m.info("数据更新成功"):m.warning("数据更新失败")}catch{m.warning("数据更新失败")}};return q(async()=>{await N(),await v()}),(e,i)=>{const f=Q("x-icon");return D(),b(c(mt),{options:t,"onUpdate:options":i[2]||(i[2]=y=>t=y),"onUpdate:restOptions":O,onChange:O},{"data-select":p(()=>[u(c(Y),{options:g.value,value:t.id,class:"selected",clearable:"",placeholder:"请选择数据","onUpdate:value":E,onClear:C},null,8,["options","value"]),e.mode==="debug"?(D(),b(c(G),{key:0,value:t.title,"onUpdate:value":i[0]||(i[0]=y=>t.title=y),class:"title"},{prefix:p(()=>[u(f,{name:"api"})]),_:1},8,["value"])):J("",!0),e.mode==="debug"?(D(),b(c(pt),{key:1},{default:p(()=>[u(c(ft),{class:"save"},{default:p(()=>[u(c(P),{onClick:i[1]||(i[1]=y=>t.id?l():s())},{default:p(()=>[B("保存")]),_:1})]),_:1})]),_:1})):J("",!0)]),_:1},8,["options"])}}});const bt=W(St,[["__scopeId","data-v-54d553c8"]]),Nt=U({__name:"Pane",props:{slotter:{}},setup(w){return(o,n)=>(D(),b(c(vt),{slotter:o.slotter},{default:p(()=>[u(bt)]),_:1},8,["slotter"]))}}),Tt={type:"REST",name:"动态数据",component:X(Nt),handler:ht,useTo:["COMPONENT","GLOBAL"],getdefaultOption:()=>({method:L.GET,url:"/getRiskArea",headers:[{key:"",value:"",disable:!1,id:h()}],params:[{key:"",value:"",disable:!1,id:h()}],data:[{key:"",value:"",disable:!1,id:h()}],otherConfig:{isRepeat:!1,interval:1e3}})};export{Et as Q,Tt as R};
