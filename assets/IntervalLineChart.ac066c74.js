var h=(y,r,n)=>new Promise((d,t)=>{var p=l=>{try{a(n.next(l))}catch(c){t(c)}},u=l=>{try{a(n.throw(l))}catch(c){t(c)}},a=l=>l.done?d(l.value):Promise.resolve(l.value).then(p,u);a((n=n.apply(y,r)).next())});import{r as b,h as E}from"./echarts.dba42fd9.js";import{h as x}from"./index.44682809.js";import{u as I,m as S}from"./index.2ad55fca.js";import{t as M}from"./mydark.e6801489.js";import{d as k,r as D,e as z,w as A,y as T,a5 as B,u as C,O as J,X as N}from"./@vue.a2815691.js";import"./zrender.0cec7a92.js";import"./tslib.60310f1a.js";import"./axios.744bc20e.js";import"./vue-router.c997c3e8.js";import"./pinia.6e1173f7.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./naive-ui.3474528c.js";import"./date-fns.3c009aaa.js";import"./seemly.50a99b79.js";import"./vueuc.e50d3fb2.js";import"./evtd.9eee5233.js";import"./@css-render.8efa119b.js";import"./vooks.5c35c0ee.js";import"./vdirs.9c42edfb.js";import"./@juggle.37ed2144.js";import"./css-render.d5050412.js";import"./@emotion.6322e2ae.js";import"./treemate.80cdf2c2.js";import"./date-fns-tz.851ed5df.js";import"./async-validator.fb49d0f5.js";import"./lodash-es.5f1bdab1.js";import"./dexie.78e6a997.js";import"./lodash.f91bfcd2.js";import"./nprogress.5b68415b.js";import"./@icon-park.b1426ebe.js";const gt=k({__name:"IntervalLineChart",props:{componentId:null,propValue:null},setup(y){const r=y;b("mydark",M);const n=I(),d=D(null);let t=null,p=[],u,a=[];z(()=>h(this,null,function*(){yield l(),O(),clearInterval(u),u=setInterval(w,r.propValue.interval)}));const l=()=>h(this,null,function*(){let o=null;try{o=JSON.parse(r.propValue.data)}catch(e){S.warning(e.message)}if(o){const e=r.propValue.history;try{yield v(e,o)}catch(i){if(console.log(i),n.isEditMode){p=[],a=[];for(let s=0;s<100;s++)p.push(Math.round(Math.random()*600)),a.push(String(s))}}finally{yield w()}}}),c=o=>{const e=o[0],{width:i,height:s}=e.contentRect;t==null||t.resize({width:i,height:s})},V=()=>{let o=[],e=[];const i=a.length;for(let f=0;f<i;f++)r.propValue.highflag&&o.push(r.propValue.highflag),r.propValue.lowflag&&e.push(r.propValue.lowflag);let s={grid:{top:"10%",left:"3%",right:"4%",bottom:"10%",containLabel:!0},title:{text:r.propValue.title,subtext:r.propValue.subTitle,left:"center"},tooltip:{trigger:"item"},xAxis:{type:"category",data:a},yAxis:{type:"value"},series:[]},m=[{data:p,type:"line",symbol:"none",smooth:!0}];return e.length>0&&m.push({data:e,type:"line",symbol:"none"}),o.length>0&&m.push({data:o,type:"line",symbol:"none"}),s.series=m,s},v=(o,e)=>h(this,null,function*(){const i=r.propValue.method?r.propValue.method:"GET";let s;i==="GET"?s=yield x.get({url:o,params:e}):s=yield x.post({url:o,data:e});const f=JSON.parse(s)[0].Records;p=[],a=[],f.map(g=>(p.push(parseInt(g.Values._value)),a.push(g.Values._time),{time:g.Values._time,value:parseInt(g.Values._value)}))}),w=()=>h(this,null,function*(){let o=V(),e=null;try{e=JSON.parse(r.propValue.data)}catch(i){S.error(i.message)}if(e){const i=r.propValue.history;try{yield v(i,e)}catch(s){if(n.isEditMode){p=[],a=[];for(let m=0;m<100;m++)p.push(Math.round(Math.random()*600)),a.push(String(m))}}finally{o.series[0].data=p,t&&t.setOption({xAxis:{data:a},series:o.series})}}}),O=()=>{t=E(d.value,"mydark"),t.clear(),t.setOption(V())};let _=()=>{console.log("stop")};return n.isEditMode&&(_=A(()=>r.propValue,()=>{t&&(t.clear(),t.setOption(V()))},{deep:!0})),T(()=>{clearInterval(u),_(),t&&(t.clear(),t.dispose())}),(o,e)=>{const i=B("resize");return C((J(),N("div",{ref_key:"chartEl",ref:d},null,512)),[[i,c]])}}});export{gt as default};
