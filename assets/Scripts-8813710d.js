import{aR as k,d as E,aS as H,e as f,P as R,s as P,R as b,o as g,y as S,z as s,a as m,b as e,j as F,t as L,_ as T,J as K,ab as z,L as x,u as a,N as I,ah as J,aT as U,aF as A,O as w,U as O,T as D,S as $,aH as V,aU as W,ag as C,f as Y,c as G,F as j,i as q,ad as M,Y as Q,l as X,h as Z,an as tt,ao as B,w as et,aq as at,n as st,ap as nt}from"./index-3ca9a95a.js";import{N as ot,T as lt}from"./Toolbar-d2e46f66.js";import{N as ct}from"./li-7eb1ee67.js";import{N as dt}from"./Scrollbar-d93566bc.js";import"./ToolBar-9455cbaa.js";/* empty css                                                                */const rt=async r=>k.get({url:`/dataset/script/${r}/`}),it=async()=>k.get({url:"/dataset/script/"}),ut=async(r,t)=>k.put({url:`/dataset/script/${r}/`,data:{...t,id:r}}),pt=async r=>k.post({url:"/dataset/script/",data:r}),_t={class:"buttons"},vt={class:"footer"},ft=E({__name:"Editor",props:{data:{default:()=>({code:"",type:H.Javascript})},config:{default:()=>({height:"600px",tabSize:4,indentWithTab:!0,autofocus:!0,disabled:!1})},mode:{default:"use"}},emits:["update:data","change"],setup(r,{emit:t}){const c=r,_=f(!0),l=R(c.data),u=()=>{t("update:data",l),t("change",l)},d=f(null),i=()=>{const p=d.value.handleRedo;p&&p()},y=()=>{const p=d.value.handleUndo;p&&p()};return P(()=>c.data,()=>{c.data&&(l.code=c.data.code,l.type=c.data.type)}),(p,o)=>{const n=b("x-icon"),v=b("OCodeEditor");return g(),S(v,{ref_key:"cm",ref:d,value:l.code,"onUpdate:value":[o[0]||(o[0]=N=>l.code=N),u]},{"tool-bar":s(()=>[m("div",null,[m("div",_t,[e(n,{class:"item button",name:"back",onClick:y}),e(n,{class:"item button",name:"next",onClick:i})])])]),footer:s(()=>[m("div",vt,[m("div",{class:F(["saved-status",_.value?"save":"unsave"])},L(_.value?"已保存":"未保存"),3)])]),_:1},8,["value"])}}});const yt=T(ft,[["__scopeId","data-v-f4b67509"]]),mt={class:"static-data"},gt=E({__name:"Conetent",setup(r){const t=R({id:"",title:"",code:"",type:"Javascript"}),c=f(JSON.stringify({},null,"	")),_=o=>{c.value=o},l=async o=>{t.code=o.code,t.type=o.type};K(z.SRCIPT_KEY,async o=>{await i(o)});const u=f(""),d=()=>{const o=t.code?W("Javascript",t.code,["resp","options"]):void 0;if(o&&o.handler)try{u.value=JSON.stringify(o.handler(JSON.parse(c.value),{}),null,"	")}catch(n){u.value=n.message||n}else u.value=JSON.stringify(t.code,null,"	")},i=async o=>{try{const n=await rt(o);if(n.status===200){const v=n.data;t.id=v.id,t.id=v.id,t.title=v.name,t.code=v.code,t.type=v.type}}catch(n){x.log(n||n.message)}},y=async()=>{try{const o=await pt({code:t.code,name:t.title||"未命名",type:t.type});if(o.status===201){const n=o.data;t.id=n.id,t.title=n.name,t.code=n.code,t.type=n.type,x.info("数据保存成功")}else C.warning("数据保存失败")}catch{C.warning("数据保存失败")}},p=async()=>{try{(await ut(t.id,{code:t.code,name:t.title||"未命名",type:t.type})).status===200?x.info("数据更新成功"):C.warning("数据更新失败")}catch{C.warning("数据更新失败")}};return(o,n)=>{const v=b("x-icon"),N=b("OCodeEditor");return g(),S(a(O),null,{default:s(()=>[m("div",mt,[e(a(I),{value:t.title,"onUpdate:value":n[0]||(n[0]=h=>t.title=h),class:"title"},{prefix:s(()=>[e(v,{name:"code"})]),_:1},8,["value"]),e(a(J),null,{default:s(()=>[e(a(U),{class:"save"},{default:s(()=>[e(a(A),{type:"success",onClick:d},{default:s(()=>[w("运行")]),_:1})]),_:1})]),_:1}),e(a(J),null,{default:s(()=>[e(a(U),{class:"save"},{default:s(()=>[e(a(A),{onClick:n[1]||(n[1]=h=>t.id?p():y())},{default:s(()=>[w("保存")]),_:1})]),_:1})]),_:1})]),e(a(O),null,{default:s(()=>[e(a(D),null,{default:s(()=>[e(a($),{name:"脚本"},{default:s(()=>[e(yt,{data:t,class:"content","onUpdate:data":l},null,8,["data"])]),_:1}),e(a($),{name:"入参"},{default:s(()=>[e(N,{value:c.value,"onUpdate:value":[n[2]||(n[2]=h=>c.value=h),_]},null,8,["value"])]),_:1})]),_:1}),e(a(V),{"title-placement":"left"},{default:s(()=>[w(" 输出 ")]),_:1}),e(N,{value:u.value,"onUpdate:value":[n[3]||(n[3]=h=>u.value=h),l],class:"content",disable:!0},null,8,["value"])]),_:1})]),_:1})}}});const ht=T(gt,[["__scopeId","data-v-30b5acc5"]]),St={class:"rest-detail"},wt=E({__name:"History",setup(r){const t=f([]),c=async()=>{try{const l=await it();l.status===200&&(t.value=l.data)}catch(l){x.log(l||l.message)}},_=l=>{Q.emit(z.SRCIPT_KEY,l)};return Y(async()=>{await c()}),(l,u)=>(g(),S(a(O),{title:"脚本",size:"small"},{default:s(()=>[e(a(I),{placeholder:"请输入搜索条件"}),e(a(D),null,{default:s(()=>[e(a($),{name:"脚本列表"},{default:s(()=>[e(a(ot),{"align-text":""},{default:s(()=>[(g(!0),G(j,null,q(t.value,d=>(g(),S(a(ct),{key:d.id,class:"data-item",onClick:i=>_(d.id)},{default:s(()=>[m("div",St,[m("div",null,[e(a(M),{type:"success",style:{"font-weight":"800"}},{default:s(()=>[w(L(d.type===a(H).Javascript?"JS":"Py"),1)]),_:2},1024),w(" "+L(d.name),1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}});const Nt=T(wt,[["__scopeId","data-v-8dc1d999"]]),Ct=E({__name:"Scripts",setup(r){const t=f(!1),c=f(0),_=f(0),l=X(()=>({width:c.value+"px",height:_.value+"px"})),u=d=>{const{width:i,height:y}=d.contentRect;c.value=i,_.value=y};return(d,i)=>{const y=Z("resize");return g(),S(a(B),{class:"home"},{default:s(()=>[e(a(tt),{class:"header"},{default:s(()=>[e(a(lt))]),_:1}),e(a(B),{"has-sider":"","sider-placement":"right",class:"main"},{default:s(()=>[et((g(),S(a(at),{class:"content"},{default:s(()=>[e(a(dt),{"x-scrollable":"",style:st(l.value)},{default:s(()=>[e(ht)]),_:1},8,["style"])]),_:1})),[[y,u]]),e(a(nt),{class:"right",width:"240",collapsed:t.value,"native-scrollbar":!1,bordered:"","collapsed-width":35,"collapse-mode":"width","show-trigger":"arrow-circle",onCollapse:i[0]||(i[0]=p=>t.value=!0),onExpand:i[1]||(i[1]=p=>t.value=!1)},{default:s(()=>[e(Nt)]),_:1},8,["collapsed"])]),_:1})]),_:1})}}});const Ot=T(Ct,[["__scopeId","data-v-15420552"]]);export{Ot as default};
