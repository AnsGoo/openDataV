import{d as e,t as n,m as t,D as a,o,v as l,a as i,w as c,u as s,bJ as d,c8 as u,c as r,k as p,J as m,F as v,f,E as h,x as _,z as g,aj as y,C as x,am as b,q as C,a7 as w,a8 as k,y as S,b0 as T,r as D,a0 as I,aA as j,at as N,c9 as L,ap as B,I as E,p as R,az as z,au as M,ak as P,an as O,ca as $,aC as U,W as V,cb as A,cc as H,G as F,cd as X,a4 as Y,ce as q,cf as G,cg as W,b6 as K,ch as J,ci as Z,cj as Q,ck as ee,aq as ne,L as te,cl as ae,c2 as oe,cm as le,n as ie,c4 as ce,c3 as se,ag as de,ah as ue,cn as re,ad as pe,ae as me,co as ve,h as fe,cp as he,cq as _e,bP as ge,a1 as ye,bN as xe,a5 as be,cr as Ce,c5 as we,Z as ke,aB as Se,aF as Te,cs as De,ct as Ie,aZ as je,ab as Ne,cu as Le,aE as Be,g as Ee,cv as Re,B as ze,cw as Me,cx as Pe,cy as Oe,cz as $e,cA as Ue,c1 as Ve,a9 as Ae,Q as He}from"./index-40170f2c.js";import{p as Fe,s as Xe,a as Ye}from"./DynamicExtendContent-0f0b8eac.js";import{f as qe}from"./index.esm-9bbe18d8.js";import{s as Ge}from"./index.esm-01328638.js";import{i as We,d as Ke,L as Je}from"./LogoView-3805b629.js";import{Y as Ze}from"./Shape.esm-d754d2c7.js";import{p as Qe,i as en}from"./index.esm-44336620.js";import{u as nn,s as tn,g as an}from"./pages-55261304.js";import{Q as on,R as ln}from"./index-272ddad3.js";import{N as cn}from"./Form-4fc3c7ac.js";import{N as sn}from"./Space-244346c3.js";import{N as dn}from"./FormItem-a19e55a6.js";import{N as un}from"./Input-a9564eda.js";import"./index-63f72026.js";const rn=e({props:{slots:[Object,String]},setup:e=>()=>[n("div",{},e.slots)]}),pn=e({__name:"ToolBarItem",props:{label:{},action:{},disable:{type:Function,default:()=>!1},icon:{},divider:{type:Boolean},children:{},otherShow:{},isButton:{type:Boolean,default:!0}},setup(e){const f=e,h=t().appContext.components.XIcon,_=a((()=>We(f.icon)?n(h,{name:f.icon,size:24}):f.icon()));return(e,n)=>(o(),l(v,null,[i(s(u),{content:e.label},{default:c((()=>[i(s(d),{bordered:!1,size:"small",title:e.label,onClick:e.action},{default:c((()=>[i(s(_))])),_:1},8,["title","onClick"])])),_:1},8,["content"]),e.divider?(o(),r(s(p),{key:0,vertical:""})):m("",!0)],64))}}),mn={class:"tool-bar"},vn={class:"tool-bar-item"},fn={class:"tool-bar-middle"},hn={class:"tool-bar-item"},_n=g(e({__name:"ToolBar",props:{bars:{default:()=>[]}},setup(e){const n=e,t=a((()=>n.bars.filter((e=>"left"===e.location||void 0===e.location)))),i=a((()=>n.bars.filter((e=>"right"===e.location))));return(e,n)=>(o(),l("div",mn,[f("div",vn,[(o(!0),l(v,null,h(t.value,((e,n)=>(o(),r(pn,{key:n,action:e.action,label:e.label,divider:e.divider,icon:e.icon},null,8,["action","label","divider","icon"])))),128))]),f("div",fn,[_(e.$slots,"default",{},void 0,!0)]),f("div",hn,[(o(!0),l(v,null,h(i.value,((e,n)=>(o(),r(pn,{key:n,action:e.action,label:e.label,divider:e.divider,icon:e.icon},null,8,["action","label","divider","icon"])))),128))])]))}}),[["__scopeId","data-v-b5c85cf0"]]),gn=g(e({__name:"Area",setup(e){const n=y(),t=x(),i=a((()=>n.hidden)),c=a((()=>n.style.left)),s=a((()=>n.style.top)),d=a((()=>n.style.width)),u=a((()=>n.style.height)),r=b((()=>t.activeComponent),(()=>{n.components.length>0&&n.setHidden()})),p=()=>{n.compose(),n.setHidden()},v=()=>{n.flushLeft(),n.setHidden()},f=()=>{n.flushRight(),n.setHidden()},h=()=>{n.flushTop(),n.setHidden()},_=()=>{n.flushBottom(),n.setHidden()},g=()=>{n.flushRow(),n.setHidden()},T=()=>{n.flushColumn(),n.setHidden()},D=()=>{n.batchDeleteComponent(n.components),n.setHidden()},I=()=>[{text:"组合",subText:"",disable:!n.canCompose,handler:p},{divider:!0},{text:"删除",subText:"Ctrl + Delete",disable:n.components.length<=0,handler:D},{divider:!0},{text:"左对齐",subText:"",handler:v},{text:"右对齐",subText:"",handler:f},{text:"顶对齐",subText:"",handler:h},{text:"底对齐",subText:"",handler:_},{divider:!0},{text:"水平对齐",subText:"",handler:g},{text:"垂直对齐",subText:"",handler:T}];return C((()=>{r&&r()})),(e,n)=>{const t=w("contextmenu");return i.value?k((o(),l("div",{key:0,style:S({left:c.value+"px",top:s.value+"px",width:d.value+"px",height:u.value+"px"}),class:"area"},null,4)),[[t,I]]):m("",!0)}}}),[["__scopeId","data-v-6997463e"]]),yn={},xn={class:"grid",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},bn=[T('<defs><pattern id="smallGrid" width="7.236328125" height="7.236328125" patternUnits="userSpaceOnUse"><path d="M 7.236328125 0 L 0 0 0 7.236328125" fill="none" stroke="rgba(207, 207, 207, 0.3)" stroke-width="1"></path></pattern><pattern id="grid" width="36.181640625" height="36.181640625" patternUnits="userSpaceOnUse"><rect width="36.181640625" height="36.181640625" fill="url(#smallGrid)"></rect><path d="M 36.181640625 0 L 0 0 0 36.181640625" fill="none" stroke="rgba(186, 186, 186, 0.5)" stroke-width="1"></path></pattern></defs><rect width="100%" height="100%" fill="url(#grid)"></rect>',2)];const Cn=g(yn,[["render",function(e,n){return o(),l("svg",xn,bn)}]]),wn={class:"mark-line"},kn=e({__name:"MarkLine",setup(e){const n=x(),t=D([]),a=I(["xt","xc","xb","yl","yc","yr"]),i=D(3),c=I({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),s=e=>{t.value.push(e)},d=()=>{Object.keys(c).forEach((e=>{c[e]=!1}))};j("move",(e=>{u(e.isDownward,e.isRightward)})),j(N.DRAG_STOP,(()=>{d()}));const u=(e,a)=>{const o=n.componentData;if(n.activeComponent){const{top:l,left:i,right:c,bottom:s}=L(n.activeComponent.positionStyle),u=(c-i)/2,v=(s-l)/2;d(),o.forEach((o=>{if(o==n.activeComponent)return;const d=L(o.positionStyle),{top:f,left:h,bottom:_,right:g}=d,y=(g-h)/2,x=(_-f)/2,b={top:[{isNearly:r(l,f),lineNode:t.value[0],line:"xt",dragShift:f,lineShift:f},{isNearly:r(s,f),lineNode:t.value[0],line:"xt",dragShift:f-(s-l||0),lineShift:f},{isNearly:r((l||0)+v,f+x),lineNode:t.value[1],line:"xc",dragShift:f+x-v,lineShift:f+x},{isNearly:r(l,_),lineNode:t.value[2],line:"xb",dragShift:_,lineShift:_},{isNearly:r(s,_),lineNode:t.value[2],line:"xb",dragShift:_-(s-l||0),lineShift:_}],left:[{isNearly:r(i,h),lineNode:t.value[3],line:"yl",dragShift:h,lineShift:h},{isNearly:r(c,h),lineNode:t.value[3],line:"yl",dragShift:h-(c-i||0),lineShift:h},{isNearly:r((i||0)+u,h+y),lineNode:t.value[4],line:"yc",dragShift:h+y-u,lineShift:h+y},{isNearly:r(i,g),lineNode:t.value[5],line:"yr",dragShift:g,lineShift:g},{isNearly:r(c,g),lineNode:t.value[5],line:"yr",dragShift:g-(c-i||0),lineShift:g}]},C=[],{rotate:w}=n.activeComponent.style;Object.keys(b).forEach((e=>{b[e].forEach((t=>{if(!t.isNearly)return;const a=0!=w?p(e,t,{width:c-i,height:s-l}):t.dragShift;n.activateComponentStyle(["position",e],a),t.lineNode.style[e]=`${t.lineShift}px`,C.push(t.line)}))})),C.length&&m(C,e,a)}))}},r=(e,n)=>Math.abs(e-n)<=i.value,p=(e,t,a)=>{const{width:o,height:l}=n.activeComponent.style;return"top"==e?Math.round(t.dragShift-(l-a.height)/2):Math.round(t.dragShift-(o-a.width)/2)},m=(e,n,t)=>{t?e.includes("yr")?c.yr=!0:e.includes("yc")?c.yc=!0:e.includes("yl")&&(c.yl=!0):e.includes("yl")?c.yl=!0:e.includes("yc")?c.yc=!0:e.includes("yr")&&(c.yr=!0),n?e.includes("xb")?c.xb=!0:e.includes("xc")?c.xc=!0:e.includes("xt")&&(c.xt=!0):e.includes("xt")?c.xt=!0:e.includes("xc")?c.xc=!0:e.includes("xb")&&(c.xb=!0)};return(e,n)=>(o(),l("div",wn,[(o(!0),l(v,null,h(a,(e=>k((o(),l("div",{key:e,ref_for:!0,ref:s,class:E(["line",e.includes("x")?"xline":"yline"])},null,2)),[[B,c[e]||!1]]))),128))]))}}),Sn=e({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(e,{emit:n}){const t=e,a=n,i=I({canvasContext:null});let c=1;const s=D(null);R((()=>{c=t.ratio||window.devicePixelRatio||1,d(),u(c),r(c)}));const d=()=>{i.canvasContext=s.value&&s.value.getContext("2d")},u=e=>{if(s.value){s.value.width=t.width*e,s.value.height=t.height*e;const n=i.canvasContext;n&&(n.font=12*e+'px -apple-system,\n                "Helvetica Neue", ".SFNSText-Regular",\n                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",\n                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif',n.lineWidth=1,n.textBaseline="middle")}},r=e=>{const n={scale:t.scale,width:t.width,height:t.height,palette:t.palette,ratio:e};i.canvasContext&&((e,n,t,a,o,l)=>{const{scale:i,width:c,height:s,ratio:d,palette:u}=o,{bgColor:r,fontColor:p,shadowColor:m,longfgColor:v,shortfgColor:f}=u;if(e.scale(d,d),e.clearRect(0,0,c,s),e.fillStyle=r,e.fillRect(0,0,c,s),a){const o=(t-n)*i,d=a*i;e.fillStyle=m,l?e.fillRect(o,0,d,3*s/8):e.fillRect(0,o,3*c/8,d)}const h=(e=>e<=.25?40:e<=.5?20:e<=1?10:e<=2?5:e<=4?2:1)(i),_=h*i,g=10*h,y=g*i,x=Math.floor(n/h)*h,b=Math.floor(n/g)*g,C=(x-n)/h*_,w=(b-n)/g*y,k=n+Math.ceil((l?c:s)/i);e.beginPath(),e.fillStyle=p,e.strokeStyle=v;for(let S=b,T=0;S<k;S+=g,T++){const n=w+T*y+.5;l?e.moveTo(n,0):e.moveTo(0,n),e.save(),l?e.translate(n,.4*s):e.translate(.4*c,n),l||e.rotate(-Math.PI/2),e.scale(.83/d,.83/d),e.fillText(S.toString(),4*d,7*d),e.restore(),l?e.lineTo(n,9*s/16):e.lineTo(9*c/16,n)}e.stroke(),e.closePath(),e.beginPath(),e.strokeStyle=f;for(let S=x,T=0;S<k;S+=h,T++){const n=C+T*_+.5;l?e.moveTo(n,0):e.moveTo(0,n),S%g!=0&&(l?e.lineTo(n,s/4):e.lineTo(c/4,n))}e.stroke(),e.closePath(),e.setTransform(1,0,0,1,0,0)})(i.canvasContext,t.start,t.selectStart,t.selectLength,n,!t.vertical)};b((()=>t.start),(()=>r(c))),b([()=>t.width,()=>t.height],(()=>{u(c),r(c)}));const p=(e,n)=>{const o=t.vertical?e.offsetY:e.offsetX,l=(i=o,c=t.start,s=t.scale,Math.round(c+i/s));var i,c,s;switch(n){case"click":a("onAddLine",l);break;case"enter":a("update:valueNum",l),a("update:showIndicator",!0);break;default:a("update:valueNum",l)}};return(e,n)=>(o(),l("canvas",{ref_key:"canvas",ref:s,class:"ruler",onClick:n[0]||(n[0]=e=>p(e,"click")),onMouseenter:n[1]||(n[1]=e=>p(e,"enter")),onMousemove:n[2]||(n[2]=e=>p(e,"move")),onMouseleave:n[3]||(n[3]=n=>e.$emit("update:showIndicator",!1))},null,544))}}),Tn=g(e({__name:"RulerLine",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(e,{emit:n}){const t=e,i=n,c=D(0),s=D(!0);R((()=>{c.value=t.value}));const d=a((()=>{const e=(c.value-t.start)*t.scale;(e=>{s.value=e>=0})(e);const n=e+"px";return t.vertical?{top:n}:{left:n}})),u=a((()=>{var e,n;const a=`1px ${(null==(e=t.palette)?void 0:e.lineBoardStyle)||"dashed"} ${null==(n=t.palette)?void 0:n.lineColor}`,o=t.vertical?{borderTop:a}:{borderLeft:a};return{cursor:t.isShowReferLine?t.vertical?"ns-resize":"ew-resize":"none",...o}})),r=a((()=>t.vertical?{left:t.thick+"px"}:{top:t.thick+"px"})),p=e=>{e.stopPropagation();const n=t.vertical?e.clientY:e.clientX,a=c.value;i("onMouseDown");const o=e=>{const o=t.vertical?e.clientY:e.clientX;c.value=Math.round(a+(o-n)/t.scale)},l=()=>{i("onRelease",c.value,t.index),document.removeEventListener("mousemove",o,!0),document.removeEventListener("mouseup",l)};document.addEventListener("mousemove",o,!0),document.addEventListener("mouseup",l)},m=()=>[{text:"删除",subText:"",handler:()=>{i("onRemove",t.index)}}];return(e,n)=>{const t=w("contextmenu");return k((o(),l("div",{class:"line",style:S([d.value,u.value]),onMousedown:p},[f("div",{class:"action",style:S(r.value)},[f("span",{class:E({value:!0,"is-vertical":e.vertical})},z(c.value),3)],4)],36)),[[B,s.value],[t,m]])}}}),[["__scopeId","data-v-723b9f5d"]]),Dn={class:"lines"},In={class:"value"},jn=g(e({__name:"RulerWrapper",props:{scale:{},ratio:{},thick:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},palette:{},canvasHeight:{},canvasWidth:{},vertical:{type:Boolean,default:!0},width:{default:200},height:{default:200},start:{default:0}},setup(e,{expose:n}){M((e=>({"78b9ecbb":m.value,fecde09c:_.value})));const t=e,c=D(!1),s=D(0),d=D([]),u=a((()=>t.vertical?"v-container":"h-container"));n({clearLines:()=>{d.value=[]}});const p=a((()=>{const e={width:`calc(100% - ${t.thick}px)`,height:`${t.thick+1}px`,left:`${t.start}px`},n={width:`${t.thick&&t.thick+1}px`,height:`calc(100% - ${t.thick}px)`,top:`${t.start}px`};return t.vertical?n:e})),m=a((()=>t.vertical?"100vh":`${t.canvasHeight}px`)),_=a((()=>t.vertical?`${t.canvasWidth}px`:"100vw")),g=a((()=>{var e,n;const a=(s.value-(t.start||0))*t.scale,o=t.vertical?"top":"left",l=t.vertical?"borderBottom":"borderLeft";return{[o]:a+"px",[l]:`1px ${(null==(e=t.palette)?void 0:e.lineBoardStyle)||"dashed"} ${null==(n=t.palette)?void 0:n.lineColor}`}})),y=e=>{d.value.push(e)},x=(e,n)=>{const a=e-(t.start||0),o=(t.vertical?t.height||200:t.width||200)/t.scale;a<0||a>o?b(n):d.value[n]=e},b=e=>{d.value.splice(e,1)};return(e,n)=>(o(),l("div",{class:E(u.value),style:S(p.value)},[i(Sn,{valueNum:s.value,"onUpdate:valueNum":n[0]||(n[0]=e=>s.value=e),showIndicator:c.value,"onUpdate:showIndicator":n[1]||(n[1]=e=>c.value=e),vertical:e.vertical,scale:e.scale,width:e.width,height:e.height,start:e.start,ratio:e.ratio,"select-start":e.selectStart,"select-length":e.selectLength,palette:e.palette,onOnAddLine:y},null,8,["valueNum","showIndicator","vertical","scale","width","height","start","ratio","select-start","select-length","palette"]),k(f("div",Dn,[(o(!0),l(v,null,h(d.value,((n,t)=>(o(),r(Tn,{key:n+t,index:t,value:n|0,scale:e.scale,start:e.start,thick:e.thick,palette:e.palette,vertical:e.vertical,"is-show-refer-line":e.isShowReferLine,onOnRemove:b,onOnRelease:x},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"])))),128))],512),[[B,e.isShowReferLine]]),k(f("div",{class:"indicator",style:S(g.value)},[f("div",In,z(s.value),1)],4),[[B,c.value]])],6))}}),[["__scopeId","data-v-ff8e2e66"]]),Nn={id:"mb-ruler",class:"style-ruler mb-ruler"},Ln=g(e({__name:"Index",props:{scale:{default:1},ratio:{default:0},thick:{default:16},palette:{},startX:{},startY:{},width:{default:200},height:{default:200},shadow:{}},setup(e){const n=e,t=D(null),c=D(null),s=D(!0),d=()=>{var e,n;null==(e=t.value)||e.clearLines(),null==(n=c.value)||n.clearLines(),s.value=!0},u=()=>[{text:"显示辅助线",subText:"",disable:s.value,handler:()=>s.value=!0},{text:"隐藏辅助线",subText:"",disable:!s.value,handler:()=>s.value=!1},{text:"清空辅助线",subText:"",disable:!s.value,handler:d}],r=a((()=>function e(n,t){return Object.keys(n).forEach((a=>{a&&n.hasOwnProperty(a)&&("object"==typeof t.key?n[a]=e(n[a],t[a]):t.hasOwnProperty(a)&&(n[a]=t[a]))})),n}({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#37d4cf",lineBoardStyle:"dashed",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},n.palette||{})));return(e,n)=>{var a,d,p,m;const v=w("contextmenu");return k((o(),l("div",Nn,[i(jn,{ref_key:"HRulerWrapperRef",ref:c,vertical:!1,width:e.width,height:16,"canvas-height":e.height,"canvas-width":e.width,"is-show-refer-line":s.value,thick:e.thick,ratio:e.ratio??0,start:e.startX,"select-start":(null==(a=e.shadow)?void 0:a.x)||0,"select-length":(null==(d=e.shadow)?void 0:d.width)||0,scale:e.scale,palette:r.value},null,8,["width","canvas-height","canvas-width","is-show-refer-line","thick","ratio","start","select-start","select-length","scale","palette"]),i(jn,{ref_key:"VRulerWrapperRef",ref:t,vertical:!0,width:16,height:e.height,"canvas-height":e.height,"canvas-width":e.width,"is-show-refer-line":s.value,thick:e.thick,ratio:e.ratio??0,start:e.startY,"select-start":(null==(p=e.shadow)?void 0:p.y)||0,"select-length":(null==(m=e.shadow)?void 0:m.height)||0,scale:e.scale,palette:r.value},null,8,["height","canvas-height","canvas-width","is-show-refer-line","thick","ratio","start","select-start","select-length","scale","palette"])])),[[v,u]])}}}),[["__scopeId","data-v-1deec1f6"]]),Bn=g(e({__name:"Ruler",props:{width:{},height:{},isShowReferLine:{type:Boolean}},setup(e){const n={h:[],v:[]};return(e,t)=>(o(),r(s(Ln),{thick:20,scale:1,width:e.width,height:e.height,startX:0,startY:0,lines:n,isShowReferLine:e.isShowReferLine},null,8,["width","height","isShowReferLine"]))}}),[["__scopeId","data-v-0fd54461"]]),En=g(e({__name:"Editor",setup(e){const n=y(),t=P(),d=x(),u=e=>V(e,["top","left","width","height","rotate"]),p=()=>{d.clearCanvas()},f=(e,n)=>{const a=document.querySelector("#editor").getBoundingClientRect(),o=n.pageY-a.top,l=n.pageX-a.left;t.paste(!0,l,o)},_=()=>[{text:"粘贴",subText:"Ctrl + V",handler:f},{text:"清空画布",subText:"",handler:p}];R((()=>{O.debug("进入编辑模式"),d.setEditMode($.EDIT),document.addEventListener("paste",L),document.addEventListener("copy",N)})),C((()=>{O.debug("进入预览模式"),d.setEditMode($.PREVIEW),document.removeEventListener("paste",L),document.removeEventListener("copy",N),d.clearCanvas()}));const g=a((()=>d.componentData)),b=a((()=>d.canvasStyleData)),T=a((()=>d.activeComponent)),j=a((()=>{const e=U(b.value.background),n={...b.value,...e};return V(n,["width","height","backgroundImage","backgroundSize","backgroundColor"])})),N=()=>{d.activeComponent&&t.copy(d.activeComponent)},L=async e=>{if(e.clipboardData){const n=e.clipboardData.getData("text");try{const a=JSON.parse(n);await d.loadComponetClazz(a.component);const o=A(a);o&&(o.changeStyle(["position","top"],o.positionStyle.top+10),o.changeStyle(["position","left"],o.positionStyle.left+10),o.id=H(),t.copy(o),e.preventDefault(),e.stopPropagation(),d.appendComponent(o))}catch{}}},B=D(0),z=D(0),M=I({x:0,y:0}),K=D(null),J=D(!0),Z=e=>{var t;d.deactivateComponent(),e.preventDefault(),e.stopPropagation(),n.setHidden();const a=null==(t=K.value)?void 0:t.getBoundingClientRect();B.value=a.x,z.value=a.y;const o=e.clientX,l=e.clientY;M.x=(o-B.value)/d.scale,M.y=(l-z.value)/d.scale;const i=e=>{e.preventDefault(),e.stopPropagation(),e.clientX<o&&(M.x=(e.clientX-B.value)/d.scale),e.clientY<l&&(M.y=(e.clientY-z.value)/d.scale);const t=Math.abs(e.clientX-o)/d.scale,a=Math.abs(e.clientY-l)/d.scale;n.setPostion({left:M.x,top:M.y,width:t,height:a})},c=e=>{if(document.removeEventListener("mousemove",i),document.removeEventListener("mouseup",c),e.clientX==o&&e.clientY==l)return void n.setHidden();const t={left:Math.round(n.style.left),top:Math.round(n.style.top),right:n.style.left+n.style.width,bottom:n.style.top+n.style.height};n.setSelectComponents(t)};document.addEventListener("mousemove",i),document.addEventListener("mouseup",c)},Q=async e=>{e.preventDefault(),e.stopPropagation();const n=e.dataTransfer.getData("componentName");if(!n)return;await d.loadComponetClazz(n);const t=q({component:n});if(!t)return;t.dataMode===G.UNIVERSAL&&W(t);const a=document.querySelector("#editor").getBoundingClientRect(),o=(e.pageY-a.top)/d.scale,l=(e.pageX-a.left)/d.scale;t.changeStyle(["position","top"],o),t.changeStyle(["position","left"],l),d.appendComponent(t)},ee=e=>{e.preventDefault(),e.dataTransfer.dropEffect="copy"},ne=()=>{d.activeComponent||d.activateComponent(void 0)};return(e,n)=>{const t=w("contextmenu");return k((o(),l("div",{id:"editor",ref_key:"editor",ref:K,class:"editor edit",style:S(j.value),onMousedown:Y(Z,["left"]),onDrop:Q,onDragover:ee,onMouseup:ne},[i(Cn),i(Bn,{width:b.value.width,height:b.value.height,isShowReferLine:J.value},null,8,["width","height","isShowReferLine"]),(o(!0),l(v,null,h(g.value,((e,n)=>(o(),l(v,{key:e.id},[s(d).isEditMode&&e.display?(o(),r(s(Ze),{key:0,id:"shape"+e.id,defaultStyle:e.style,style:S(u(e.style)),active:e.id===(T.value||{}).id,info:e,class:E({lock:e.locked}),index:n},{default:c((()=>[(o(),r(F(e.component),{id:"component"+e.id,class:"component",style:S(s(X)(e)),component:e},null,8,["id","style","component"]))])),_:2},1032,["id","defaultStyle","style","active","info","class","index"])):m("",!0)],64)))),128)),i(kn),i(gn)],36)),[[t,_]])}}}),[["__scopeId","data-v-399e84e6"]]),Rn={class:"canvas o-scroll overflow-auto"},zn={class:"flex flex-row justify-end items-center w-full"},Mn={class:"flex-nowrap flex items-center"},Pn={style:{transition:"all 0.3s"}},On=g(e({__name:"Canvas",setup(e){M((e=>({"29f6269c":u.value})));const n=D(0),t=D(0),c=D(100),d=D("100%"),u=D("1"),r=x(),p=a((()=>({width:n.value+"px",height:t.value+"px"}))),m=e=>{const{width:a,height:o}=e.contentRect;n.value=a,t.value=o-100},v=e=>{d.value=`${e}%`,c.value=e,h(c.value)},h=Ke((e=>{r.setScale(e),u.value=(e/100).toFixed(2)}),300),_=D(null);function g(e){const{altKey:n,metaKey:t,deltaY:a}=e;let o=c.value;(n||t)&&(e.preventDefault(),10<o&&o<200?o=a>0?o+10:o-10:o<=10&&a>0?o+=10:o>=200&&a<0&&(o-=10),v(o))}return R((()=>{var e;null==(e=_.value)||e.addEventListener("wheel",g,!1)})),K((()=>{var e;null==(e=_.value)||e.removeEventListener("wheel",g,!1)})),(e,n)=>{const t=w("resize");return o(),l("div",{ref_key:"centerCanvas",ref:_,class:"middle"},[f("div",Rn,[f("div",{class:"edit",style:S(p.value)},[k(i(s(En),null,null,512),[[t,m]])],4)]),f("div",zn,[f("div",Mn,[f("span",Pn," 缩放:"+z(c.value)+" % ",1),i(s(J),{value:c.value,min:10,max:200,style:{width:"120px"},"onUpdate:value":n[0]||(n[0]=e=>v(e))},null,8,["value"])])])],512)}}}),[["__scopeId","data-v-11118e08"]]),$n={class:"absolute toggle z-50 bg-gray-100 dark:bg-stone-700"},Un=g(e({__name:"Toggle",props:{direction:{default:"left"},location:{default:"left"},x:{default:"50%"},y:{default:"50%"}},setup(e){M((e=>({"40e9dae6":d.value,"11d375cf":u.value,"28f1a554":p.value})));const n=Z.CheveronRight,t=Z.CheveronLeft,i=e,c=a((()=>(i.location,"left"===i.direction?"left":"right"))),d=a((()=>i.y||"50%")),u=a((()=>"left"===i.location?`calc(${i.x} - 10px)`:"unset")),p=a((()=>"right"===i.location?`calc(${i.x} - 10px)`:"unset"));return(e,a)=>(o(),l("span",$n,["right"===c.value?(o(),r(s(n),{key:0})):(o(),r(s(t),{key:1}))]))}}),[["__scopeId","data-v-ba437a9c"]]),Vn=["data-component"],An={class:"select-none"},Hn=e({__name:"ComponentItem",props:{component:{},name:{}},setup:e=>(e,n)=>(o(),l("div",{draggable:"true","data-component":e.component},[f("div",An,z(e.name),1)],8,Vn))}),Fn=g(e({__name:"ComponentList",props:{iscollapsed:{type:Boolean,default:!0}},setup(e){const a=D([]),l=x(),i=t().appContext.components.XIcon;R((()=>{(()=>{const e=l.components,t=l.componentMetaMap,o={};Object.keys(e).forEach((n=>{const t=new(0,e[n]),a=t.group;!a||!t.show||(o[a]||(o[a]=[]),o[a].push(t))})),t.forEach(((e,n)=>{const{category:t="OTHER"}=e;o[t]||(o[t]=[]),o[t].push({name:e.title,component:n})})),ee.forEach((e=>{var t;a.value.push({label:()=>e.name,key:e.key,icon:()=>n(i,{name:`${e.icon}`}),children:null==(t=o[e.key])?void 0:t.map((e=>({label:()=>n(Hn,{component:e.component,name:e.name,ondragstart:c}),key:e.component})))})}))})()}));const c=e=>{e.dataTransfer.setData("componentName",e.target.dataset.component)};return(e,n)=>(o(),r(s(Q),{options:a.value,accordion:!1,collapsed:!e.iscollapsed,class:"h-full o-scroll overflow-auto select-none"},null,8,["options","collapsed"]))}}),[["__scopeId","data-v-de28e9f2"]]),Xn={key:0,class:"flex flex-nowrap flex-row justify-between content-center items-center"},Yn={key:1,class:"flex flex-nowrap flex-row justify-between content-center items-center"},qn=e({__name:"LayerItem",props:{component:{},index:{},activeKey:{},mode:{default:"expand"},contextmenus:{}},emits:["select"],setup(e,{emit:n}){const t=e,a=n,c=x(),s=e=>e?"previewOpen":"previewClose";return(e,n)=>{const d=ne("x-icon"),u=w("contextmenu");return k((o(),l("div",{draggable:"true",onDragstart:n[0]||(n[0]=n=>((e,n)=>{var t;null==(t=e.dataTransfer)||t.setData("componentIndex",n),e.stopPropagation()})(n,e.index)),onDrop:n[1]||(n[1]=n=>((e,n)=>{var t;e.preventDefault(),e.stopPropagation();const o=null==(t=e.dataTransfer)?void 0:t.getData("componentIndex");if(!ae(o,n))return;const l=o.split("-").map((e=>Number(e))),i=c.getComponentByIndex(l),s=oe(i),d=n.split("-").map((e=>Number(e))),u=c.getComponentByIndex(d);if(s&&u&&n){const e=u.id;c.cutComponent(l[l.length-1],null==i?void 0:i.parent);const t=u.parent||void 0,o=(t?t.subComponents:c.componentData).findIndex((n=>n.id===e));c.insertComponent(o,s,t),a("select",n)}})(n,e.index)),onDragover:n[2]||(n[2]=n=>((e,n,a=!1)=>{e.preventDefault(),e.stopPropagation(),a&&n!==t.activeKey&&te.emit(N.ACTIVE_MENU,n)})(n,e.index,!0))},["Group"===e.component.component?(o(),l("div",Xn,[k(f("span",null,z(e.component.name||"分组"),513),[[B,"expand"===e.mode]]),i(d,{name:s(e.component.display),size:18},null,8,["name"])])):(o(),l("div",Yn,[k(f("span",null,z(e.component.name),513),[[B,"expand"===e.mode]]),i(d,{name:s(e.component.display),size:18},null,8,["name"])]))],32)),[[u,e.contextmenus]])}}}),Gn=e({__name:"SimpleLayerItem",props:{component:{},index:{},activeKey:{},mode:{default:"expand"},name:{},contextmenus:{}},emits:["select"],setup(e,{emit:n}){const t=e,a=n,l=x(),i=(e,n)=>{const t=e.split("-").map((e=>parseInt(e))),a=n.split("-").map((e=>parseInt(e))),o=t.length;for(let l=0;l<o;l++){if(t[l]>a[l])return n;if(t[l]<a[l])return l+1==o?(a[l]=a[l]-1,a.join("-")):n}return n};return(e,n)=>{const c=ne("x-icon"),s=w("contextmenu");return k((o(),r(c,{draggable:"true",size:18,name:e.name,onDragstart:n[0]||(n[0]=n=>((e,n)=>{var t;null==(t=e.dataTransfer)||t.setData("componentIndex",n),e.stopPropagation()})(n,e.index)),onDrop:n[1]||(n[1]=n=>((e,n)=>{var t;e.preventDefault(),e.stopPropagation();const o=null==(t=e.dataTransfer)?void 0:t.getData("componentIndex"),c=i(o,n),s=o.split("-").map((e=>Number(e))),d=l.getComponentByIndex(s),u=l.cutComponent(s[s.length-1],null==d?void 0:d.parent);if(u&&c){const e=o.split("-").map((e=>Number(e))),t=l.getComponentByIndex(e);l.insertComponent(e[e.length-1],u,t),a("select",n)}})(n,e.index)),onDragover:n[2]||(n[2]=n=>((e,n,a=!1)=>{e.preventDefault(),e.stopPropagation(),a&&n!==t.activeKey&&te.emit(N.ACTIVE_MENU,n)})(n,e.index,!0))},null,8,["name"])),[[s,e.contextmenus]])}}}),Wn=g(e({__name:"Layer",props:{iscollapsed:{type:Boolean,default:!0}},setup(e){const t=x(),l=P(),i=le(),c={};ee.map((e=>{c[e.key]=e.icon}));const d=a((()=>t.componentData)),u=e=>{const n=e.split("-").map((e=>Number(e))),a=t.getComponentByIndex(n);a&&t.activateComponent(a,e)},p=D([]),m=(e,t,a)=>{for(let o=0;o<t.length;o++){const l=t[o],i=v(o,e);if(l.group===ie.CONTAINER){const e=[];a.push({label:()=>n(qn,{component:l,index:i,contextmenus:()=>_(i),onclick:()=>u(i)}),key:i,icon:()=>n(Gn,{name:"container",component:l,index:i,contextmenus:()=>_(i),onclick:()=>u(i)}),children:m(i,l.subComponents||[],e)})}else a.push({label:()=>n(qn,{component:l,index:i,contextmenus:()=>_(i)}),key:i,icon:()=>n(Gn,{name:`${c[l.group]}`,component:l,index:i,contextmenus:()=>_(i),onclick:()=>u(i)})})}return a},v=(e,n)=>n?`${n}-${e}`:e.toString(),f=async e=>{var n;u(e);const a=e.split("-").map((e=>Number(e)));t.topComponent(a[a.length-1],null==(n=t.activeComponent)?void 0:n.parent)},h=async e=>{var n;u(e);const a=e.split("-").map((e=>Number(e)));t.bottomComponent(a[a.length-1],null==(n=t.activeComponent)?void 0:n.parent)},_=e=>{var n,a,o;const i=e.split("-").map((e=>parseInt(e)));return[{text:"复制",subText:"Ctrl + C",handler:()=>(e=>{const n=e.split("-").map((e=>Number(e))),a=oe(t.getComponentByIndex(n));a&&l.copy(a)})(e)},{text:"粘贴",subText:"Ctrl + V",handler:()=>(e=>{const n=e.split("-").map((e=>Number(e))),a=t.getComponentByIndex(n);if(l.copyData){const e=oe(l.copyData);e.id=H(),t.insertComponent(n[n.length-1],e,null==a?void 0:a.parent)}})(e)},{text:"剪切",subText:"Ctrl + X",handler:()=>(e=>{const n=e.split("-").map((e=>Number(e))),a=t.getComponentByIndex(n),o=t.cutComponent(n[n.length-1],null==a?void 0:a.parent);o&&l.copy(o)})(e)},{text:"拆分",subText:"",disable:"Group"!==(null==(n=t.getComponentByIndex(e.split("-").map((e=>Number(e)))))?void 0:n.component),handler:()=>t.decompose()},{text:"删除",subText:"",handler:()=>(async e=>{var n;u(e);const a=e.split("-").map((e=>Number(e)));t.removeComponent(a[a.length-1],null==(n=t.activeComponent)?void 0:n.parent)})(e)},{divider:!0},{text:"置于顶层",handler:()=>f(e),children:[{text:"置于顶层",handler:()=>f(e)},{text:"上移一层",handler:()=>(async e=>{var n;u(e);const a=e.split("-").map((e=>Number(e)));t.upComponent(a[a.length-1],null==(n=t.activeComponent)?void 0:n.parent)})(e)}]},{text:"置于底层",handler:()=>h(e),children:[{text:"置于底层",handler:()=>h(e)},{text:"下移一层",handler:()=>(async e=>{var n;u(e);const a=e.split("-").map((e=>Number(e)));t.downComponent(a[a.length-1],null==(n=t.activeComponent)?void 0:n.parent)})(e)}]},{divider:!0},{text:"显示",disable:null==(a=t.getComponentByIndex(i))?void 0:a.display,subText:"",handler:()=>(e=>{u(e);const n=e.split("-").map((e=>Number(e))),a=t.getComponentByIndex(n);a&&a.setVisible(!0)})(e)},{text:"隐藏",disable:!(null!=(o=t.getComponentByIndex(i))&&o.display),subText:"",handler:()=>(e=>{u(e);const n=e.split("-").map((e=>Number(e))),a=t.getComponentByIndex(n);a&&a.setVisible(!1)})(e)}]};return b((()=>t.componentData),(()=>{const e=t.componentData;p.value=[],p.value=m("",e,[])}),{deep:!0,immediate:!0}),(e,n)=>d.value.length>0?(o(),r(s(Q),{key:0,class:"h-full o-scroll overflow-auto",options:p.value,"root-indent":1,indent:12,collapsed:!e.iscollapsed,"onUpdate:value":u},null,8,["options","collapsed"])):(o(),r(s(i),{key:1}))}}),[["__scopeId","data-v-50db99e2"]]),Kn=e=>(de("data-v-dc0130b6"),e=e(),ue(),e),Jn={class:"left o-scroll"},Zn={class:"flex-nowrap flex flex-row items-center"},Qn=Kn((()=>f("span",{class:"inline-block"},"组件",-1))),et={class:"flex-nowrap flex flex-row items-center"},nt=Kn((()=>f("span",{class:"inline-block"},"图层",-1))),tt=g(e({__name:"SideBar",emits:["update:iscollapsed"],setup(e,{emit:n}){M((e=>({"153d49f8":h.value})));const t=D("components"),d=n,u=e=>{d("update:iscollapsed",!1),t.value=e},p=e=>{t.value=e},v=D(!0),h=a((()=>v.value?"18rem":"4rem")),_=a((()=>v.value?"left":"right"));return(e,n)=>{const a=ne("x-icon");return o(),l("div",Jn,[i(Un,{direction:_.value,x:h.value,location:"left",onClick:n[0]||(n[0]=e=>v.value=!v.value)},null,8,["direction","x"]),v.value?(o(),r(s(se),{key:0,value:t.value,"onUpdate:value":[n[1]||(n[1]=e=>t.value=e),n[2]||(n[2]=e=>{t.value=e})],style:S({width:h.value})},{default:c((()=>[i(s(ce),{name:"components","display-directive":"show:lazy"},{label:c((()=>[f("div",Zn,[i(a,{name:"components",class:"inline-block"}),Qn])])),default:c((()=>[i(Fn,{class:"components"})])),_:1}),i(s(ce),{name:"layer","display-directive":"show:lazy"},{label:c((()=>[f("div",et,[i(a,{name:"layers",class:"inline-block"}),nt])])),default:c((()=>[i(Wn,{class:"layers"})])),_:1})])),_:1},8,["value","style"])):(o(),r(s(se),{key:1,value:t.value,"onUpdate:value":[n[5]||(n[5]=e=>t.value=e),u]},{default:c((()=>["components"===t.value?(o(),r(s(ce),{key:0,name:"components"},{label:c((()=>[i(a,{name:"components",onClick:n[3]||(n[3]=e=>p("layer"))})])),default:c((()=>[i(Fn,{iscollapsed:v.value,class:"h-full components"},null,8,["iscollapsed"])])),_:1})):"layer"===t.value?(o(),r(s(ce),{key:1,name:"layer"},{label:c((()=>[i(a,{name:"layers",onClick:n[4]||(n[4]=e=>p("components"))})])),default:c((()=>[i(Wn,{iscollapsed:v.value},null,8,["iscollapsed"])])),_:1})):m("",!0)])),_:1},8,["value"]))])}}}),[["__scopeId","data-v-dc0130b6"]]),at=e({__name:"AttrList",props:{curComponent:{}},setup(e){const n=e,t=x(),l=a((()=>n.curComponent.defaultViewType)),i=a((()=>u())),c=a((()=>n.curComponent?n.curComponent.propFromValue:[])),d=(e,a)=>{n.curComponent&&t.setComponentPropValue(n.curComponent,e,a)},u=()=>{const e={common:{name:n.curComponent.name,component:n.curComponent.component,id:n.curComponent.id}};return n.curComponent&&n.curComponent.propValue&&Object.assign(e,n.curComponent.propValue),e};return(e,n)=>(o(),r(s(re),{config:c.value,data:i.value,mode:l.value,onChange:d},null,8,["config","data","mode"]))}}),ot=e({__name:"Canvas",setup(e){const n=x(),t=a((()=>n.canvasStyleConfig.formItems)),l=a((()=>n.canvasStyleConfig.mode)),i=a((()=>n.globalOption)),c=(e,t)=>{n.setCanvasStyle(e,t)};return(e,n)=>(o(),r(s(re),{config:t.value,data:i.value,mode:l.value,onChange:c},null,8,["config","data","mode"]))}});function lt(e){return"function"==typeof e||"[object Object]"===Object.prototype.toString.call(e)&&!ge(e)}const it=e({props:{curComponent:{type:Object,required:!0}},emits:["change"],setup(e){const n=pe(),t=me(),a=D("DEMO"),o=D(null);b((()=>e.curComponent),(async n=>{if(n){const n=e.curComponent.dataConfig;n&&(a.value=n.type)}}),{deep:!0,immediate:!0});const l=D([]);R((()=>{Object.keys(n.componentPlugins).forEach((e=>{const t=n.componentPlugins[e];l.value.push({label:t.name,value:t.type})}));const t=e.curComponent.dataConfig;t&&(a.value=t.type)}));const c=()=>{const t=n.getPlugin(a.value);if(t){const n=t.component;return i(n,{slotter:e.curComponent,handler:t.handler},null)}return le("未发现相应的数据插件")},s=()=>{if(!o.value)return;const n=t.getPlugin(o.value),a=n?n.component:le("未发现相应的脚本插件");return i(a,{slotter:e.curComponent},null)},d=()=>i(be,{size:"small",labelPlacement:"top"},{default:()=>[i(ye,{prop:"dataType",label:"数据类型"},{default:()=>[i(xe,{value:a.value,"onUpdate:value":e=>a.value=e,placeholder:"请选择数据类型",options:l.value,onUpdateValue:e=>(e=>{a.value=e})(e),clearable:!0},null)]}),c()]}),u=()=>i(be,{size:"small",labelPlacement:"top"},{default:()=>[i(ye,{prop:"scriptType",label:"脚本类型"},{default:()=>[i(xe,{value:o.value,"onUpdate:value":e=>o.value=e,placeholder:"请选择脚本类型",options:t.allScriptType,onUpdateValue:e=>(e=>{o.value=e})(e),clearable:!0},null)]}),s()]});return()=>e.curComponent.dataMode||e.curComponent.dataIntegrationMode===G.UNIVERSAL?(()=>{let n,t,a,o;switch(e.curComponent.defaultViewType){case ve.COLLAPSE:return i(_e,{accordion:!0},{default:()=>[i(he,{title:"数据选择",name:"dataType"},lt(n=d())?n:{default:()=>[n]}),i(he,{title:"脚本配置",name:"scriptOptions"},lt(t=u())?t:{default:()=>[t]})]});case ve.CARD:return i(v,null,[i(fe,{title:"数据选择",style:{marginBottom:"0.25rem"}},lt(a=d())?a:{default:()=>[a]}),i(fe,{title:"脚本配置",style:{marginBottom:"0.25rem"}},lt(o=u())?o:{default:()=>[o]})]);case ve.FORM:return i("div",{style:{padding:"0 1rem"}},[i(p,{"title-placement":"left",style:{marginTop:"0px",marginBottom:"0px"}},{default:()=>["数据选择"]}),d(),i(p,{"title-placement":"left",style:{marginTop:"0px",marginBottom:"0px"}},{default:()=>["脚本配置"]}),u()])}})():le("未发现数据配置项")}}),ct=e({__name:"StyleGrid",props:{curComponent:{}},setup(e){const n=e,t=x(),l=a((()=>n.curComponent.defaultViewType)),i=["top","left","width","height","rotate"],c=D({...n.curComponent.style}),d=a((()=>n.curComponent?n.curComponent.styleFormValue:[])),u=Ke(((e,a)=>{if(n.curComponent)if("position"===e[0]&&i.includes(e[1])){const o=n.curComponent.parent;t.syncComponentLocation({[e[1]]:a},o,!0),o&&t.resizeAutoComponent(o)}else t.setComponentStyle(n.curComponent,e,a)}),300);b((()=>n.curComponent.id),(()=>{n.curComponent&&n.curComponent.id&&(c.value=oe(n.curComponent.style))}),{immediate:!0,deep:!0});const p=Ke((()=>{Object.assign(c.value,n.curComponent.positionStyle)}),200);return b((()=>n.curComponent.positionStyle),(()=>{n.curComponent&&n.curComponent.id&&p()}),{deep:!0}),(e,n)=>(o(),r(s(re),{config:d.value,data:c.value,mode:l.value,flat:!0,onChange:s(u)},null,8,["config","data","mode","onChange"]))}}),st={class:"right o-scroll"},dt={key:0},ut={class:"flex-nowrap flex flex-row items-center"},rt={class:"inline-block"},pt={class:"attr-list o-scroll"},mt={class:"flex-nowrap flex flex-row items-center"},vt={class:"inline-block"},ft={class:"attr-list o-scroll"},ht={class:"flex-nowrap flex flex-row items-center"},_t={class:"inline-block"},gt={class:"attr-list o-scroll"},yt={class:"flex-nowrap flex flex-row items-center"},xt={class:"attr-list"},bt={class:"flex-nowrap flex flex-row items-center"},Ct={class:"attr-list"},wt={key:1},kt={class:"m-2 text-center"},St=g(e({__name:"SideBar",emits:["update:iscollapsed"],setup(e,{emit:d}){M((e=>({"58bf05b8":y.value})));const u=t().appContext.components.XIcon,p=D("attr"),m=x(),_=d,g=D(!0),y=a((()=>g.value?"18rem":"4rem")),b=a((()=>g.value?"right":"left")),C=a((()=>m.activeComponent)),w=D("canvas"),T=a((()=>m.activeComponent?[{label:"样式",key:"4",icon:()=>n(u,{name:"textStyle",onClick:()=>I("style")})},{label:"属性",key:"2",icon:()=>n(u,{name:"attr",onClick:()=>I("attr")})},{label:"数据",key:"3",icon:()=>n(u,{name:"data",onClick:()=>I("data")})}]:[{label:"画布",key:"1",icon:()=>n(u,{name:"canvas",onClick:()=>I("canvas")})},{label:"数据",key:"2",icon:()=>n(u,{name:"data",onClick:()=>I("data")})}])),I=e=>{_("update:iscollapsed",!0),p.value=e};return(e,n)=>(o(),l("div",st,[i(s(Un),{x:y.value,location:"right",direction:b.value,onClick:n[0]||(n[0]=e=>g.value=!g.value)},null,8,["x","direction"]),g.value?(o(),l("div",dt,[C.value?(o(),r(s(se),{key:0,value:p.value,"onUpdate:value":[n[1]||(n[1]=e=>p.value=e),n[2]||(n[2]=e=>{p.value=e})],style:S({width:y.value})},{default:c((()=>[i(s(ce),{name:"style"},{label:c((()=>[f("div",ut,[i(s(u),{name:"textStyle",class:"inline-block"}),k(f("span",rt,"样式",512),[[B,g.value]])])])),default:c((()=>[f("div",pt,[i(s(ct),{curComponent:C.value},null,8,["curComponent"])])])),_:1}),i(s(ce),{name:"attr"},{label:c((()=>[f("div",mt,[i(s(u),{name:"attr",class:"inline-block"}),k(f("span",vt,"属性",512),[[B,g.value]])])])),default:c((()=>[f("div",ft,[i(s(at),{curComponent:C.value},null,8,["curComponent"])])])),_:1}),i(s(ce),{name:"data"},{label:c((()=>[f("div",ht,[i(s(u),{name:"data",class:"inline-block"}),k(f("span",_t,"数据",512),[[B,g.value]])])])),default:c((()=>[f("div",gt,[i(s(it),{curComponent:C.value},null,8,["curComponent"])])])),_:1})])),_:1},8,["value","style"])):(o(),r(s(se),{key:1,value:w.value,"onUpdate:value":[n[3]||(n[3]=e=>w.value=e),n[4]||(n[4]=e=>{w.value=e})]},{default:c((()=>[i(s(ce),{name:"canvas"},{label:c((()=>[f("div",yt,[i(s(u),{name:"canvas"}),k(f("span",null,"画布",512),[[B,g.value]])])])),default:c((()=>[f("div",xt,[i(ot)])])),_:1}),i(s(ce),{name:"data"},{label:c((()=>[f("div",bt,[i(s(u),{name:"data"}),k(f("span",null,"数据",512),[[B,g.value]])])])),default:c((()=>[f("div",Ct,[i(s(Ce))])])),_:1})])),_:1},8,["value"]))])):(o(),l("div",wt,[(o(!0),l(v,null,h(T.value,((e,n)=>(o(),l("div",{key:n,class:"h-full o-scroll overflow-auto flex flex-nowrap flex-col hover:scale-110"},[f("div",kt,[(o(),r(F(e.icon)))])])))),128))]))]))}}),[["__scopeId","data-v-c44b8c93"]]),Tt={class:"tool-bar-title"},Dt=g(e({__name:"Toolbar",props:{toolbars:{default:()=>[]}},setup(e){const n=x();return(e,t)=>e.toolbars.length>0?(o(),r(s(_n),{key:0,bars:e.toolbars,class:"w-full"},{default:c((()=>[f("div",Tt,z(s(n).name),1)])),_:1},8,["bars"])):m("",!0)}}),[["__scopeId","data-v-82fff061"]]),It={class:"main h-fit flex-col flex flex-nowrap"},jt={class:"w-full h-14 align-middle"},Nt={class:"content flex flex-nowrap flex-row"},Lt=g(e({__name:"Designer",props:{toolbars:{default:()=>[]}},setup(e,{expose:n}){const t=we(),a=x();return ke("HOOKS",Se({useProp:Ge,useData:qe})),n({setLayoutData:e=>{a.setLayoutData(e)}}),C((()=>{a.clearCanvas()})),(e,n)=>{var a,c,d,u;return o(),l("div",It,[f("div",jt,[i(s(Dt),{toolbars:e.toolbars},null,8,["toolbars"])]),f("div",Nt,[null!=(a=s(t))&&a.left?(o(),r(s(rn),{key:0,slots:null==(c=s(t))?void 0:c.left()},null,8,["slots"])):(o(),r(s(tt),{key:1})),i(On,{class:"canvas border border-gray-500"}),null!=(d=s(t))&&d.right?(o(),r(s(rn),{key:2,slots:null==(u=s(t))?void 0:u.right()},null,8,["slots"])):(o(),r(s(St),{key:3}))])])}}}),[["__scopeId","data-v-e6790e23"]]),Bt={id:"2946854",name:"方向",font_family:"iconfont",css_prefix_text:"icon-",description:"",glyphs:[{icon_id:"11291350",name:"组",font_class:"zu",unicode:"e854",unicode_decimal:59476},{icon_id:"1817751",name:"柱形图",font_class:"zhuxingtu",unicode:"e626",unicode_decimal:58918},{icon_id:"3868284",name:"仪表盘",font_class:"yibiaopan",unicode:"eb67",unicode_decimal:60263},{icon_id:"4354243",name:"图表-饼图",font_class:"tubiao-bingtu",unicode:"eb95",unicode_decimal:60309},{icon_id:"4354246",name:"图表-卡片",font_class:"tubiao-qiapian",unicode:"eb96",unicode_decimal:60310},{icon_id:"4354248",name:"图表-折线图",font_class:"tubiao-zhexiantu",unicode:"eb97",unicode_decimal:60311},{icon_id:"4906240",name:"按钮组",font_class:"anniuzu",unicode:"e782",unicode_decimal:59266},{icon_id:"5383645",name:"导航",font_class:"daohang",unicode:"e77d",unicode_decimal:59261},{icon_id:"5961366",name:"列表",font_class:"liebiao",unicode:"ec6b",unicode_decimal:60523},{icon_id:"5971297",name:"采煤机",font_class:"caimeiji",unicode:"e603",unicode_decimal:58883},{icon_id:"7040619",name:"其他",font_class:"qita",unicode:"e63b",unicode_decimal:58939},{icon_id:"7556180",name:"定制",font_class:"dingzhi",unicode:"e609",unicode_decimal:58889},{icon_id:"9752796",name:"基础",font_class:"jichu",unicode:"e60f",unicode_decimal:58895},{icon_id:"9921108",name:"chart",font_class:"chartt",unicode:"e60a",unicode_decimal:58890},{icon_id:"14475731",name:"装饰装修",font_class:"zhuangshizhuangxiu",unicode:"e6a6",unicode_decimal:59046},{icon_id:"16562592",name:"温度计",font_class:"wenduji",unicode:"e6de",unicode_decimal:59102},{icon_id:"22712019",name:"条形进度图",font_class:"tiaoxingjindutu",unicode:"e66b",unicode_decimal:58987},{icon_id:"22761375",name:"边框",font_class:"biankuang",unicode:"e6b7",unicode_decimal:59063},{icon_id:"22885432",name:"进度图",font_class:"jindutu",unicode:"f24b",unicode_decimal:62027},{icon_id:"124495",name:"警告",font_class:"jinggao1",unicode:"e601",unicode_decimal:58881},{icon_id:"1846445",name:"预警灯",font_class:"yujingdeng",unicode:"e67f",unicode_decimal:59007},{icon_id:"2239579",name:"自动系统警告灯",font_class:"zidongxitongjinggaodeng1",unicode:"e605",unicode_decimal:58885},{icon_id:"4988542",name:"预警",font_class:"yujing1",unicode:"e644",unicode_decimal:58948},{icon_id:"9974390",name:"预警",font_class:"yujing3",unicode:"e6fe",unicode_decimal:59134},{icon_id:"10817515",name:"警告灯",font_class:"jinggaodeng",unicode:"e64b",unicode_decimal:58955},{icon_id:"14151833",name:"报警",font_class:"baojing1",unicode:"e630",unicode_decimal:58928},{icon_id:"16965399",name:"警告灯",font_class:"hong",unicode:"e60d",unicode_decimal:58893},{icon_id:"20379044",name:"预警灯",font_class:"yujingdeng1",unicode:"e623",unicode_decimal:58915},{icon_id:"23819336",name:"报警 警告 预警 警告灯",font_class:"a-baojingjinggaoyujingjinggaodeng",unicode:"e628",unicode_decimal:58920},{icon_id:"24312218",name:"light",font_class:"light",unicode:"e63a",unicode_decimal:58938},{icon_id:"24614518",name:"告警灯",font_class:"gaojingdeng9",unicode:"e664",unicode_decimal:58980},{icon_id:"25567211",name:"警告灯",font_class:"jinggaodeng1",unicode:"e613",unicode_decimal:58899},{icon_id:"12041083",name:"预警",font_class:"yujing5",unicode:"e671",unicode_decimal:58993},{icon_id:"577357",name:"删除",font_class:"shanchu",unicode:"e74b",unicode_decimal:59211},{icon_id:"1986988",name:"删除",font_class:"shanchu1",unicode:"e625",unicode_decimal:58917},{icon_id:"12795401",name:"首页",font_class:"shouye",unicode:"e62d",unicode_decimal:58925},{icon_id:"201556",name:"查看",font_class:"chakan",unicode:"e600",unicode_decimal:58880},{icon_id:"201638",name:"编辑",font_class:"bianji",unicode:"e602",unicode_decimal:58882},{icon_id:"11729723",name:"复制",font_class:"fuzhi",unicode:"e608",unicode_decimal:58888},{icon_id:"7269302",name:"首页-默认",font_class:"shouye-moren",unicode:"e619",unicode_decimal:58905},{icon_id:"658044",name:"解锁",font_class:"jiesuo",unicode:"e669",unicode_decimal:58985},{icon_id:"10097949",name:"旋转",font_class:"xuanzhuan",unicode:"e680",unicode_decimal:59008},{icon_id:"374774",name:"开关",font_class:"kaiguan",unicode:"e61f",unicode_decimal:58911},{icon_id:"122162",name:"时钟",font_class:"clock",unicode:"e63e",unicode_decimal:58942},{icon_id:"1242185",name:"反馈信息",font_class:"fankuixinxi",unicode:"e660",unicode_decimal:58976},{icon_id:"2468505",name:"37类建筑修理x16",font_class:"leijianzhuxiulix",unicode:"e695",unicode_decimal:59029},{icon_id:"11747267",name:"时间",font_class:"weibiaoti-",unicode:"e618",unicode_decimal:58904},{icon_id:"14794143",name:"sds_第37类 建筑修理",font_class:"sds_di37leijianzhuxiuli",unicode:"e61e",unicode_decimal:58910},{icon_id:"17762035",name:"联动控制",font_class:"liandongkongzhi",unicode:"e624",unicode_decimal:58916},{icon_id:"18165278",name:"锁,密码,开锁,解锁",font_class:"unlock-full",unicode:"e882",unicode_decimal:59522},{icon_id:"288554",name:"ascend",font_class:"ascend",unicode:"e6b4",unicode_decimal:59060},{icon_id:"288556",name:"falling",font_class:"falling",unicode:"e6b6",unicode_decimal:59062},{icon_id:"815867",name:"按钮-关",font_class:"buttonoff",unicode:"e614",unicode_decimal:58900},{icon_id:"815872",name:"按钮-开",font_class:"buttonon",unicode:"e615",unicode_decimal:58901},{icon_id:"2674878",name:"箭头 上",font_class:"jiantoushang",unicode:"e62c",unicode_decimal:58924},{icon_id:"2674928",name:"箭头 右",font_class:"jiantouyou",unicode:"e632",unicode_decimal:58930},{icon_id:"2674929",name:"箭头 下",font_class:"jiantouxia",unicode:"e633",unicode_decimal:58931},{icon_id:"7594038",name:"24gl-next",font_class:"24gl-next",unicode:"ea6b",unicode_decimal:60011},{icon_id:"7594046",name:"24gl-pauseCircle",font_class:"24gl-pauseCircle",unicode:"ea6f",unicode_decimal:60015},{icon_id:"7594068",name:"24gl-previous",font_class:"24gl-previous",unicode:"ea73",unicode_decimal:60019},{icon_id:"7594086",name:"24gl-stopCircle",font_class:"24gl-stopCircle",unicode:"ea79",unicode_decimal:60025},{icon_id:"10268256",name:"按钮_开启",font_class:"anniu_kaiqi",unicode:"e659",unicode_decimal:58969},{icon_id:"10268257",name:"按钮_关闭",font_class:"anniu_guanbi",unicode:"e65b",unicode_decimal:58971},{icon_id:"25807963",name:"箭头 上",font_class:"jiantoushangzuo-copy",unicode:"ec63",unicode_decimal:60515},{icon_id:"25808146",name:"向右2",font_class:"xiangzuo2-copy",unicode:"ec64",unicode_decimal:60516},{icon_id:"166602",name:"关闭播放",font_class:"guanbibofang",unicode:"e61d",unicode_decimal:58909},{icon_id:"577396",name:"向上3",font_class:"xiangshang3",unicode:"e76f",unicode_decimal:59247},{icon_id:"577401",name:"向下5",font_class:"xiangxia5",unicode:"e774",unicode_decimal:59252},{icon_id:"577403",name:"向右2",font_class:"xiangyou2",unicode:"e776",unicode_decimal:59254},{icon_id:"1159910",name:"右播放",font_class:"youbofang",unicode:"e62e",unicode_decimal:58926},{icon_id:"1159911",name:"左播放",font_class:"zuobofang",unicode:"e62f",unicode_decimal:58927},{icon_id:"1185945",name:"播放",font_class:"bofang2",unicode:"e606",unicode_decimal:58886},{icon_id:"1488892",name:"播放",font_class:"bofang5",unicode:"e607",unicode_decimal:58887},{icon_id:"1727559",name:"323向左交换",font_class:"xiangzuojiaohuan",unicode:"e8f8",unicode_decimal:59640},{icon_id:"1727561",name:"324向右交换",font_class:"xiangyoujiaohuan",unicode:"e8f9",unicode_decimal:59641},{icon_id:"2076218",name:"播放2",font_class:"bofang6",unicode:"e87c",unicode_decimal:59516},{icon_id:"7594051",name:"24gl-playCircle",font_class:"24gl-playCircle",unicode:"ea6e",unicode_decimal:60014},{icon_id:"11121478",name:"向上",font_class:"xiangshang7",unicode:"e63c",unicode_decimal:58940},{icon_id:"16388177",name:"播放",font_class:"bofang26",unicode:"e60e",unicode_decimal:58894},{icon_id:"18176557",name:"播放",font_class:"play1",unicode:"ea8d",unicode_decimal:60045},{icon_id:"24267227",name:"播放-快退",font_class:"bofang-kuaitui",unicode:"e68a",unicode_decimal:59018},{icon_id:"24267260",name:"播放09",font_class:"bofang09",unicode:"e690",unicode_decimal:59024},{icon_id:"24268374",name:"播放-快进",font_class:"bofang-kuaijin",unicode:"e6d8",unicode_decimal:59096},{icon_id:"25807740",name:"向上",font_class:"xiangxia7",unicode:"ec62",unicode_decimal:60514}]},Et={class:"icon-list"},Rt=["onClick"],zt=Ne(e({__name:"IconFont",setup(e){const n=a((()=>Bt.glyphs.map((e=>`icon-${e.font_class}`)))),t=D(!0),d=()=>{t.value=!1};return(e,a)=>(o(),r(De,null,{default:c((()=>[i(s(Te),{class:"show-card",show:t.value,preset:"card",title:`图标数量${n.value.length}`,style:{width:"50%","max-width":"800px"},onMaskClick:d,onClose:d,"onUpdate:show":a[0]||(a[0]=e=>t.value=!1)},{default:c((()=>[f("ul",Et,[(o(!0),l(v,null,h(n.value,(e=>(o(),l("li",{key:e,class:"dib",onClick:n=>(e=>{Ie(e),je.success(`复制图标: ${e}`)})(e)},[f("span",{class:E(`icon iconfont ${e}`)},null,2)],8,Rt)))),128))])])),_:1},8,["show","title"])])),_:1}))}}),[["__scopeId","data-v-b00749c8"]]),Mt=()=>{const e=i(zt,{},null),n=document.createElement("div"),t=document.querySelector("#app");Le(e,n),t?.appendChild(n)},Pt=e({__name:"SavePage",props:{index:{}},setup(e){const n=x(),t=e,a=D(!0),l=I({name:n.name,thumbnail:n.thumbnail}),d=I({name:[{required:!0,message:"请输入页面名称",trigger:"blur"}]}),u=async e=>{const{name:o,thumbnail:i}=l;if(!o)return void je.error("请输入页面名称");const c={name:o,thumbnail:i,canvasData:n.layoutData,canvasStyle:n.canvasStyleData,dataSlotters:n.dataSlotterData};if("update"===e)try{200===(await nn(t.index,c)).status&&(je.success("修改成功"),n.name!==o&&n.setName(o))}catch(s){je.error("保存失败，请导出到本地，并重新进入此页面")}finally{a.value=!1}else try{const e=await tn(c);201===e.status&&(je.success("保存成功"),await Re.push({name:"Editor",params:{index:e.data.id}}))}catch(s){je.error(`保存失败，失败信息:${s?.message||s}`)}finally{a.value=!1}};return(e,n)=>a.value?(o(),r(De,{key:0},{default:c((()=>[i(s(Te),{show:a.value,"mask-closable":!1,preset:"card",center:"",title:"保存当前布局",style:{width:"30%","min-width":"600px"},size:"medium","onUpdate:show":n[6]||(n[6]=e=>a.value=!1)},{footer:c((()=>[i(s(sn),null,{default:c((()=>[i(s(Be),{onClick:n[3]||(n[3]=e=>a.value=!1)},{default:c((()=>[Ee("取消")])),_:1}),e.index?(o(),r(s(Be),{key:1,type:"primary",onClick:n[5]||(n[5]=e=>u("update"))},{default:c((()=>[Ee("更新")])),_:1})):(o(),r(s(Be),{key:0,type:"primary",onClick:n[4]||(n[4]=e=>u("new"))},{default:c((()=>[Ee("新增")])),_:1}))])),_:1})])),default:c((()=>[i(s(cn),{model:l,rules:d,onSubmit:n[2]||(n[2]=Y((()=>{}),["prevent"]))},{default:c((()=>[i(s(dn),{label:"页面名称",prop:"name"},{default:c((()=>[i(s(un),{value:l.name,"onUpdate:value":n[0]||(n[0]=e=>l.name=e),placeholder:"请输入页面名称"},null,8,["value"])])),_:1}),i(s(dn),{label:"页面缩略图",prop:"thumbnail"},{default:c((()=>[i(s(un),{value:l.thumbnail,"onUpdate:value":n[1]||(n[1]=e=>l.thumbnail=e),placeholder:"请输入缩略图地址"},null,8,["value"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["show"])])),_:1})):m("",!0)}}),Ot=e=>{const n=i(Pt,{index:e},null),t=document.createElement("div");Le(n,t)},$t=e({__name:"ThemeIcon",setup(e){const n=ze("DarkTheme",a((()=>!0))),t=a((()=>n.value?"sun":"moon"));return(e,n)=>{const a=ne("x-icon");return o(),r(a,{name:t.value},null,8,["name"])}}}),Ut=Ve(),Vt=()=>{Ut.setNavTheme(Ut.darkTheme?"dark":"light"),Ut.setDarkTheme(!Ut.darkTheme),Ut.darkTheme?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark")};const At=e({__name:"View",setup(e){me().loadPlugins([Qe,en]),j(N.STDOUT,(e=>{const n=e;if("handle"===n.name){let e=je.info;"error"===n.type?e=je.error:"warn"===n.type&&(e=je.warning),e(n.message)}else{let e=console.info;"error"===n.type?e=console.error:"warn"===n.type&&(e=console.warn),e(n.message)}}));const t=x();pe().loadPlugins([on,ln,Fe,Xe,Ye]);const a=Ae(),l=function(e,t){return[{label:"首页",action:async n=>{await e.push({name:"Pages"})},icon:()=>n(Je,{width:"40px"}),divider:!0},{label:"保存",action:()=>Ot(t.params.index),icon:"save"},{label:"预览",action:n=>{const{href:t}=e.resolve("/preview");window.open(t,"_blank")},icon:"preview"},{label:"撤销",action:Me,icon:"back"},{label:"恢复",action:Pe,icon:"next"},{label:"导出",action:()=>Oe(t.params.index||""),icon:"download"},{label:"导入",action:$e,icon:"upload"},{label:"全屏",action:()=>{const e=document.querySelector("#editor");document.fullscreenEnabled&&e&&e.requestFullscreen()},icon:"fullScreen"},{label:"坐标",action:Ue,icon:"axis"},{label:"图标",action:Mt,icon:"cube",location:"right"},{label:"主题",action:Vt,icon:()=>n($t),location:"right"},{label:"GitHub",action:()=>{window.open("https://github.com/AnsGoo/openDataV","_blank")},icon:"github",location:"right"}]}(He(),a),i=D(null),c=Ve();R((async()=>{const e=a.params.index;e&&await d(e)}));const d=async e=>{const n=await an(e);n.data&&i.value.setLayoutData(n.data)};return b((()=>c.darkTheme),(()=>{t.darkTheme=c.darkTheme})),(e,n)=>(o(),r(s(Lt),{ref_key:"designer",ref:i,toolbars:s(l)},null,8,["toolbars"]))}});export{At as default};
