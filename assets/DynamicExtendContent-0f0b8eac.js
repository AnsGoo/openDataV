import{S as e,U as t,aH as a,d as n,V as s,aI as o,t as l,bI as r,c2 as i,r as d,am as c,aq as u,o as p,v as h,f as v,a as m,w as f,g,az as y,u as b,k as C,F as x,E as w,s as S,bJ as A,a0 as _,c as k,x as O,bN as U,c3 as E,c4 as T,I as D,h as I,c5 as R,D as P,p as N,a1 as F,bL as H,a2 as L,J as j,bK as M,a6 as J,ag as W,ah as V,q as $,L as q,aA as X,a5 as z,c6 as G,at as B,c7 as K,aE as Y,aZ as Z,ab as Q,af as ee,aa as te}from"./index-40170f2c.js";import{a as ae}from"./index-63f72026.js";import{N as ne}from"./Input-a9564eda.js";import{N as se,a as oe}from"./Space-244346c3.js";const le=e("input-group","\n display: inline-flex;\n width: 100%;\n flex-wrap: nowrap;\n vertical-align: bottom;\n",[t(">",[e("input",[t("&:not(:last-child)","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n "),t("&:not(:first-child)","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n margin-left: -1px!important;\n ")]),e("button",[t("&:not(:last-child)","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n ",[a("state-border, border","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n ")]),t("&:not(:first-child)","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n ",[a("state-border, border","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n ")])]),t("*",[t("&:not(:last-child)","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n ",[t(">",[e("input","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n "),e("base-selection",[e("base-selection-label","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n "),e("base-selection-tags","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n "),a("box-shadow, border, state-border","\n border-top-right-radius: 0!important;\n border-bottom-right-radius: 0!important;\n ")])])]),t("&:not(:first-child)","\n margin-left: -1px!important;\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n ",[t(">",[e("input","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n "),e("base-selection",[e("base-selection-label","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n "),e("base-selection-tags","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n "),a("box-shadow, border, state-border","\n border-top-left-radius: 0!important;\n border-bottom-left-radius: 0!important;\n ")])])])])])]),re=n({name:"InputGroup",props:{},setup(e){const{mergedClsPrefixRef:t}=s(e);return o("-input-group",le,t),{mergedClsPrefix:t}},render(){const{mergedClsPrefix:e}=this;return l("div",{class:`${e}-input-group`},this.$slots)}}),ie=async()=>ae.get({url:"/dataset/rest"}),de=async e=>ae.delete({url:`/dataset/rest/${e}/`}),ce=async e=>ae.get({url:`/dataset/static/${e}/`}),ue=async()=>ae.get({url:"/dataset/static/"}),pe=async e=>ae.post({url:`/dataset/static/${e}/`}),he=e=>(e?"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx":"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx").replace(/[xy]/g,(function(e){const t=16*Math.random()|0;return("x"==e?t:3&t|8).toString(16)})),ve=new r("scripts"),me=()=>({request:async e=>{const{headers:t,method:a,url:n,params:s,data:o}=e;let l=n;if("GET"===a.toUpperCase()){const e=Object.keys(JSON.parse(JSON.stringify(s))).map((e=>`${e}=${encodeURIComponent(s[e])}`));e.length>0&&(l=l+"?"+e.join("&"))}const r=await window.fetch(l,{headers:new Headers(t),method:a,body:fe(o,new Headers(t))});return{status:r.status,data:await r.json()}}});function fe(e,t){const a=t.get("Content-Type")||"applocation/json",n=JSON.parse(JSON.stringify(e));if(a.includes("applocation/json"))return Object.keys(n).length>0?JSON.stringify(n):void 0;if(a.includes("application/x-www-form-urlencoded")){const e=new FormData;return Object.keys(n).forEach((t=>e.append(t,n[t]))),e}return Object.keys(n).length>0?JSON.stringify(n):void 0}var ge=Object.defineProperty,ye=(e,t,a)=>(((e,t,a)=>{t in e?ge(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);let be=class{constructor(e,t){ye(this,"options"),ye(this,"requestInstance"),ye(this,"timer",0),this.options=e,this.requestInstance=t||me()}close(){clearInterval(this.timer)}async connect(e){const{otherConfig:t={isRepeat:!1,interval:3e3}}=this.options||{};if(t.isRepeat){const a=async()=>{const t=await this.getRespData();e(t)},n=3e3|t.interval;this.timer=setInterval(a,n)}else{const t=await this.getRespData();e(t)}}async getRespData(){const e={status:"FAILED",data:""};if(!this.options)return e;try{const t={url:this.options.url,method:this.options.method,headers:this.options.headers,params:this.options.params,data:this.options.data},a=await this.requestInstance.request(t);e.status="SUCCESS",e.data=a.data}catch(t){t.response||t.toJSON&&t.toJSON(),e.status="FAILED",e.data=t.stack||t.message}return e}async debug(e){this.connect(e)}toJSON(){return{options:i(this.options),type:"REST"}}};var Ce=(e=>(e.Accept="Accept",e.AcceptCH="Accept-CH",e.AcceptCHLifetime="Accept-CH-Lifetime",e.AcceptCharset="Accept-Charset",e.AcceptEncoding="Accept-Encoding",e.AcceptLanguage="Accept-Language",e.AcceptPatch="Accept-Patch",e.AcceptPost="Accept-Post",e.AcceptRanges="Accept-Ranges",e.AccessControlAllowCredentials="Access-Control-Allow-Credentials",e.AccessControlAllowHeaders="Access-Control-Allow-Headers",e.AccessControlAllowMethods="Access-Control-Allow-Methods",e.AccessControlAllowOrigin="Access-Control-Allow-Origin",e.AccessControlExposeHeaders="Access-Control-Expose-Headers",e.AccessControlMaxAge="Access-Control-Max-Age",e.AccessControlRequestHeaders="Access-Control-Request-Headers",e.AccessControlRequestMethod="Access-Control-Request-Method",e.Age="Age",e.Allow="Allow",e.AltSvc="Alt-Svc",e.Authorization="Authorization",e.CacheControl="Cache-Control",e.ClearSiteData="Clear-Site-Data",e.Connection="Connection",e.ContentDisposition="Content-Disposition",e.ContentDPR="Content-DPR",e.ContentEncoding="Content-Encoding",e.ContentLanguage="Content-Language",e.ContentLength="Content-Length",e.ContentLocation="Content-Location",e.ContentRange="Content-Range",e.ContentSecurityPolicy="Content-Security-Policy",e.ContentSecurityPolicyReportOnly="Content-Security-Policy-Report-Only",e.ContentType="Content-Type",e.Cookie="Cookie",e.CrossOriginEmbedderPolicy="Cross-Origin-Embedder-Policy",e.CrossOriginOpenerPolicy="Cross-Origin-Opener-Policy",e.CrossOriginResourcePolicy="Cross-Origin-Resource-Policy",e.Date="Date",e.DeviceMemory="Device-Memory",e.Digest="Digest",e.Deprecated="Deprecated",e.DNT="DNT",e.Downlink="Downlink",e.NonstandardDeprecated="Non-standardDeprecated",e.DPR="DPR",e.EarlyData="Early-Data",e.Experimental="Experimental",e.ECT="ECT",e.ETag="ETag",e.Expect="Expect",e.ExpectCT="Expect-CT",e.Expires="Expires",e.FeaturePolicy="Feature-Policy",e.Forwarded="Forwarded",e.From="From",e.Host="Host",e.IfMatch="If-Match",e.IfModifiedSince="If-Modified-Since",e.IfNoneMatch="If-None-Match",e.IfRange="If-Range",e.IfUnmodifiedSince="If-Unmodified-Since",e.KeepAlive="Keep-Alive",e.LargeAllocation="Large-Allocation",e.LastModified="Last-Modified",e.Link="Link",e.Location="Location",e.MaxForwards="Max-Forwards",e.NEL="NEL",e.Origin="Origin",e.Pragma="Pragma",e.ProxyAuthenticate="Proxy-Authenticate",e.ProxyAuthorization="Proxy-Authorization",e.Range="Range",e.Referer="Referer",e.ReferrerPolicy="Referrer-Policy",e.RetryAfter="Retry-After",e.RTT="RTT",e.SaveData="Save-Data",e.SecCHUA="Sec-CH-UA",e.SecCHUAArch="Sec-CH-UA-Arch",e.SecCHUABitness="Sec-CH-UA-Bitness",e.SecCHUAFullVersion="Sec-CH-UA-Full-Version",e.SecCHUAFullVersionList="Sec-CH-UA-Full-Version-List",e.SecCHUAMobile="Sec-CH-UA-Mobile",e.SecCHUAModel="Sec-CH-UA-Model",e.SecCHUAPlatform="Sec-CH-UA-Platform",e.SecCHUAPlatformVersion="Sec-CH-UA-Platform-Version",e.SecFetchDest="Sec-Fetch-Dest",e.SecFetchMode="Sec-Fetch-Mode",e.SecFetchSite="Sec-Fetch-Site",e.SecFetchUser="Sec-Fetch-User",e.SecGPC="Sec-GPC",e.SecWebSocketAccept="Sec-WebSocket-Accept",e.Server="Server",e.ServerTiming="Server-Timing",e.ServiceWorkerNavigationPreload="Service-Worker-Navigation-Preload",e.SetCookie="Set-Cookie",e.SourceMap="SourceMap",e.StrictTransportSecurity="Strict-Transport-Security",e.TE="TE",e.TimingAllowOrigin="Timing-Allow-Origin",e.Tk="Tk",e.Trailer="Trailer",e.TransferEncoding="Transfer-Encoding",e.Upgrade="Upgrade",e.UpgradeInsecureRequests="Upgrade-Insecure-Requests",e.UserAgent="User-Agent",e.Vary="Vary",e.Via="Via",e.ViewportWidth="Viewport-Width",e.WantDigest="Want-Digest",e.Warning="Warning",e.Width="Width",e.WWWAuthenticate="WWW-Authenticate",e.XContentTypeOptions="X-Content-Type-Options",e.Nontandard="Non-standard",e.XDNSPrefetchControl="X-DNS-Prefetch-Control",e.XForwardedFor="X-Forwarded-For",e.XForwardedHost="X-Forwarded-Host",e.XForwardedProto="X-Forwarded-Proto",e.XFrameOptions="X-Frame-Options",e.XXSSProtection="X-XSS-Protection",e))(Ce||{}),xe=(e=>(e.GET="GET",e.POST="POST",e.PUT="PUT",e.DELETE="DELETE",e.PATCH="PATCH",e.HEAD="HEAD",e.OPTIONS="OPTIONS",e.TRACE="TRACE",e.CONNECT="CONNECT",e))(xe||{});const we={class:"header flex flex-row flex-nowrap"},Se={class:"mb-0.5 flex-nowrap flex flex-row items-center justify-center"},Ae=(e,t)=>{const a=e.__vccOpts||e;for(const[n,s]of t)a[n]=s;return a},_e=Ae(n({__name:"DynamicKVForm",props:{value:{default:()=>[{key:"",value:"",disable:!1,id:he(),options:[]}]},title:{default:""},options:{}},emits:["update:value"],setup(e,{emit:t}){const a=e,n=t,s=d(a.value),o=(e,t,a)=>{s.value[e][t]=a,n("update:value",s.value)},l=e=>!e.startsWith(" ")&&!e.endsWith(" ");return c((()=>a.value),(()=>{a.value&&(s.value=a.value)})),(e,t)=>{const a=u("x-icon");return p(),h(x,null,[v("div",we,[m(b(C),{"title-placement":"left",class:"w-1/2"},{default:f((()=>[g(y(e.title),1)])),_:1}),m(b(C),{"title-placement":"right",style:{width:"50%"}},{default:f((()=>[m(a,{name:"add",color:"#18A058",class:"action",onClick:t[0]||(t[0]=e=>(()=>{const e=s.value.length;s.value.splice(e,0,{key:"",value:"",disable:!1,id:he()}),n("update:value",s.value)})())}),m(a,{name:"clear",color:"#F76560",class:"action",onClick:t[1]||(t[1]=e=>(s.value=[{key:"",value:"",disable:!1,id:he()}],void n("update:value",s.value)))}),m(a,{name:"edit",color:"#2080F0",class:"action",onClick:t[2]||(t[2]=e=>{n("update:value",s.value)})})])),_:1})]),(p(!0),h(x,null,w(s.value,((e,t)=>(p(),h("div",{key:e.id},[v("div",Se,[m(b(S),{class:"w-1/2",size:"small","input-props":{autocomplete:"disabled"},value:s.value[t].key,"allow-input":l,placeholder:`参数${t+1}`,"onUpdate:value":e=>o(t,"key",e)},null,8,["value","placeholder","onUpdate:value"]),m(b(S),{class:"w-1/2",size:"small",value:s.value[t].value,"allow-input":l,placeholder:`值${t+1}`,"onUpdate:value":e=>o(t,"value",e)},null,8,["value","placeholder","onUpdate:value"]),m(b(A),{size:"small",onClick:e=>(e=>{s.value[e].disable=!s.value[e].disable,n("update:value",s.value)})(t)},{icon:f((()=>[m(a,{name:e.disable?"close":"check",color:e.disable?"#333639":"#2080F0"},null,8,["name","color"])])),_:2},1032,["onClick"]),m(b(A),{size:"small",onClick:e=>(e=>{s.value.splice(e,1),0===s.value.length&&s.value.push({key:"",value:"",disable:!1,id:he()}),n("update:value",s.value)})(t)},{icon:f((()=>[m(a,{name:"delete",color:"#F76560"})])),_:2},1032,["onClick"])])])))),128))],64)}}}),[["__scopeId","data-v-a4ab8f18"]]),ke=e=>{const t={};for(const a of e)a.key&&!a.disable&&(t[a.key]=a.value);return t},Oe=e=>Object.keys(e).map((t=>({key:t,value:e[t],disable:!1,id:he()}))),Ue=e=>{const t=i(e);return{headers:ke(e.headers),params:ke(e.params),data:ke(e.data),method:t.method,url:t.url,otherConfig:t.otherConfig}},Ee={class:"rest-data"},Te={class:"flex flex-row mt-1"},De={class:"w-1/4"},Ie={class:"w-3/4"},Re={class:"headers"},Pe={class:"response"},Ne=Ae(n({__name:"RestDataView",props:{options:{default:()=>({method:xe.GET,url:"",headers:[{key:"",value:"",disable:!1,id:he()}],params:[{key:"",value:"",disable:!1,id:he()}],data:[{key:"",value:"",disable:!1,id:he()}],otherConfig:{isRepeat:!1,interval:1e3}})},mode:{default:"use"},dataInstance:{}},emits:["update:options","change"],setup(e,{emit:t}){const a=e,n=Object.keys(xe).map((e=>({label:e,value:e}))),s=Object.keys(Ce),o=t,l=_(a.options),r=d({status:0,data:"",afterData:"",headers:{}}),i=async()=>{var e;const t=e=>{r.value.status=e.status,r.value.data=JSON.stringify(e.data,null,"\t")};a.dataInstance?null==(e=a.dataInstance)||e.debug(t):new be(Ue(l)).debug(t)},c=()=>{o("change",l),o("update:options",l)};return(e,t)=>{const a=u("OCodeEditor");return p(),k(b(I),null,{default:f((()=>[v("div",Ee,[O(e.$slots,"data-select",{},void 0,!0)]),v("div",Te,[v("div",De,[m(b(U),{value:l.method,"onUpdate:value":t[0]||(t[0]=e=>l.method=e),options:b(n),"show-arrow":!0,onUpdateValue:c},null,8,["value","options"])]),v("div",Ie,[m(b(S),{value:l.url,"onUpdate:value":t[1]||(t[1]=e=>l.url=e),onUpdateValue:c},null,8,["value"])]),v("div",null,[m(b(A),{type:"primary",onClick:i},{default:f((()=>[g("调试")])),_:1})])]),v("div",null,[m(b(E),{value:"query","justify-content":"flex-start"},{default:f((()=>[m(b(T),{name:"query",label:"请求参数"},{default:f((()=>[m(_e,{value:l.params,"onUpdate:value":[t[2]||(t[2]=e=>l.params=e),c],title:"请求参数"},null,8,["value"])])),_:1}),m(b(T),{name:"data",label:"请求体"},{default:f((()=>[m(_e,{value:l.data,"onUpdate:value":[t[3]||(t[3]=e=>l.data=e),c],title:"请求体"},null,8,["value"])])),_:1}),m(b(T),{name:"headers",label:"请求头"},{default:f((()=>[v("div",Re,[m(_e,{value:l.headers,"onUpdate:value":[t[4]||(t[4]=e=>l.headers=e),c],title:"请求头",options:b(s)},null,8,["value","options"])])])),_:1})])),_:1})]),v("div",Pe,[m(b(C),{"title-placement":"left"},{default:f((()=>[g(" 请求响应 "),v("span",{class:D(["resp-code",r.value.status>=400?"resp-fail":"resp-success"])},y(r.value.status?r.value.status:""),3)])),_:1}),m(a,{value:r.value.data,height:"400px"},null,8,["value"])])])),_:3})}}}),[["__scopeId","data-v-b3170839"]]),Fe={class:"justify-center flex-row flex-nowrap flex items-center"},He={class:"text-green-700",style:{"font-weight":"800"}},Le=n({__name:"Pane",props:{slotter:{},index:{},handler:{}},setup(e){const t=e,a=R(),n=d(!1),s=P((()=>a.default?a.default()[0].type:Ne)),o=P((()=>t.slotter.dataConfig.dataInstance)),l=d({method:xe.GET,url:"/getRiskArea",headers:[{key:"",value:"",disable:!1,id:he()}],params:[{key:"",value:"",disable:!1,id:he()}],data:[{key:"",value:"",disable:!1,id:he()}],otherConfig:{isRepeat:!1,interval:1e3}}),r=()=>{u()},u=()=>{const e={type:"REST",dataInstance:new t.handler(Ue(l.value))};t.slotter&&t.slotter.changeDataConfig(e)};N((async()=>{t.slotter&&C()}));const C=()=>{var e;const a=t.slotter.dataConfig;if(a&&"REST"===a.type){const a=null==(e=t.slotter.dataConfig)?void 0:e.dataInstance;if(!a)return;const{options:n}=a.toJSON();Object.assign(l.value,(e=>{const t=i(e);return{headers:Oe(t.headers),params:Oe(t.params),data:Oe(t.data),method:t.method,url:t.url,otherConfig:t.otherConfig}})(n))}else Object.assign(l.value,{method:xe.GET,url:"",headers:[{key:"",value:"",disable:!1,id:he()}],params:[{key:"",value:"",disable:!1,id:he()}],data:[{key:"",value:"",disable:!1,id:he()}],otherConfig:{isRepeat:!1,interval:1e3}}),u()};return c((()=>t.slotter),(async e=>{e&&C()}),{immediate:!0}),(e,t)=>(p(),h(x,null,[m(b(F),{label:"动态数据","label-placement":"top",size:"small"},{default:f((()=>[v("div",Fe,[m(b(S),{value:l.value.url,"onUpdate:value":t[0]||(t[0]=e=>l.value.url=e),readonly:""},{prefix:f((()=>[v("span",He,y(l.value.method),1)])),_:1},8,["value"]),m(b(A),{type:"primary",onClick:t[1]||(t[1]=e=>n.value=!0)},{default:f((()=>[g(" 编辑 ")])),_:1})])])),_:1}),m(b(F),{label:"是否重复","label-placement":"top"},{default:f((()=>[m(b(H),{value:l.value.otherConfig.isRepeat,"onUpdate:value":[t[2]||(t[2]=e=>l.value.otherConfig.isRepeat=e),r]},null,8,["value"])])),_:1}),l.value.otherConfig.isRepeat?(p(),k(b(F),{key:0,label:"请求间隔","label-placement":"top"},{default:f((()=>[m(b(L),{value:l.value.otherConfig.interval,"onUpdate:value":[t[3]||(t[3]=e=>l.value.otherConfig.interval=e),r],min:300,step:100},{suffix:f((()=>[g(" ms ")])),_:1},8,["value"])])),_:1})):j("",!0),m(b(M),{show:n.value,"onUpdate:show":t[6]||(t[6]=e=>n.value=e),beforeClose:r},{default:f((()=>[m(b(I),{title:"动态数据",bordered:!1,size:"small",closable:"",role:"dialog","aria-modal":"true",onClose:t[5]||(t[5]=e=>n.value=!1)},{default:f((()=>[m(b(s),{options:l.value,"onUpdate:options":[t[4]||(t[4]=e=>l.value=e),r],dataInstance:o.value,onChange:r},null,8,["options","dataInstance"])])),_:1})])),_:1},8,["show"])],64))}});J(Le);var je=Object.defineProperty,Me=(e,t,a)=>(((e,t,a)=>{t in e?je(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const Je={class:"buttons flex flex-nowrap flex-row m-1"},We={class:"flex-row flex flex-nowrap justify-between"},Ve={class:"flex flex-nowrap flex-row align-middle items-center"},$e={key:0,class:"err-message"},qe={key:1,class:"info-message decoration-current"},Xe={class:"flex flex-nowrap flex-row justify-end align-middle items-center"},ze=(e=>(W("data-v-88a0010a"),e=e(),V(),e))((()=>v("div",{class:"lang"},"JSON",-1))),Ge=Ae(n({__name:"StaticDataView",props:{data:{default:""},title:{default:""},mode:{default:"use"},height:{default:"600px"},error:{},disabled:{type:Boolean,default:!1}},emits:["update:data","change"],setup(e,{emit:t}){const a=d(!0),n=e,s=d(null),o=t,l=e=>{a.value=!1},r=e=>{o("update:data",e),o("change",e)},i=()=>{o("update:data",n.data),o("change",n.data),a.value=!0};return(e,t)=>{const n=u("x-icon"),o=u("OCodeEditor");return p(),k(o,{ref_key:"cm",ref:s,value:e.data,mode:e.mode,disabled:e.disabled,"onUpdate:value":r,onChange:l},{"tool-bar":f((()=>[v("div",Je,[m(n,{class:"block ml-0.5 mr-0.5 hover:scale-110",name:"save",onClick:i})])])),footer:f((()=>[v("div",We,[v("div",Ve,[e.error?(p(),h("span",$e," 异常信息："+y(e.error),1)):(p(),h("span",qe,y(e.title?`数据名称：${e.title}`:""),1))]),v("div",Xe,[v("div",{class:D(["saved-status","decoration-current",a.value?"save":"unsave"])},y(a.value?"已保存":"未保存"),3),ze])])])),_:1},8,["value","mode","disabled"])}}}),[["__scopeId","data-v-88a0010a"]]),Be=n({__name:"DataView",props:{options:{default:()=>({data:""})},title:{default:""},mode:{default:"debug"}},emits:["update:options","dataChange"],setup(e,{emit:t}){const a=e,n=t,s=d(void 0),o=P((()=>a.options.data)),l=e=>{n("dataChange",e),s.value=void 0;try{JSON.parse(e)}catch{return void(s.value="语法错误")}};return(e,t)=>(p(),k(b(I),null,{default:f((()=>[v("div",null,[O(e.$slots,"data-select")]),m(Ge,{data:o.value,title:e.title,mode:e.mode,"onUpdate:data":l},null,8,["data","title","mode"])])),_:3}))}}),Ke={class:"justify-center flex-row flex-nowrap flex items-center"},Ye={type:"STATIC",name:"静态数据",component:J(n({__name:"Pane",props:{slotter:{},handler:{}},setup(e){const t=R(),a=P((()=>t.default?t.default()[0].type:Be)),n=e,s=d(!1),o=d({data:"[]"}),l=P((()=>{try{return JSON.stringify(JSON.parse(o.value.data||"[]"))}catch{return""}}));let r;N((async()=>{await i()}));const i=async()=>{const e=n.slotter.dataConfig;if(e&&"STATIC"===e.type){const e=e=>{o.value.data=JSON.stringify(e.data,null,"\t")};if(r&&r.close(),r=n.slotter.dataConfig.dataInstance,!r)return;r.debug(e)}else u()},u=()=>{const e={type:"STATIC",dataInstance:new n.handler({data:o.value.data})};n.slotter.changeDataConfig(e)},y=e=>{o.value.data=e,u()};return $((()=>{r&&r.close()})),c((()=>n.slotter),(async()=>{n.slotter&&await i()}),{immediate:!0}),(e,t)=>(p(),h(x,null,[m(b(F),{key:"title",label:"静态数据"},{default:f((()=>[v("div",Ke,[m(b(S),{value:l.value,readonly:!0,placeholder:"编辑请点击",onClick:t[0]||(t[0]=e=>s.value=!0)},null,8,["value"]),m(b(A),{type:"primary",onClick:t[1]||(t[1]=e=>s.value=!0)},{default:f((()=>[g(" 编辑 ")])),_:1})])])),_:1}),m(b(M),{show:s.value,"onUpdate:show":t[4]||(t[4]=e=>s.value=e)},{default:f((()=>[m(b(I),{title:"静态数据",bordered:!1,size:"small",role:"dialog","aria-modal":"true",closable:"",onClose:t[3]||(t[3]=e=>s.value=!1)},{default:f((()=>[m(b(a),{options:o.value,"onUpdate:options":t[2]||(t[2]=e=>o.value=e),mode:"use",hanlder:e.handler,onDataChange:y},null,8,["options","hanlder"])])),_:1})])),_:1},8,["show"])],64))}})),handler:class{constructor(e){Me(this,"data");const{data:t}=e||{};this.data=t||""}toJSON(){return{options:{data:this.data},type:"STATIC"}}async connect(e){e(await this.getRespData())}async getRespData(){const e={status:"SUCCESS",data:""};try{e.data=JSON.parse(this.data),e.status="SUCCESS"}catch{return e.status="FAILED",e}return e}async debug(e){e(await this.getRespData())}close(){}},useTo:"COMPONENT"};var Ze=Object.defineProperty,Qe=(e,t,a)=>(((e,t,a)=>{t in e?Ze(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);const et=n({__name:"SubDataView",props:{options:{default:()=>({channel:""})},title:{default:""},mode:{default:"debug"}},emits:["update:options","channelChange"],setup(e,{emit:t}){const a=d(e.options.channel),n=t,s=e=>{a.value=e,n("channelChange",e)};return(e,t)=>(p(),k(b(I),null,{default:f((()=>[v("div",null,[O(e.$slots,"data-select")]),m(b(z),null,{default:f((()=>[m(b(F),{key:"channel",label:"数据通道"},{default:f((()=>[m(b(S),{value:a.value,"onUpdate:value":[t[0]||(t[0]=e=>a.value=e),s]},null,8,["value"])])),_:1})])),_:1})])),_:3}))}}),tt={class:"justify-center flex-row flex-nowrap flex items-center"},at={type:"SUB",name:"订阅数据",component:J(n({__name:"Pane",props:{slotter:{},handler:{}},setup(e){const t=R(),a=P((()=>t.default?t.default()[0].type:et)),n=e,s=d(!1),o=d({channel:""});N((async()=>{await l()}));const l=async()=>{var e;const t=n.slotter.dataConfig;if(t&&"SUB"===t.type){const t=null==(e=n.slotter.dataConfig)?void 0:e.dataInstance,{options:a}=t.toJSON();o.value.channel=a.channel}else r()},r=()=>{if(!n.handler)return;const e={type:"SUB",dataInstance:new n.handler({channel:o.value.channel})};n.slotter.changeDataConfig(e)},i=e=>{o.value.channel=e,r()};return c((()=>n.slotter),(async()=>{n.slotter&&await l()}),{immediate:!0}),(e,t)=>(p(),h(x,null,[m(b(F),{key:"title",label:"订阅数据"},{default:f((()=>[v("div",tt,[m(b(S),{value:o.value.channel,"onUpdate:value":t[0]||(t[0]=e=>o.value.channel=e),readonly:!0,placeholder:"编辑请点击",onClick:t[1]||(t[1]=e=>s.value=!0)},null,8,["value"]),m(b(A),{type:"primary",onClick:t[2]||(t[2]=e=>s.value=!0)},{default:f((()=>[g(" 编辑 ")])),_:1})])])),_:1}),m(b(M),{show:s.value,"onUpdate:show":t[5]||(t[5]=e=>s.value=e)},{default:f((()=>[m(b(I),{title:"订阅通道",bordered:!1,size:"small",role:"dialog","aria-modal":"true",closable:"",onClose:t[4]||(t[4]=e=>s.value=!1)},{default:f((()=>[m(b(a),{options:o.value,"onUpdate:options":t[3]||(t[3]=e=>o.value=e),mode:"use",hanlder:e.handler,onChannelChange:i},null,8,["options","hanlder"])])),_:1})])),_:1},8,["show"])],64))}})),handler:class{constructor({channel:e}){Qe(this,"channel"),this.channel=e}toJSON(){return{options:{channel:this.channel||""},type:"STATIC"}}close(){this.channel&&q.off(this.channel)}async connect(e){this.channel&&X(this.channel,(t=>{e&&e({status:"SUCCESS",data:t},"SUB")}))}async debug(e){this.connect(e)}},useTo:["COMPONENT"]};var nt=Object.defineProperty,st=(e,t,a)=>(((e,t,a)=>{t in e?nt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[t]=a})(e,"symbol"!=typeof t?t+"":t,a),a);class ot{constructor(e,t){st(this,"options"),st(this,"wsInstance"),st(this,"timer",0),st(this,"acceptor"),st(this,"retryCount",0),st(this,"connector"),st(this,"debugAcceptor"),this.options=e,this.connector=t||WebSocket}close(){var e;null==(e=this.wsInstance)||e.close(),clearInterval(this.timer)}ping(){var e;const t=(null==(e=this.options)?void 0:e.timeout)||3e3;this.timer=setInterval((()=>{var e;null==(e=this.wsInstance)||e.send("ping")}),t)}send(e){var t;null==(t=this.wsInstance)||t.send(e)}async connect(e){this.acceptor=e,await this.wsconnect()}async wsconnect(){if(!this.options)return;this.wsInstance=new this.connector(this.options.url),this.wsInstance.addEventListener("open",(()=>{ve.info("wsOpen")}));this.wsInstance.addEventListener("message",(e=>{const t={status:"FAILED",data:""};try{const a=JSON.parse(e.data);t.data=a,t.status="SUCCESS"}catch(a){t.data=a.message?a.message:a}this.acceptor&&this.acceptor(t),this.debugAcceptor&&this.debugAcceptor(t)})),this.wsInstance.addEventListener("error",(e=>{ve.error("ws.ts Error"),this.options.isRetry&&(this.options.maxRetryCount<0||this.retryCount<this.options.maxRetryCount)&&this.reConnect()})),this.ping()}reConnect(){this.close(),this.wsconnect(),this.retryCount++}async debug(e){this.debugAcceptor=e}cancelDebug(){this.debugAcceptor=void 0}toJSON(){return{options:i(this.options),type:"WS"}}}const lt={class:"flex flex-col flex-nowrap"},rt={class:"flex flex-row flex-nowrap"},it=n({__name:"WebsocketView",props:{options:{default:()=>({url:"",message:"",timeout:3e3,isRetry:!1,maxRetryCount:0})},mode:{default:"use"},index:{},dataInstance:{}},emits:["update:options","change"],setup(e,{expose:t,emit:a}){const n=e,s=a,o=_(n.options),l=d({data:""});let r;const i=()=>{if(!n.dataInstance)return;r=n.dataInstance;r.debug((e=>{l.value.data=e.data}))},c=()=>{r.send(o.message)},h=()=>{s("change",o),s("update:options",o)};return t({close:()=>{r&&r.close()}}),$((()=>{r&&r.cancelDebug()})),(e,t)=>{const a=u("OCodeEditor");return p(),k(b(I),null,{default:f((()=>[v("div",lt,[O(e.$slots,"data-select")]),v("div",rt,[m(b(S),{value:o.url,"onUpdate:value":t[0]||(t[0]=e=>o.url=e),class:"flex-1",onUpdateValue:h},null,8,["value"]),v("div",null,[m(b(G),null,{default:f((()=>[m(b(A),{type:"primary",onClick:i},{default:f((()=>[g("链接")])),_:1}),m(b(A),{onClick:c},{default:f((()=>[g("发送")])),_:1})])),_:1})])]),m(b(I),{name:"query",title:"消息"},{default:f((()=>[m(a,{value:o.message,"onUpdate:value":t[1]||(t[1]=e=>o.message=e),height:"100px"},null,8,["value"])])),_:1}),m(b(I),{name:"origin",title:"原始数据结果"},{default:f((()=>[m(a,{value:l.value.data},null,8,["value"])])),_:1})])),_:3})}}}),dt={class:"justify-center flex-row flex-nowrap flex items-center"},ct={class:"accent-green-500 font-extrabold"},ut={type:"WS",name:"WS数据",component:J(n({__name:"Pane",props:{slotter:{},index:{},handler:{}},setup(e){const t=e,a=R(),n=d(!1),s=P((()=>a.default?a.default()[0].type:it)),o=d(null),l=()=>{i(),o.value&&o.value.close&&o.value.close()},r=d({url:"",message:"",timeout:3e3,isRetry:!1,maxRetryCount:0}),i=()=>{u()},u=()=>{if(r.value.url){const e={type:"WS",dataInstance:new ot(r.value)};t.slotter&&t.slotter.changeDataConfig(e)}};N((async()=>{t.slotter&&C()}));const C=()=>{var e;const a=t.slotter.dataConfig;if(a&&"WS"===a.type){const a=null==(e=t.slotter.dataConfig)?void 0:e.dataInstance;if(!a)return;const{options:n}=a.toJSON();Object.assign(r,n)}else Object.assign(r,{url:"",message:"",isRetry:!1,retryCount:0}),u()};return c((()=>t.slotter),(async e=>{e&&C()}),{immediate:!0}),(e,t)=>(p(),h(x,null,[m(b(F),{label:"链接地址","label-placement":"top",size:"small"},{default:f((()=>[v("div",dt,[m(b(S),{value:r.value.url,"onUpdate:value":t[0]||(t[0]=e=>r.value.url=e),readonly:""},{prefix:f((()=>[v("span",ct,y(r.value.url.includes(":")?r.value.url.split(":")[0]:""),1)])),_:1},8,["value"]),m(b(A),{type:"primary",onClick:t[1]||(t[1]=e=>n.value=!0)},{default:f((()=>[g(" 编辑")])),_:1})])])),_:1}),m(b(F),{label:"超时时间","label-placement":"top"},{default:f((()=>[m(b(L),{value:r.value.timeout,"onUpdate:value":[t[2]||(t[2]=e=>r.value.timeout=e),i],min:300,step:100},{suffix:f((()=>[g(" ms")])),_:1},8,["value"])])),_:1}),m(b(F),{label:"是否重试","label-placement":"top"},{default:f((()=>[m(b(H),{value:r.value.isRetry,"onUpdate:value":[t[3]||(t[3]=e=>r.value.isRetry=e),i]},null,8,["value"])])),_:1}),r.value.isRetry?(p(),k(b(F),{key:0,label:"最大重试次数","label-placement":"top"},{default:f((()=>[m(b(L),{value:r.value.maxRetryCount,"onUpdate:value":[t[4]||(t[4]=e=>r.value.maxRetryCount=e),i],step:1,placeholder:"小于等于0表示不限制重试次数"},null,8,["value"])])),_:1})):j("",!0),m(b(M),{show:n.value,"onUpdate:show":t[7]||(t[7]=e=>n.value=e),beforeClose:l},{default:f((()=>[m(b(I),{title:"WS数据",bordered:!1,closable:"",size:"small",role:"dialog","aria-modal":"true",onClose:t[6]||(t[6]=e=>n.value=!1)},{default:f((()=>[m(b(s),{ref_key:"wsRef",ref:o,options:r.value,"onUpdate:options":[t[5]||(t[5]=e=>r.value=e),i],hanlder:e.handler,onChange:i},null,8,["options","hanlder"])])),_:1})])),_:1},8,["show"])],64))}})),handler:ot,useTo:["COMPONENT","GLOBAL"],getDefaultOption:()=>({url:"",message:"",timeout:3e3,isRetry:!1,maxRetryCount:0})},pt=Q(n({__name:"Content",props:{options:{default:()=>({id:"",title:"",script:{code:"",type:"Javascript"}})},mode:{default:"debug"},dataInstance:{}},emits:["dataChange"],setup(e,{emit:t}){const a=console,n=d([]),s=e;"debug"===s.mode&&X(B.STATIC_KEY,(async e=>{await v(e)}));const o=_({data:""}),l=async()=>{try{const e=await ue();200===e.status&&(n.value=e.data.map((e=>({label:e.name,value:e.id.toString()}))))}catch(e){a.log(e||e.message)}},r=_({id:s.options.id,title:s.options.title||"",originData:""}),i=t,h=()=>{r.id=void 0},v=async e=>{if(e){const t=await y(e);t&&(o.data=JSON.stringify(t.data,null,"\t"),r.originData=t.data,r.id=e,r.title=t.name)}else o.data="",r.originData="";i("dataChange",r.id,r.title)},y=async e=>{try{const t=await ce(e);if(200===t.status)return t.data}catch(t){return}},C=async()=>{try{const e=await(async e=>ae.post({url:"/dataset/static/",data:e}))({data:r.originData,name:r.title||"未命名"});if(201===e.status){const t=e.data;r.id=t.id.toString(),r.title=t.name,r.originData=t.data,o.data=JSON.stringify(t.data,null,"\t"),Z.info("数据保存成功"),await l()}else Z.warning("数据保存失败")}catch(e){Z.warning("数据保存失败")}},x=async()=>{try{200===(await(async(e,t)=>ae.put({url:`/dataset/static/${e}/`,data:{...t}}))(r.id,{data:r.originData,name:r.title||"未命名"})).status?(Z.info("数据更新成功"),await l()):Z.warning("数据更新失败")}catch(e){Z.warning("数据更新失败")}},w=async()=>{r.id?C():x()};N((async()=>{await l(),await S()}));const S=async()=>{if(s.options&&s.options.id&&s.dataInstance){const e=e=>{e&&(r.id=e.id,r.title=e.name,r.originData=e.data,o.data=JSON.stringify(r.originData,null,"\t"),i("dataChange",s.options.id,e.name))};s.dataInstance.debug(e)}else r.id="",r.title="",r.originData="",o.data=""};return c((()=>s.options.id),(async()=>{await S()}),{deep:!0}),(e,t)=>{const a=u("x-icon");return p(),k(b(Be),{title:r.title,options:o,mode:e.mode,onSave:w},{"data-select":f((()=>[m(b(K),{value:r.id,"onUpdate:value":[t[0]||(t[0]=e=>r.id=e),v],options:n.value,class:"selected",clearable:"",placeholder:"请选择数据",onClear:h},{arrow:f((()=>[m(a,{name:"data"})])),_:1},8,["value","options"]),"debug"===e.mode?(p(),k(b(re),{key:0},{default:f((()=>[m(b(ne),{value:r.title,"onUpdate:value":t[1]||(t[1]=e=>r.title=e),class:"title"},{prefix:f((()=>[m(a,{name:"data"})])),_:1},8,["value"]),m(b(Y),{type:"primary",onClick:C},{default:f((()=>[g("保存")])),_:1})])),_:1})):j("",!0)])),_:1},8,["title","options","mode"])}}}),[["__scopeId","data-v-ca072533"]]),ht={class:"flex flex-nowrap flex-row"},vt=Q(n({__name:"DynamicExtendContent",props:{options:{default:()=>({method:xe.GET,url:"/getRiskArea",headers:[{key:"",value:"",disable:!1,id:ee()}],params:[{key:"",value:"",disable:!1,id:ee()}],data:[{key:"",value:"",disable:!1,id:ee()}],otherConfig:{isRepeat:!1,interval:1e3}})},mode:{default:"use"},dataInstance:{}},emits:["update:options","change"],setup(e,{emit:t}){const a=()=>[{key:"",value:"",disable:!1,id:ee()}],n=e,s=d([]),o=_(n.options),l=()=>{o.id=void 0,o.title=void 0,o.headers=[{key:"",value:"",disable:!1,id:ee()}],o.data=[{key:"",value:"",disable:!1,id:ee()}],o.params=[{key:"",value:"",disable:!1,id:ee()}],o.method=xe.GET,o.url=""};"debug"===n.mode&&X(B.REST_KEY,(async e=>{await r(e)}));const r=async e=>{try{const t=await(async e=>ae.get({url:`/dataset/rest/${e}/`}))(e);if(200===t.status){const e=t.data;o.method=e.method,o.url=e.url;const n=Oe(e.data||{});o.data=n.length>0?n:a();const s=Oe(e.params||{});o.params=s.length>0?s:a(),o.title=e.name,o.id=e.id;const l=Oe(e.headers||{});o.headers=l.length>0?l:a()}}catch(t){return}},i=t,c=()=>{i("change",o),i("update:options",o)},h=async e=>{await r(e),i("update:options",o),i("change",o)},y=async()=>{try{const e=ke(o.headers),t=ke(o.params),a=ke(o.data),n=await(async e=>ae.post({url:"/dataset/rest/",data:e}))({data:a,name:o.title||"未命名",url:o.url,method:o.method,headers:e,params:t});if(201===n.status){const e=n.data;o.id=e.id,o.title=e.name,Z.info("数据保存成功")}else Z.warning("数据保存失败")}catch(e){Z.warning("数据保存失败")}},C=async()=>{try{const e=ke(o.headers),t=ke(o.headers),a=ke(o.data),n=await(async(e,t)=>ae.put({url:`/dataset/rest/${e}/`,data:t}))(o.id,{data:a,name:o.title||"未命名",url:o.url,method:o.method,headers:e,params:t});200===n.status?Z.info("数据更新成功"):Z.warning("数据更新失败")}catch(e){Z.warning("数据更新失败")}};return N((async()=>{await(async()=>{try{const e=await ie();200===e.status&&(s.value=e.data.map((e=>({label:e.name,value:e.id}))))}catch(e){te.log(e||e.message)}})()})),(e,t)=>{const a=u("x-icon");return p(),k(b(Ne),{options:o,"onUpdate:options":t[2]||(t[2]=e=>o=e),"data-instance":e.dataInstance,"onUpdate:restOptions":c,onChange:c},{"data-select":f((()=>[v("div",ht,[m(b(K),{options:s.value,value:o.id,class:"selected",clearable:"",placeholder:"请选择数据","onUpdate:value":h,onClear:l},null,8,["options","value"]),"debug"===e.mode?(p(),k(b(ne),{key:0,value:o.title,"onUpdate:value":t[0]||(t[0]=e=>o.title=e),class:"title"},{prefix:f((()=>[m(a,{name:"api"})])),_:1},8,["value"])):j("",!0),"debug"===e.mode?(p(),k(b(se),{key:1},{default:f((()=>[m(b(oe),{class:"save"},{default:f((()=>[m(b(Y),{onClick:t[1]||(t[1]=e=>o.id?C():y())},{default:f((()=>[g("保存")])),_:1})])),_:1})])),_:1})):j("",!0)])])),_:1},8,["options","data-instance"])}}}),[["__scopeId","data-v-df854563"]]);export{vt as D,re as N,pt as S,Le as X,ut as a,ie as b,ue as c,de as d,pe as e,ce as g,xe as i,be as m,Ye as p,at as s};
