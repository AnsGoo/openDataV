import{ai as t,d as e,C as o,aj as n,ak as r,D as a,r as i,al as s,p as l,am as u,a8 as p,a7 as c,a as d,an as f,ao as m,ap as y,aq as v,g as x,F as h,ar as _,as as C,L as g,at as w}from"./index-40170f2c.js";const b={lt:function(e,o){const{top:n,left:r,rotate:a,width:i,height:s}=e,l=L(e),u=t({x:r+i,y:n+s},l,a),p={x:(u.x+o.x)/2,y:(u.y+o.y)/2},c=t(o,p,-a),d=t(u,p,-a),f=d.y-c.y,m=d.x-c.x;return{top:c.y,left:c.x,width:m,height:f}},t:function(e,o){const{top:n,left:r,rotate:a,width:i,height:s}=e,l=L(e),u=t({x:r+i/2,y:n+s},l,a);if(a%180!=90){const t=D((l.y-u.y)/(l.x-u.x),l,o.y);o.x=t}else o.y=l.y;const p={x:(u.x+o.x)/2,y:(u.y+o.y)/2},c=t(o,p,-a),d=t(u,p,-a).y-c.y;return{top:c.y,left:p.x-i/2,width:i,height:d}},rt:function(e,o){const{top:n,left:r,rotate:a,height:i}=e,s=L(e),l=t({x:r,y:n+i},s,a),u={x:(l.x+o.x)/2,y:(l.y+o.y)/2},p=t(o,u,-a),c=t(l,u,-a),d=c.y-p.y,f=p.x-c.x;return{top:p.y,left:c.x,width:f,height:d}},r:function(e,o){const{top:n,left:r,rotate:a,height:i}=e,s=L(e),l=t({x:r,y:n+i/2},s,a);if(a%180!=90){const t=S((s.y-l.y)/(s.x-l.x),s,o.x);o.y=t}else o.x=s.x;const u={x:(l.x+o.x)/2,y:(l.y+o.y)/2},p=t(o,u,-a),c=t(l,u,-a),d=p.x-c.x;return{top:c.y-i/2,left:c.x,width:d,height:i}},rb:function(e,o){const{top:n,left:r,rotate:a}=e,i=L(e),s=t({x:r,y:n},i,a),l={x:(s.x+o.x)/2,y:(s.y+o.y)/2},u=t(o,l,-a),p=t(s,l,-a),c=u.y-p.y,d=u.x-p.x;return{top:p.y,left:p.x,width:d,height:c}},b:function(e,o){const{top:n,left:r,rotate:a,width:i}=e,s=L(e),l=t({x:r+i/2,y:n},s,a);if(a%180!=90){const t=D((s.y-l.y)/(s.x-l.x),s,o.y);o.x=t}else o.y=s.y;const u={x:(l.x+o.x)/2,y:(l.y+o.y)/2},p=t(o,u,-a),c=t(l,u,-a),d=p.y-c.y;return{top:p.y-d,left:u.x-i/2,width:i,height:d}},lb:function(e,o){const{top:n,left:r,rotate:a,width:i}=e,s=L(e),l=t({x:r+i,y:n},s,a),u={x:(l.x+o.x)/2,y:(l.y+o.y)/2},p=t(o,u,-a),c=t(l,u,-a),d=p.y-c.y,f=c.x-p.x;return{top:p.y-d,left:p.x,width:f,height:d}},l:function(e,o){const{left:n,rotate:r,width:a,height:i,top:s}=e,l=L(e),u=t({x:n+a,y:s+i/2},l,r);if(r%180!=90){const t=S((l.y-u.y)/(l.x-u.x),l,o.x);o.y=t}else o.x=l.x;const p={x:(u.x+o.x)/2,y:(u.y+o.y)/2},c=t(o,p,-r),d=t(u,p,-r).x-c.x;return{top:p.y-i/2,left:c.x,width:d,height:i}}};function L(t){const{top:e,left:o,height:n,width:r}=t;return{y:e+n/2,x:o+r/2}}function S(t,e,o){return t*(o-e.x)+e.y}function D(t,e,o){return e.x-(e.y-o)/t}const E={shape:"_shape_a3r7u_1","error-info":"_error-info_a3r7u_7",errorInfo:"_error-info_a3r7u_7",active:"_active_a3r7u_12","shape-point":"_shape-point_a3r7u_16",shapePoint:"_shape-point_a3r7u_16",rotation:"_rotation_a3r7u_21","icon-jiesuo":"_icon-jiesuo_a3r7u_33",iconJiesuo:"_icon-jiesuo_a3r7u_33",lt:"_lt_a3r7u_42","rotate-0":"_rotate-0_a3r7u_42",rotate0:"_rotate-0_a3r7u_42",rb:"_rb_a3r7u_43",l:"_l_a3r7u_42","rotate-45":"_rotate-45_a3r7u_44",rotate45:"_rotate-45_a3r7u_44",r:"_r_a3r7u_21",lb:"_lb_a3r7u_46","rotate-90":"_rotate-90_a3r7u_46",rotate90:"_rotate-90_a3r7u_46",rt:"_rt_a3r7u_47",t:"_t_a3r7u_48","rotate-135":"_rotate-135_a3r7u_48",rotate135:"_rotate-135_a3r7u_48",b:"_b_a3r7u_49"},k=e({props:{active:{type:Boolean,default:!1},isInner:{type:Boolean,default:!1},info:Object,defaultStyle:Object,index:Number},setup(t,{slots:e}){const L=o(),S=n(),D=r(),k=()=>{D.copy(L.activeComponent)},P=()=>{L.removeComponent(t.index,t.info.parent)},M=()=>{L.upComponent(t.index,t.info.parent)},A=()=>{L.downComponent(t.index,t.info.parent)},I=()=>{L.topComponent(t.index,t.info.parent)},j=()=>{const t=L.activeComponent.id;_(t)},z=()=>{L.bottomComponent(t.index,t.info.parent)},Y=()=>{L.decompose()},T=a((()=>L.isShowEm)),X=i(null),B=i({}),K=i("0px"),R=i("#fff0"),O=i("none"),q=i(!1),G=i("");s(((t,e,o)=>{if(f.error(t.message),"render function"===o){if(L.isEditMode){if(e){const{name:t}=e.component||{};G.value=`组件[${t}]渲染异常`}else G.value="组件渲染异常";K.value="5px",R.value="red",O.value="dashed",q.value=!0}return!1}return!0}));const F=a((()=>t.active&&!t.info.locked||S.isActived(t.info))),J=e=>{var o,n;if(e.ctrlKey||e.metaKey)return S.appendComponent(L.activeComponent),void S.appendComponent(t.info);e.preventDefault(),t.isInner?(null==(o=t.info.parent)?void 0:o.id)===(null==(n=L.benchmarkComponent)?void 0:n.id)&&(e.stopPropagation(),L.activateComponent(t.info,t.index.toString())):(e.stopPropagation(),L.activateComponent(t.info,t.index.toString()))},N=(e,o)=>{if(0!==o.button||!L.activeComponent||t.info.id!==L.activeComponent.id)return;o.stopPropagation(),o.preventDefault();const n={top:t.defaultStyle.top,left:t.defaultStyle.left,height:t.defaultStyle.height,width:t.defaultStyle.width,rotate:t.defaultStyle.rotate},r=document.querySelector("#editor").getBoundingClientRect(),a=C((o=>{const a={x:(o.clientX-r.left)/L.scale,y:(o.clientY-r.top)/L.scale},{top:i,left:s,width:l,height:u}=function(t,e,o){const{top:n,left:r,width:a,height:i}=b[t](e,o);return{top:Math.round(n),left:Math.round(r),width:Math.round(a),height:Math.round(i)}}(e,n,a);L.syncComponentLocation({top:i,left:s,width:l,height:u},t.info.parent,!1)})),i=()=>{document.removeEventListener("mousemove",a),document.removeEventListener("mouseup",i),t.info&&L.resizeAutoComponent(t.info.parent),L.saveComponentData()};document.addEventListener("mousemove",a),document.addEventListener("mouseup",i)},U=e=>{if(0!==e.button||!X.value||(e.preventDefault(),e.stopPropagation(),!L.activeComponent||t.info.id!==L.activeComponent.id)||t.info.locked)return;let{rotate:o}={...t.defaultStyle};const n=e.clientY,r=e.clientX,a=o,i=X.value.getBoundingClientRect(),s=i.left+i.width/2,l=i.top+i.height/2,u=Math.atan2(n-l,r-s)/(Math.PI/180),p=C((e=>{const n=e.clientX,r=e.clientY,i=Math.atan2(r-l,n-s)/(Math.PI/180);o=a+i-u,L.syncComponentLocation({rotate:o},t.info.parent,!1)})),c=()=>{document.removeEventListener("mousemove",p),document.removeEventListener("mouseup",c),t.info&&L.resizeAutoComponent(t.info.parent),L.saveComponentData()};document.addEventListener("mousemove",p),document.addEventListener("mouseup",c)},$=()=>{if(!L.activeComponent)return{};const t=m(L.activeComponent.style.rotate),e={};let o=-1;const n=[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],r={lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315};return["lt","t","rt","r","rb","b","lb","l"].forEach((a=>{const i=m(r[a]+t),s=n.length;for(;;){o=(o+1)%s;const t=n[o];if(i<23||i>=338)return void(e[a]="nw-resize");if(t.start<=i&&i<t.end)return void(e[a]=t.cursor+"-resize")}})),e},H=a((()=>{const e="rotate-",o=t.defaultStyle.rotate;return o>-22.5&&o<=22.5?e+0:o>22.5&&o<=67.5?e+45:o>67.5&&o<=112.5?e+90:o>112.5&&o<=157.5?e+135:o>157.5||o<=-157.5?e+0:o>-157.5&&o<=-112.5?e+45:o>-112.5&&o<=-67.5?e+90:o>-67.5&&o<=-22.5?e+135:e+0})),Q=e=>{if(document.addEventListener("keyup",V),!L.activeComponent||t.info.id!==L.activeComponent.id)return;const o=e.ctrlKey||e.metaKey;if(e.stopPropagation(),t.info&&o)switch(e.code){case"ArrowLeft":e.preventDefault(),L.syncComponentLocation({left:t.info.positionStyle.left-1},t.info.parent,!1);break;case"ArrowUp":e.preventDefault(),L.syncComponentLocation({top:t.info.positionStyle.top-1},t.info.parent,!1);break;case"ArrowRight":e.preventDefault(),L.syncComponentLocation({left:t.info.positionStyle.left+1},t.info.parent,!1);break;case"ArrowDown":e.preventDefault(),L.syncComponentLocation({top:t.info.positionStyle.top+1},t.info.parent,!1);break;case"Delete":e.preventDefault(),P();break;default:return}},V=e=>{L.activeComponent&&t.info.id===L.activeComponent.id&&(e.stopPropagation(),t.info&&L.resizeAutoComponent(t.info.parent),L.saveComponentData(),document.removeEventListener("keyup",V))};l((()=>{B.value=$()})),u((()=>L.activeComponent),(e=>{e&&t.info.id===e.id?document.addEventListener("keydown",Q):document.removeEventListener("keydown",Q)}));const W=[{top:"0%",left:"0%",direction:"lt"},{top:"0%",left:"50%",direction:"t"},{top:"0%",left:"100%",direction:"rt"},{top:"50%",left:"100%",direction:"r"},{top:"100%",left:"100%",direction:"rb"},{top:"100%",left:"50%",direction:"b"},{top:"100%",left:"0%",direction:"lb"},{top:"50%",left:"0%",direction:"l"}];return()=>p(d("div",{ref:X,class:[E.shape,F.value||t.active?E.active:""],onDblclick:e=>(e=>{var o;t.isInner&&(e.preventDefault(),t.info&&(!t.info.parent||null!=(o=t.info.parent)&&o.active)&&(e.stopPropagation(),L.activateComponent(t.info,t.index.toString())))})(e),onClick:t=>J(t),onMousedown:e=>(e=>{if(e.preventDefault(),t.info.parent||e.stopPropagation(),!L.activeComponent||t.info.id!==L.activeComponent.id||t.info.locked)return;e.stopPropagation(),B.value=$();let{top:o,left:n}=t.defaultStyle;const r=e.clientY,a=e.clientX,i=o,s=n,l=C((e=>{const l=e.clientX;o=(e.clientY-r)/L.scale+i,n=(l-a)/L.scale+s,L.syncComponentLocation({top:o,left:n},t.info.parent,!1)})),u=()=>{g.emit(w.DRAG_STOP),document.removeEventListener("mousemove",l),document.removeEventListener("mouseup",u),t.info&&t.info.parent&&L.resizeAutoComponent(t.info.parent),L.saveComponentData()};document.addEventListener("mousemove",l),document.addEventListener("mouseup",u)})(e)},[d(h,null,[p(d("span",{class:E.errorInfo},[G.value]),[[y,q.value]]),p(d(v("x-icon"),{class:E.rotation,name:"rotation",onMousedown:U},null),[[y,F.value]]),p(d("em",null,[x("("),t.defaultStyle.left,x(","),t.defaultStyle.top,x(")")]),[[y,T.value]]),W.map((t=>p(d("div",{class:[E.shapePoint,E[t.direction],E[H.value]],style:{top:t.top,left:t.left},onMousedown:e=>N(t.direction,e)},null),[[y,F.value]]))),e.default&&e.default()])]),[[c("contextmenu"),(e,o)=>((e,o)=>{var n;if(L.activeComponent&&L.activeComponent.id===t.info.id)o.stopPropagation();else{if(L.activeComponent||t.info.parent)return;L.activateComponent(t.info,t.index.toString()),o.stopPropagation()}return[{text:"拆分",subText:"",disable:"Group"!==(null==(n=L.activeComponent)?void 0:n.component),handler:Y},{divider:!0},{text:"复制",subText:"Ctrl + C",handler:k},{text:"复制ID",subText:"",handler:j},{text:"删除",subText:"Ctr + Delete",handler:P},{divider:!0},{text:"置于顶层",handler:I,children:[{text:"置于顶层",handler:I},{text:"上移一层",handler:M}]},{text:"置于底层",handler:z,children:[{text:"置于底层",handler:z},{text:"下移一层",handler:A}]}]})(0,o)]])}});export{k as Y};
