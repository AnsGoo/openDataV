import{d as J,v as E,U as B,S as I,T as L,x as q,R as W,H as G,o as N,l as k,w as m,b as y,u as p,bb as K,b5 as j,N as H,W as M,D as Y,s as T,bc as z,G as d,_ as P,b9 as V,ba as h,bd as U,be as F,a as Q,V as X,bf as Z,L as tt,bg as at,bh as _}from"./index-10d63009.js";import{a as g}from"./index-448c4cac.js";import{N as et}from"./Space-9ca69cf4.js";const st=async i=>g.get({url:`/dataset/rest/${i}/`}),nt=async()=>g.get({url:"/dataset/rest"}),ot=async(i,l)=>g.put({url:`/dataset/rest/${i}/`,data:l}),it=async i=>g.post({url:"/dataset/rest/",data:i}),vt=async i=>g.delete({url:`/dataset/rest/${i}/`}),rt=async i=>g.get({url:`/dataset/static/${i}/`}),dt=async()=>g.get({url:"/dataset/static/"}),lt=async(i,l)=>g.put({url:`/dataset/static/${i}/`,data:{...l}}),ct=async i=>g.post({url:"/dataset/static/",data:i}),ht=async i=>g.post({url:`/dataset/static/${i}/`}),ut=J({__name:"Content",props:{options:{default:()=>({id:"",title:"",script:{code:"",type:"Javascript"}})},mode:{default:"debug"}},emits:["dataChange"],setup(i,{emit:l}){const c=i,w=console,b=E([]);c.mode==="debug"&&B(I.STATIC_KEY,async s=>{await t(s)});const v=L({data:""}),D=async()=>{try{const s=await dt();s.status===200&&(b.value=s.data.map(o=>({label:o.name,value:o.id.toString()})))}catch(s){w.log(s||s.message)}},e=L({id:c.options.id,title:c.options.title||"",originData:""}),x=()=>{e.id=void 0},t=async s=>{if(s){const o=await f(s);o&&(v.data=JSON.stringify(o.data,null,"	"),e.originData=o.data,e.id=s,e.title=o.name)}else v.data="",e.originData="";l("dataChange",e.id,e.title)},f=async s=>{try{const o=await rt(s);if(o.status===200)return o.data}catch{return}},R=async()=>{try{const s=await ct({data:e.originData,name:e.title||"未命名"});if(s.status===201){const o=s.data;e.id=o.id.toString(),e.title=o.name,e.originData=o.data,v.data=JSON.stringify(o.data,null,"	"),d.info("数据保存成功"),await D()}else d.warning("数据保存失败")}catch{d.warning("数据保存失败")}},S=async()=>{try{(await lt(e.id,{data:e.originData,name:e.title||"未命名"})).status===200?(d.info("数据更新成功"),await D()):d.warning("数据更新失败")}catch{d.warning("数据更新失败")}},A=async()=>{e.id?R():S()};q(async()=>{await D(),await O()});const O=async()=>{if(c.options&&c.options.id){const s=await f(c.options.id);s&&(e.id=s.id,e.title=s.name,e.originData=s.data,v.data=JSON.stringify(e.originData,null,"	"),l("dataChange",c.options.id,s.name))}else e.id="",e.title="",e.originData="",v.data=""};return W(()=>c.options.id,async()=>{await O()},{deep:!0}),(s,o)=>{const a=G("x-icon");return N(),k(p(z),{title:e.title,options:v,mode:s.mode,onSave:A},{"data-select":m(()=>[y(p(K),{value:e.id,"onUpdate:value":[o[0]||(o[0]=n=>e.id=n),t],options:b.value,class:"selected",clearable:"",placeholder:"请选择数据",onClear:x},{arrow:m(()=>[y(a,{name:"data"})]),_:1},8,["value","options"]),s.mode==="debug"?(N(),k(p(j),{key:0},{default:m(()=>[y(p(H),{value:e.title,"onUpdate:value":o[1]||(o[1]=n=>e.title=n),class:"title"},{prefix:m(()=>[y(a,{name:"data"})]),_:1},8,["value"]),y(p(M),{type:"primary",onClick:R},{default:m(()=>[Y("保存")]),_:1})]),_:1})):T("",!0)]),_:1},8,["title","options","mode"])}}});const _t=P(ut,[["__scopeId","data-v-92590dfe"]]),pt={class:"flex flex-nowrap flex-row"},mt=J({__name:"DynamicExtendContent",props:{options:{default:()=>({method:V.GET,url:"/getRiskArea",headers:[{key:"",value:"",disable:!1,id:h()}],params:[{key:"",value:"",disable:!1,id:h()}],data:[{key:"",value:"",disable:!1,id:h()}],otherConfig:{isRepeat:!1,interval:1e3}})},mode:{default:"use"}},emits:["update:options","change"],setup(i,{emit:l}){const c=i,w=()=>[{key:"",value:"",disable:!1,id:h()}],b=E([]),v=async()=>{try{const a=await nt();a.status===200&&(b.value=a.data.map(n=>({label:n.name,value:n.id})))}catch(a){tt.log(a||a.message)}},D=()=>{t.id=void 0,t.title=void 0,t.headers=[{key:"",value:"",disable:!1,id:h()}],t.data=[{key:"",value:"",disable:!1,id:h()}],t.params=[{key:"",value:"",disable:!1,id:h()}],t.method=V.GET,t.url=""};let e;c.mode==="debug"&&B(I.REST_KEY,async a=>{await x(a),await S()});const x=async a=>{try{const n=await st(a);if(n.status===200){const r=n.data;if(t.method=r.method,t.url=r.url,!r.data)return;const u=U(r.data||{});t.data=u.length>0?u:w();const C=U(r.params||{});t.params=C.length>0?C:w(),t.title=r.name,t.id=r.id;const $=U(r.headers||{});t.headers=$.length>0?$:w()}}catch{return}},t=L(c.options),f=E({status:0,data:"",headers:{}}),R=at(),S=async()=>{try{const a=await R.request(F(t));f.value.status=a.status,f.value.data=JSON.stringify(a.data,null,"	"),f.value.headers=a.headers,t.id&&e&&e.save(t)}catch(a){const n=a.response||(a.toJSON?a.toJSON():{});f.value.status=n.status,f.value.data=a.stack||a.message,f.value.headers=n.headers||n?.config?.headers||{}}},A=()=>{l("change",t),l("update:options",t)},O=async a=>{await x(a),await S(),l("update:options",t),l("change",t)},s=async()=>{try{const a=_(t.headers),n=_(t.headers),r=_(t.data),u=await it({data:r,name:t.title||"未命名",url:t.url,method:t.method,headers:a,params:n});if(u.status===201){const C=u.data;t.id=C.id,t.title=C.name,d.info("数据保存成功")}else d.warning("数据保存失败")}catch{d.warning("数据保存失败")}},o=async()=>{try{const a=_(t.headers),n=_(t.headers),r=_(t.data);(await ot(t.id,{data:r,name:t.title||"未命名",url:t.url,method:t.method,headers:a,params:n})).status===200?d.info("数据更新成功"):d.warning("数据更新失败")}catch{d.warning("数据更新失败")}};return q(async()=>{await S(),await v()}),(a,n)=>{const r=G("x-icon");return N(),k(p(Z),{options:t,"onUpdate:options":n[2]||(n[2]=u=>t=u),"onUpdate:restOptions":A,onChange:A},{"data-select":m(()=>[Q("div",pt,[y(p(K),{options:b.value,value:t.id,class:"selected",clearable:"",placeholder:"请选择数据","onUpdate:value":O,onClear:D},null,8,["options","value"]),a.mode==="debug"?(N(),k(p(H),{key:0,value:t.title,"onUpdate:value":n[0]||(n[0]=u=>t.title=u),class:"title"},{prefix:m(()=>[y(r,{name:"api"})]),_:1},8,["value"])):T("",!0),a.mode==="debug"?(N(),k(p(et),{key:1},{default:m(()=>[y(p(X),{class:"save"},{default:m(()=>[y(p(M),{onClick:n[1]||(n[1]=u=>t.id?o():s())},{default:m(()=>[Y("保存")]),_:1})]),_:1})]),_:1})):T("",!0)])]),_:1},8,["options"])}}});const wt=P(mt,[["__scopeId","data-v-0197f742"]]);export{wt as D,_t as S,dt as a,ht as b,rt as c,vt as d,nt as g};
