import{d as b,v,R as D,H as x,o as g,l as w,w as a,a as y,b as t,g as J,C as L,_ as k,T as K,U as P,S as U,L as z,u as s,N as I,V as B,W as O,D as C,E as $,z as R,A,X as V,G as S,x as W,c as F,F as G,f as M,h as Y,e as Q,y as X,K as j,M as T,B as q,Q as Z,n as ee,P as te}from"./index-10d63009.js";import{m as ae}from"./index-858c25dd.js";import{a as E}from"./index-448c4cac.js";import{N as H}from"./Space-9ca69cf4.js";import{N as se,a as ne,T as oe}from"./Toolbar-db3de7d7.js";import{N as le,a as ce}from"./li-bf48c28b.js";import"./LogoView-b067190b.js";import"./ToolBar-8264009a.js";const re=async d=>E.get({url:`/dataset/script/${d}/`}),de=async()=>E.get({url:"/dataset/script/"}),ie=async(d,e)=>E.put({url:`/dataset/script/${d}/`,data:{...e,id:d}}),ue=async d=>E.post({url:"/dataset/script/",data:d}),_e={class:"buttons"},pe={class:"footer"},ve=b({__name:"Editor",props:{value:{},config:{default:()=>({height:"600px",tabSize:4,indentWithTab:!0,autofocus:!0,disabled:!1})},mode:{default:"use"}},emits:["update:value","change"],setup(d,{emit:e}){const c=d,p=v(!0),l=v(c.value),u=()=>{e("update:value",l.value),e("change",l.value)},r=v(null),i=()=>{const _=r.value.handleRedo;_&&_()},f=()=>{const _=r.value.handleUndo;_&&_()};return D(()=>c.value,()=>{c.value&&(l.value=c.value)}),(_,o)=>{const n=x("x-icon"),m=x("OCodeEditor");return g(),w(m,{ref_key:"cm",ref:r,value:l.value,"onUpdate:value":[o[0]||(o[0]=N=>l.value=N),u]},{"tool-bar":a(()=>[y("div",null,[y("div",_e,[t(n,{class:"item button",name:"back",onClick:f}),t(n,{class:"item button",name:"next",onClick:i})])])]),footer:a(()=>[y("div",pe,[y("div",{class:J(["saved-status",p.value?"save":"unsave"])},L(p.value?"已保存":"未保存"),3)])]),_:1},8,["value"])}}});const fe=k(ve,[["__scopeId","data-v-95b5addf"]]),me={class:"static-data"},ye=b({__name:"Conetent",setup(d){const e=K({id:"",title:"",code:""}),c=v(JSON.stringify({},null,"	")),p=o=>{c.value=o},l=async o=>{e.code=o};P(U.SRCIPT_KEY,async o=>{await i(o)});const u=v(""),r=()=>{const o=e.code?ae("Javascript",e.code,["resp","options"]):void 0;if(o&&o.handler)try{u.value=JSON.stringify(o.handler(JSON.parse(c.value),{}),null,"	")}catch(n){u.value=n.message||n}else u.value=JSON.stringify(c.value,null,"	")},i=async o=>{try{const n=await re(o);if(n.status===200){const m=n.data;e.id=m.id,e.title=m.name,e.code=m.code}}catch(n){z.log(n||n.message)}},f=async()=>{try{const o=await ue({code:e.code,name:e.title||"未命名"});if(o.status===201){const n=o.data;e.id=n.id,e.title=n.name,e.code=n.code,S.info("数据保存成功")}else S.warning("数据保存失败")}catch{S.warning("数据保存失败")}},_=async()=>{if(e.id)try{(await ie(e.id,{code:e.code,name:e.title||"未命名"})).status===200?S.info("数据更新成功"):S.warning("数据更新失败")}catch{S.warning("数据更新失败")}};return(o,n)=>{const m=x("x-icon"),N=x("OCodeEditor");return g(),w(s($),null,{default:a(()=>[y("div",me,[t(s(I),{value:e.title,"onUpdate:value":n[0]||(n[0]=h=>e.title=h),class:"title"},{prefix:a(()=>[t(m,{name:"code"})]),_:1},8,["value"]),t(s(H),null,{default:a(()=>[t(s(B),{class:"save"},{default:a(()=>[t(s(O),{type:"success",onClick:r},{default:a(()=>[C("运行")]),_:1})]),_:1})]),_:1}),t(s(H),null,{default:a(()=>[t(s(B),{class:"save"},{default:a(()=>[t(s(O),{onClick:n[1]||(n[1]=h=>e.id?_():f())},{default:a(()=>[C("保存")]),_:1})]),_:1})]),_:1})]),t(s($),null,{default:a(()=>[t(s(R),null,{default:a(()=>[t(s(A),{name:"脚本"},{default:a(()=>[t(fe,{value:e.code,class:"content","onUpdate:value":l},null,8,["value"])]),_:1}),t(s(A),{name:"入参"},{default:a(()=>[t(N,{value:c.value,"onUpdate:value":[n[2]||(n[2]=h=>c.value=h),p]},null,8,["value"])]),_:1})]),_:1}),t(s(V),{"title-placement":"left"},{default:a(()=>[C(" 输出 ")]),_:1}),t(N,{value:u.value,"onUpdate:value":[n[3]||(n[3]=h=>u.value=h),l],class:"content",disable:!0},null,8,["value"])]),_:1})]),_:1})}}});const ge=k(ye,[["__scopeId","data-v-8c0d6d00"]]),he={class:"rest-detail"},Se=b({__name:"History",setup(d){const e=v([]),c=async()=>{try{const l=await de();l.status===200&&(e.value=l.data)}catch(l){z.log(l||l.message)}},p=l=>{Y.emit(U.SRCIPT_KEY,l)};return W(async()=>{await c()}),(l,u)=>(g(),w(s($),{title:"脚本",size:"small"},{default:a(()=>[t(s(I),{placeholder:"请输入搜索条件"}),t(s(R),null,{default:a(()=>[t(s(A),{name:"脚本列表"},{default:a(()=>[t(s(se),{"align-text":""},{default:a(()=>[(g(!0),F(G,null,M(e.value,r=>(g(),w(s(le),{key:r.id,class:"data-item",onClick:i=>p(r.id)},{default:a(()=>[y("div",he,[y("div",null,[t(s(ne),{type:"success",style:{"font-weight":"800"}},{default:a(()=>[C(L("JS"))]),_:1}),C(" "+L(r.name),1)])])]),_:2},1032,["onClick"]))),128))]),_:1})]),_:1})]),_:1})]),_:1}))}});const we=k(Se,[["__scopeId","data-v-0be691dc"]]),Ce=b({__name:"Scripts",setup(d){const e=v(!1),c=v(0),p=v(0),l=Q(()=>({width:c.value+"px",height:p.value+"px"})),u=r=>{const{width:i,height:f}=r.contentRect;c.value=i,p.value=f};return(r,i)=>{const f=X("resize");return g(),w(s(T),{class:"home"},{default:a(()=>[t(s(j),{class:"header"},{default:a(()=>[t(s(oe))]),_:1}),t(s(T),{"has-sider":"","sider-placement":"right",class:"main"},{default:a(()=>[q((g(),w(s(Z),{class:"content"},{default:a(()=>[t(s(ce),{"x-scrollable":"",style:ee(l.value)},{default:a(()=>[t(ge)]),_:1},8,["style"])]),_:1})),[[f,u]]),t(s(te),{class:"right",width:"240",collapsed:e.value,"native-scrollbar":!1,bordered:"","collapsed-width":35,"collapse-mode":"width","show-trigger":"arrow-circle",onCollapse:i[0]||(i[0]=_=>e.value=!0),onExpand:i[1]||(i[1]=_=>e.value=!1)},{default:a(()=>[t(we)]),_:1},8,["collapsed"])]),_:1})]),_:1})}}});const Be=k(Ce,[["__scopeId","data-v-4249a075"]]);export{Be as default};
