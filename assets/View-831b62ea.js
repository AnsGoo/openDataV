import{bX as Ue,d as N,as as St,at as He,bY as Dt,l as L,av as kt,Q as P,X as Fe,bZ as Lt,b_ as Se,o as w,c as I,a as M,t as ee,E as ve,b$ as We,b as h,u as m,al as be,aG as Xe,_ as j,R as pe,h as Z,w as A,a9 as F,Y as Ye,ab as xe,c0 as $t,a4 as ue,C as V,y as T,e as $,J as _e,s as q,z as x,bS as Ge,c1 as Rt,k as Ke,S as Y,T as de,B as me,ac as It,f as oe,H as qe,bG as ge,bH as Ze,c2 as Ce,bI as Je,c3 as Nt,c4 as ye,F as te,i as ae,K as we,n as W,W as Tt,P as ne,c5 as De,j as se,q as Qe,L as ke,c6 as Le,bU as Et,D as $e,bW as Bt,$ as Ot,c7 as Mt,bq as jt,ar as zt,ai as et,O as ce,ap as re,a$ as At,bT as Vt,ao as Pt,aq as Re,ah as X,c8 as Ut,c9 as Ht,ca as Ft,bQ as tt,cb as nt,a5 as Wt,cc as ot,aD as he,N as Ie,cd as Xt,aw as Yt,aW as Gt,ax as Kt}from"./index-dfdef63a.js";import{u as qt,s as Zt,g as Jt}from"./pages-49af150a.js";import{N as at,a as st,C as it,u as Ne,b as Qt,F as en,c as tn,d as nn,h as on}from"./viewer.vue_vue_type_style_index_0_scoped_d4d5ffd9_lang-f2adef07.js";import{u as lt,a as ct,S as an}from"./Shape-8c0b031d.js";import{T as sn,L as ln}from"./ToolBar-5c09210c.js";import{N as cn}from"./LayoutFooter-dd981d94.js";import{N as rn}from"./Scrollbar-69c005e9.js";import"./index-425499df.js";import"./index-c01320d9.js";import"./shape.module-52bdef3b.js";/* empty css                                                                */function un(o,e,n,a){var r=-1,i=o==null?0:o.length;for(a&&i&&(n=o[++r]);++r<i;)n=e(n,o[r],r,o);return n}function dn(o){return function(e){return o?.[e]}}var pn={À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"},mn=dn(pn);const fn=mn;var hn=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,vn="\\u0300-\\u036f",_n="\\ufe20-\\ufe2f",gn="\\u20d0-\\u20ff",yn=vn+_n+gn,bn="["+yn+"]",xn=RegExp(bn,"g");function Cn(o){return o=Ue(o),o&&o.replace(hn,fn).replace(xn,"")}var wn=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g;function Sn(o){return o.match(wn)||[]}var Dn=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/;function kn(o){return Dn.test(o)}var rt="\\ud800-\\udfff",Ln="\\u0300-\\u036f",$n="\\ufe20-\\ufe2f",Rn="\\u20d0-\\u20ff",In=Ln+$n+Rn,ut="\\u2700-\\u27bf",dt="a-z\\xdf-\\xf6\\xf8-\\xff",Nn="\\xac\\xb1\\xd7\\xf7",Tn="\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf",En="\\u2000-\\u206f",Bn=" \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",pt="A-Z\\xc0-\\xd6\\xd8-\\xde",On="\\ufe0e\\ufe0f",mt=Nn+Tn+En+Bn,ft="['’]",Te="["+mt+"]",Mn="["+In+"]",ht="\\d+",jn="["+ut+"]",vt="["+dt+"]",_t="[^"+rt+mt+ht+ut+dt+pt+"]",zn="\\ud83c[\\udffb-\\udfff]",An="(?:"+Mn+"|"+zn+")",Vn="[^"+rt+"]",gt="(?:\\ud83c[\\udde6-\\uddff]){2}",yt="[\\ud800-\\udbff][\\udc00-\\udfff]",Q="["+pt+"]",Pn="\\u200d",Ee="(?:"+vt+"|"+_t+")",Un="(?:"+Q+"|"+_t+")",Be="(?:"+ft+"(?:d|ll|m|re|s|t|ve))?",Oe="(?:"+ft+"(?:D|LL|M|RE|S|T|VE))?",bt=An+"?",xt="["+On+"]?",Hn="(?:"+Pn+"(?:"+[Vn,gt,yt].join("|")+")"+xt+bt+")*",Fn="\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Wn="\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])",Xn=xt+bt+Hn,Yn="(?:"+[jn,gt,yt].join("|")+")"+Xn,Gn=RegExp([Q+"?"+vt+"+"+Be+"(?="+[Te,Q,"$"].join("|")+")",Un+"+"+Oe+"(?="+[Te,Q+Ee,"$"].join("|")+")",Q+"?"+Ee+"+"+Be,Q+"+"+Oe,Wn,Fn,ht,Yn].join("|"),"g");function Kn(o){return o.match(Gn)||[]}function qn(o,e,n){return o=Ue(o),e=n?void 0:e,e===void 0?kn(o)?Kn(o):Sn(o):o.match(e)||[]}var Zn="['’]",Jn=RegExp(Zn,"g");function Qn(o){return function(e){return un(qn(Cn(e).replace(Jn,"")),o,"")}}var eo=Qn(function(o,e,n){return o+(n?"-":"")+e.toLowerCase()});const to=eo,no=Object.assign(Object.assign({},He.props),{tag:{type:String,default:"div"}}),oo=N({name:"Element",alias:["El"],props:no,setup(o){const{mergedClsPrefixRef:e,inlineThemeDisabled:n}=St(o),a=He("Element","-element",void 0,Dt,o,e),r=L(()=>{const{common:p}=a.value;return Object.keys(p).reduce((l,t)=>(l[`--${to(t)}`]=p[t],l),{})}),i=n?kt("element",void 0,r,o):void 0;return{mergedClsPrefix:e,cssVars:n?void 0:r,themeClass:i?.themeClass,onRender:i?.onRender}},render(){var o;const{tag:e,mergedClsPrefix:n,cssVars:a,themeClass:r,onRender:i,$slots:p}=this;return i?.(),P(e,{role:"none",class:[`${n}-element`,r],style:a},(o=p.default)===null||o===void 0?void 0:o.call(p))}});function ao(){const o=Fe(Lt,null);return L(()=>{if(o===null)return Se;const{mergedThemeRef:{value:e},mergedThemeOverridesRef:{value:n}}=o,a=e?.common||Se;return n?.common?Object.assign({},a,n.common):a})}const so=["data-component"],io=N({__name:"ComponentItem",props:{component:{},name:{}},setup(o){return(e,n)=>(w(),I("div",{draggable:"true","data-component":e.component},[M("div",null,ee(e.name),1)],8,so))}}),lo={class:"components"},co=N({__name:"ComponentList",setup(o){const n=Xe().appContext.components.XIcon,a=L(()=>{const i={};Object.keys(ve).forEach(l=>{const t=new ve[l],s=t.group;!s||!t.show||(i[s]||(i[s]=[]),i[s].push(t))});const p=[];return We.forEach(l=>{p.push({label:()=>l.name,key:l.key,icon:()=>P(n,{name:`${l.icon}`}),children:i[l.key]?.map(t=>({label:()=>P(io,{component:t.component,name:t.name,ondragstart:r}),key:t.component}))})}),p}),r=i=>{i.dataTransfer.setData("componentName",i.target.dataset.component)};return(i,p)=>(w(),I("div",lo,[h(m(be),{options:a.value,accordion:!1},null,8,["options"])]))}}),Me=j(co,[["__scopeId","data-v-e3d858f1"]]),ro={key:0,class:"layer"},uo={key:1,class:"layer"},po=N({__name:"LayerItem",props:{component:{},index:{},activeKey:{},mode:{default:"expand"},contextmenus:{}},emits:["select"],setup(o,{emit:e}){const n=o,a=V(),r=t=>t?"previewOpen":"previewClose",i=(t,s)=>{t.dataTransfer?.setData("componentIndex",s),t.stopPropagation()},p=(t,s,v=!1)=>{t.preventDefault(),t.stopPropagation(),v&&s!==n.activeKey&&Ye.emit(xe.ACTIVE_MENU,s)},l=(t,s)=>{t.preventDefault(),t.stopPropagation();const v=t.dataTransfer?.getData("componentIndex");if(!$t(v,s))return;const d=v.split("-").map(S=>Number(S)),C=a.getComponentByIndex(d),D=ue(C),g=s.split("-").map(S=>Number(S)),b=a.getComponentByIndex(g);if(D&&b&&s){const S=b.id;a.cutComponent(d[d.length-1],C?.parent);const k=b.parent||void 0,B=(k?k.subComponents:a.componentData).findIndex(U=>U.id===S);a.insertComponent(B,D,k),e("select",s)}};return(t,s)=>{const v=pe("x-icon"),_=Z("contextmenu");return A((w(),I("div",{draggable:"true",onDragstart:s[0]||(s[0]=d=>i(d,t.index)),onDrop:s[1]||(s[1]=d=>l(d,t.index)),onDragover:s[2]||(s[2]=d=>p(d,t.index,!0))},[t.component.component==="Group"?(w(),I("div",ro,[A(M("span",null,ee(t.component.name||"分组"),513),[[F,t.mode==="expand"]]),h(v,{name:r(t.component.display),size:18},null,8,["name"])])):(w(),I("div",uo,[A(M("span",null,ee(t.component.name),513),[[F,t.mode==="expand"]]),h(v,{name:r(t.component.display),size:18},null,8,["name"])]))],32)),[[_,t.contextmenus,void 0,{stop:!0}]])}}}),je=j(po,[["__scopeId","data-v-a061056f"]]),mo=N({__name:"SimpleLayerItem",props:{component:{},index:{},activeKey:{},mode:{default:"expand"},name:{},contextmenus:{}},emits:["select"],setup(o,{emit:e}){const n=o,a=V(),r=(t,s)=>{t.dataTransfer?.setData("componentIndex",s),t.stopPropagation()},i=(t,s,v=!1)=>{t.preventDefault(),t.stopPropagation(),v&&s!==n.activeKey&&Ye.emit(xe.ACTIVE_MENU,s)},p=(t,s)=>{t.preventDefault(),t.stopPropagation();const v=t.dataTransfer?.getData("componentIndex"),_=l(v,s),d=v.split("-").map(g=>Number(g)),C=a.getComponentByIndex(d),D=a.cutComponent(d[d.length-1],C?.parent);if(D&&_){const g=v.split("-").map(S=>Number(S)),b=a.getComponentByIndex(g);a.insertComponent(g[g.length-1],D,b),e("select",s)}},l=(t,s)=>{const v=t.split("-").map(C=>parseInt(C)),_=s.split("-").map(C=>parseInt(C)),d=v.length;for(let C=0;C<d;C++)if(v[C]!==_[C]){if(v[C]>_[C])return s;if(v[C]<_[C])return C+1==d?(_[C]=_[C]-1,_.join("-")):s}return s};return(t,s)=>{const v=pe("x-icon"),_=Z("contextmenu");return A((w(),T(v,{draggable:"true",size:18,name:t.name,onDragstart:s[0]||(s[0]=d=>r(d,t.index)),onDrop:s[1]||(s[1]=d=>p(d,t.index)),onDragover:s[2]||(s[2]=d=>i(d,t.index,!0))},null,8,["name"])),[[_,t.contextmenus,void 0,{stop:!0}]])}}}),ze=j(mo,[["__scopeId","data-v-13220f4b"]]),Ae=N({__name:"Layer",setup(o){const e=V(),n=lt(),a={};We.map(c=>{a[c.key]=c.icon});const r=L(()=>e.componentData),i=$(null),p=$("");_e("ActiveMenu",c=>{const f=c;p.value=f,i.value&&i.value.open&&i.value.open(f)});const t=c=>{p.value=c;const f=c.split("-").map(y=>Number(y)),u=e.getComponentByIndex(f);u&&e.setCurComponent(u,c)},s=$([]),v=(c,f,u)=>{for(let y=0;y<f.length;y++){const R=f[y],E=_(y,c);if(R.group===Rt.CONTAINER){const z=[];u.push({label:()=>P(je,{component:R,index:E,contextmenus:()=>H(E),onclick:()=>t(E)}),key:E,icon:()=>P(ze,{name:"container",component:R,index:E,contextmenus:()=>H(E),onclick:()=>t(E)}),children:v(E,R.subComponents||[],z)})}else u.push({label:()=>P(je,{component:R,index:E,contextmenus:()=>H(E)}),key:E,icon:()=>P(ze,{name:`${a[R.group]}`,component:R,index:E,contextmenus:()=>H(E),onclick:()=>t(E)})})}return u},_=(c,f)=>f?`${f}-${c}`:c.toString(),d=c=>{const f=c.split("-").map(y=>Number(y)),u=ue(e.getComponentByIndex(f));u&&n.copy(u)},C=async c=>{t(c);const f=c.split("-").map(u=>Number(u));e.removeComponent(f[f.length-1],e.curComponent?.parent)},D=async c=>{t(c);const f=c.split("-").map(u=>Number(u));e.upComponent(f[f.length-1],e.curComponent?.parent)},g=async c=>{t(c);const f=c.split("-").map(u=>Number(u));e.downComponent(f[f.length-1],e.curComponent?.parent)},b=async c=>{t(c);const f=c.split("-").map(u=>Number(u));e.topComponent(f[f.length-1],e.curComponent?.parent)},S=async c=>{t(c);const f=c.split("-").map(u=>Number(u));e.bottomComponent(f[f.length-1],e.curComponent?.parent)},k=c=>{t(c);const f=c.split("-").map(y=>Number(y)),u=e.getComponentByIndex(f);u&&u.hiddenComponent()},O=c=>{t(c);const f=c.split("-").map(y=>Number(y)),u=e.getComponentByIndex(f);u&&u.showComponent()},B=c=>{const f=c.split("-").map(R=>Number(R)),u=e.getComponentByIndex(f),y=e.cutComponent(f[f.length-1],u?.parent);y&&n.copy(y)},U=c=>{const f=c.split("-").map(y=>Number(y)),u=e.getComponentByIndex(f);if(n.copyData){const y=ue(n.copyData);y.id=Ke(),e.insertComponent(f[f.length-1],y,u?.parent)}},H=c=>{const f=c.split("-").map(u=>parseInt(u));return[{text:"复制",subText:"Ctrl + C",handler:()=>d(c)},{text:"粘贴",subText:"Ctrl + V",handler:()=>U(c)},{text:"剪切",subText:"Ctrl + X",handler:()=>B(c)},{text:"拆分",subText:"",disable:e.getComponentByIndex(c.split("-").map(u=>Number(u)))?.component!=="Group",handler:()=>e.decompose()},{text:"删除",subText:"",handler:()=>C(c)},{divider:!0},{text:"置于顶层",handler:()=>b(c),children:[{text:"置于顶层",handler:()=>b(c)},{text:"上移一层",handler:()=>D(c)}]},{text:"置于底层",handler:()=>S(c),children:[{text:"置于底层",handler:()=>S(c)},{text:"下移一层",handler:()=>g(c)}]},{divider:!0},{text:"显示",disable:e.getComponentByIndex(f)?.display,subText:"",handler:()=>O(c)},{text:"隐藏",disable:!e.getComponentByIndex(f)?.display,subText:"",handler:()=>k(c)}]};return q(()=>e.componentData,()=>{const c=e.componentData;s.value=[],s.value=v("",c,[])},{deep:!0,immediate:!0}),(c,f)=>(w(),I("div",null,[r.value.length>0?(w(),T(m(be),{key:0,options:s.value,"root-indent":1,indent:12,"onUpdate:value":t},null,8,["options"])):(w(),T(m(st),{key:1,class:"placeholder"},{default:x(()=>[h(m(at),null,{default:x(()=>[h(m(Ge),{description:"画布为空"})]),_:1})]),_:1}))]))}}),fo=M("span",null,"组件",-1),ho=M("span",null,"图层",-1),vo=N({__name:"SideBar",props:{iscollapsed:{type:Boolean,default:!1}},emits:["update:iscollapsed"],setup(o,{emit:e}){const n=$("components"),a=i=>{e("update:iscollapsed",!1),n.value=i},r=i=>{n.value=i};return(i,p)=>{const l=pe("x-icon");return i.iscollapsed?(w(),T(m(de),{key:1,value:n.value,"onUpdate:value":[p[4]||(p[4]=t=>n.value=t),a],type:"line",animated:"","bar-width":48,"justify-content":"center"},{default:x(()=>[n.value==="components"?(w(),T(m(Y),{key:0,name:"components","display-directive":"show:lazy"},{tab:x(()=>[h(l,{name:"components",onClick:p[2]||(p[2]=t=>r("layer"))})]),default:x(()=>[h(Me)]),_:1})):n.value==="layer"?(w(),T(m(Y),{key:1,name:"layer","display-directive":"show:lazy"},{tab:x(()=>[h(l,{name:"layers",onClick:p[3]||(p[3]=t=>r("components"))})]),default:x(()=>[h(Ae)]),_:1})):me("",!0)]),_:1},8,["value"])):(w(),T(m(de),{key:0,value:n.value,"onUpdate:value":[p[0]||(p[0]=t=>n.value=t),p[1]||(p[1]=t=>{n.value=t})],type:"line",animated:"","bar-width":100,"justify-content":"center"},{default:x(()=>[h(m(Y),{name:"components","display-directive":"show:lazy"},{tab:x(()=>[h(l,{name:"components"}),fo]),default:x(()=>[h(Me)]),_:1}),h(m(Y),{name:"layer","display-directive":"show:lazy"},{tab:x(()=>[h(l,{name:"layers"}),ho]),default:x(()=>[h(Ae)]),_:1})]),_:1},8,["value"]))}}}),_o={class:"attr-list"},go=N({__name:"AttrList",props:{curComponent:{}},setup(o){const e=o,n=V(),a=L(()=>e.curComponent.defaultViewType.propValue),r=L(()=>l()),i=L(()=>e.curComponent?e.curComponent.propFromValue:[]),p=(t,s)=>{n.setCurComponentPropValue(t,s)},l=()=>{const t={common:{name:e.curComponent.name,component:e.curComponent.component,id:e.curComponent.id}};return e.curComponent&&e.curComponent.propValue&&Object.assign(t,e.curComponent.propValue),t};return(t,s)=>(w(),I("div",_o,[h(m(it),{config:i.value,data:r.value,mode:a.value,onChange:p},null,8,["config","data","mode"])]))}}),yo=j(go,[["__scopeId","data-v-1cc3403d"]]),bo={class:"attr-list"},xo=N({__name:"Canvas",setup(o){const e=V(),n=L(()=>e.canvasStyleConfig.formItems),a=L(()=>e.canvasStyleConfig.mode),r=$(e.canvasGlobalData),i=(p,l)=>{e.setCanvasStyle(p,l)};return(p,l)=>(w(),I("div",bo,[h(m(it),{config:n.value,data:r.value,mode:a.value,onChange:i},null,8,["config","data","mode"])]))}}),Co=j(xo,[["__scopeId","data-v-ce2023f8"]]),wo={class:"data-list",style:{height:"calc(100vh - 120px)"}},So=N({__name:"DataAttr",props:{curComponent:{}},setup(o){const e=o,n=Nt(),a=$(It.DEMO),r=L(()=>n.allDataType),i=L(()=>{if(a.value){const l=n.getDataComponent(a.value);return l?l.component:Ne("未发现相应的数据插件")}return Ne("未发现相应的数据插件")}),p=l=>{a.value=l};return oe(()=>{const l=e.curComponent.dataConfig;l&&(a.value=l.type)}),q(()=>e.curComponent,async l=>{if(l){const t=e.curComponent.dataConfig;t&&(a.value=t.type)}},{deep:!0,immediate:!0}),(l,t)=>(w(),I("div",wo,[l.curComponent.dataIntegrationMode===m(qe).UNIVERSAL?(w(),T(m(Je),{key:0,onSubmit:t[1]||(t[1]=Ce(()=>{},["prevent"]))},{default:x(()=>[h(m(ge),{key:"dataType",label:"数据类型"},{default:x(()=>[h(m(Ze),{value:a.value,"onUpdate:value":[t[0]||(t[0]=s=>a.value=s),p],placeholder:"请选择数据类型",options:r.value},null,8,["value","options"])]),_:1}),h(m(i),{curComponent:l.curComponent},null,8,["curComponent"])]),_:1})):(w(),T(m(st),{key:1,class:"placeholder"},{default:x(()=>[h(m(at),null,{default:x(()=>[h(m(Ge),{description:"未发现数据配置项"})]),_:1})]),_:1}))]))}}),Do={class:"attr-list"},ko=N({__name:"StyleList",props:{curComponent:{}},setup(o){const e=o,n=V(),a=$({...e.curComponent.style}),r=L(()=>e.curComponent?e.curComponent.styleFormValue:[]),i=ye((l,t)=>{if(e.curComponent){const s=["top","left","width","height","rotate"];if(l[0]==="position"&&s.includes(l[1])){const v=e.curComponent.parent;n.syncComponentLocation({[l[1]]:t},v,!0),v&&n.resizeAutoComponent(v)}else n.setCurComponentStyle(l,t)}},300);q(()=>e.curComponent.id,()=>{e.curComponent&&e.curComponent.id&&(a.value=ue(e.curComponent.style))},{immediate:!0,deep:!0});const p=ye(()=>{Object.assign(a.value,e.curComponent.positionStyle)},200);return q(()=>e.curComponent.positionStyle,()=>{e.curComponent&&e.curComponent.id&&p()},{deep:!0}),(l,t)=>(w(),I("div",Do,[h(m(tn),{accordion:""},{default:x(()=>[(w(!0),I(te,null,ae(r.value,({label:s,prop:v,children:_})=>(w(),T(m(Qt),{key:`${l.curComponent.id}${v}`,title:s,name:v},{default:x(()=>[h(m(en),{children:_,data:a.value,name:s,uid:v,ukey:l.curComponent.id,onChange:m(i)},null,8,["children","data","name","uid","ukey","onChange"])]),_:2},1032,["title","name"]))),128))]),_:1})]))}}),Lo=j(ko,[["__scopeId","data-v-3266e632"]]),$o={key:0},Ro={key:1},Io=N({__name:"SideBar",props:{iscollapsed:{type:Boolean,default:!1}},emits:["update:iscollapsed"],setup(o,{emit:e}){const a=Xe().appContext.components.XIcon,r=$("attr"),i=V(),p=L(()=>i.curComponent),l=L(()=>i.curComponent?[{label:"样式",key:"4",icon:()=>P(a,{name:"textStyle",onClick:()=>t("style")})},{label:"属性",key:"2",icon:()=>P(a,{name:"attr",onClick:()=>t("attr")})},{label:"数据",key:"3",icon:()=>P(a,{name:"data",onClick:()=>t("data")})}]:[{label:"画布",key:"1",icon:()=>P(a,{name:"page"})}]),t=s=>{e("update:iscollapsed",!1),r.value=s};return(s,v)=>s.iscollapsed?(w(),I("div",Ro,[h(m(be),{options:l.value},null,8,["options"])])):(w(),I("div",$o,[p.value?(w(),T(m(de),{key:0,value:r.value,"onUpdate:value":[v[0]||(v[0]=_=>r.value=_),v[1]||(v[1]=_=>{r.value=_})],type:"line",animated:"","justify-content":"center"},{default:x(()=>[h(m(Y),{name:"style","display-directive":"show:lazy"},{tab:x(()=>[h(m(a),{name:"textStyle"}),A(M("span",null,"样式",512),[[F,!s.iscollapsed]])]),default:x(()=>[h(m(Lo),{curComponent:p.value},null,8,["curComponent"])]),_:1}),h(m(Y),{name:"attr","display-directive":"show:lazy"},{tab:x(()=>[h(m(a),{name:"attr"}),A(M("span",null,"属性",512),[[F,!s.iscollapsed]])]),default:x(()=>[h(m(yo),{curComponent:p.value},null,8,["curComponent"])]),_:1}),h(m(Y),{name:"data","display-directive":"show:lazy"},{tab:x(()=>[h(m(a),{name:"data"}),A(M("span",null,"数据",512),[[F,!s.iscollapsed]])]),default:x(()=>[h(m(So),{curComponent:p.value},null,8,["curComponent"])]),_:1})]),_:1},8,["value"])):(w(),T(m(de),{key:1,type:"line",animated:"","justify-content":"center"},{default:x(()=>[h(m(Y),{name:"canvas","display-directive":"show:lazy"},{tab:x(()=>[h(m(a),{name:"page"}),A(M("span",null,"画布",512),[[F,!s.iscollapsed]])]),default:x(()=>[h(Co)]),_:1})]),_:1}))]))}}),No={class:"tool-bar-title"},To=N({__name:"Toolbar",props:{toolbars:{default:()=>[]}},setup(o){const e=V();return(n,a)=>n.toolbars.length>0?(w(),T(m(sn),{key:0,bars:n.toolbars},{default:x(()=>[M("div",No,ee(m(e).name),1)]),_:1},8,["bars"])):me("",!0)}}),Eo=j(To,[["__scopeId","data-v-ab0cab7e"]]),Bo=N({__name:"Area",setup(o){const e=ct(),n=V(),a=L(()=>e.hidden),r=L(()=>e.style.left),i=L(()=>e.style.top),p=L(()=>e.style.width),l=L(()=>e.style.height),t=q(()=>n.curComponent,()=>{e.components.length>0&&e.setHidden()}),s=()=>{e.compose(),e.setHidden()},v=()=>{e.flushLeft(),e.setHidden()},_=()=>{e.flushRight(),e.setHidden()},d=()=>{e.flushTop(),e.setHidden()},C=()=>{e.flushBottom(),e.setHidden()},D=()=>{e.flushRow(),e.setHidden()},g=()=>{e.flushColumn(),e.setHidden()},b=()=>{e.batchDeleteComponent(e.components),e.setHidden()},S=()=>[{text:"组合",subText:"",disable:!e.canCompose,handler:s},{divider:!0},{text:"删除",subText:"Ctrl + Delete",disable:e.components.length<=0,handler:b},{divider:!0},{text:"左对齐",subText:"",handler:v},{text:"右对齐",subText:"",handler:_},{text:"顶对齐",subText:"",handler:d},{text:"底对齐",subText:"",handler:C},{divider:!0},{text:"水平对齐",subText:"",handler:D},{text:"垂直对齐",subText:"",handler:g}];return we(()=>{t&&t()}),(k,O)=>{const B=Z("contextmenu");return a.value?A((w(),I("div",{key:0,style:W({left:r.value+"px",top:i.value+"px",width:p.value+"px",height:l.value+"px"}),class:"area"},null,4)),[[B,S,void 0,{stop:!0}]]):me("",!0)}}}),Oo=j(Bo,[["__scopeId","data-v-a97db47e"]]),Mo={},jo={class:"grid",width:"100%",height:"100%",xmlns:"http://www.w3.org/2000/svg"},zo=Tt('<defs data-v-9ff3aadd><pattern id="smallGrid" width="7.236328125" height="7.236328125" patternUnits="userSpaceOnUse" data-v-9ff3aadd><path d="M 7.236328125 0 L 0 0 0 7.236328125" fill="none" stroke="rgba(207, 207, 207, 0.3)" stroke-width="1" data-v-9ff3aadd></path></pattern><pattern id="grid" width="36.181640625" height="36.181640625" patternUnits="userSpaceOnUse" data-v-9ff3aadd><rect width="36.181640625" height="36.181640625" fill="url(#smallGrid)" data-v-9ff3aadd></rect><path d="M 36.181640625 0 L 0 0 0 36.181640625" fill="none" stroke="rgba(186, 186, 186, 0.5)" stroke-width="1" data-v-9ff3aadd></path></pattern></defs><rect width="100%" height="100%" fill="url(#grid)" data-v-9ff3aadd></rect>',2),Ao=[zo];function Vo(o,e){return w(),I("svg",jo,Ao)}const Po=j(Mo,[["render",Vo],["__scopeId","data-v-9ff3aadd"]]),Uo={class:"mark-line"},Ho=N({__name:"MarkLine",setup(o){const e=V(),n=$([]),a=ne(["xt","xc","xb","yl","yc","yr"]),r=$(3),i=ne({xt:!1,xc:!1,xb:!1,yl:!1,yc:!1,yr:!1}),p=d=>{n.value.push(d)},l=()=>{Object.keys(i).forEach(d=>{i[d]=!1})};_e("move",d=>{t(d.isDownward,d.isRightward)}),_e(xe.DRAG_STOP,()=>{l()});const t=(d,C)=>{const D=e.componentData;if(e.curComponent){const{top:g,left:b,right:S,bottom:k}=De(e.curComponent.positionStyle),O=(S-b)/2,B=(k-g)/2;l(),D.forEach(U=>{if(U==e.curComponent)return;const H=De(U.positionStyle),{top:c,left:f,bottom:u,right:y}=H,R=(y-f)/2,E=(u-c)/2,z={top:[{isNearly:s(g,c),lineNode:n.value[0],line:"xt",dragShift:c,lineShift:c},{isNearly:s(k,c),lineNode:n.value[0],line:"xt",dragShift:c-(k-g||0),lineShift:c},{isNearly:s((g||0)+B,c+E),lineNode:n.value[1],line:"xc",dragShift:c+E-B,lineShift:c+E},{isNearly:s(g,u),lineNode:n.value[2],line:"xb",dragShift:u,lineShift:u},{isNearly:s(k,u),lineNode:n.value[2],line:"xb",dragShift:u-(k-g||0),lineShift:u}],left:[{isNearly:s(b,f),lineNode:n.value[3],line:"yl",dragShift:f,lineShift:f},{isNearly:s(S,f),lineNode:n.value[3],line:"yl",dragShift:f-(S-b||0),lineShift:f},{isNearly:s((b||0)+O,f+R),lineNode:n.value[4],line:"yc",dragShift:f+R-O,lineShift:f+R},{isNearly:s(b,y),lineNode:n.value[5],line:"yr",dragShift:y,lineShift:y},{isNearly:s(S,y),lineNode:n.value[5],line:"yr",dragShift:y-(S-b||0),lineShift:y}]},G=[],{rotate:fe}=e.curComponent.style;Object.keys(z).forEach(ie=>{z[ie].forEach(J=>{if(!J.isNearly)return;const wt=fe!=0?v(ie,J,{width:S-b,height:k-g}):J.dragShift;e.setCurComponentStyle(["position",ie],wt),J.lineNode.style[ie]=`${J.lineShift}px`,G.push(J.line)})}),G.length&&_(G,d,C)})}},s=(d,C)=>Math.abs(d-C)<=r.value,v=(d,C,D)=>{const{width:g,height:b}=e.curComponent.style;return d=="top"?Math.round(C.dragShift-(b-D.height)/2):Math.round(C.dragShift-(g-D.width)/2)},_=(d,C,D)=>{D?d.includes("yr")?i.yr=!0:d.includes("yc")?i.yc=!0:d.includes("yl")&&(i.yl=!0):d.includes("yl")?i.yl=!0:d.includes("yc")?i.yc=!0:d.includes("yr")&&(i.yr=!0),C?d.includes("xb")?i.xb=!0:d.includes("xc")?i.xc=!0:d.includes("xt")&&(i.xt=!0):d.includes("xt")?i.xt=!0:d.includes("xc")?i.xc=!0:d.includes("xb")&&(i.xb=!0)};return(d,C)=>(w(),I("div",Uo,[(w(!0),I(te,null,ae(a,D=>A((w(),I("div",{key:D,ref_for:!0,ref:p,class:se(["line",D.includes("x")?"xline":"yline"])},null,2)),[[F,i[D]||!1]])),128))]))}}),Fo=j(Ho,[["__scopeId","data-v-08b7df93"]]),Wo=o=>o<=.25?40:o<=.5?20:o<=1?10:o<=2?5:o<=4?2:1,Ve=.83,Xo=(o,e,n,a,r,i)=>{const{scale:p,width:l,height:t,ratio:s,palette:v}=r,{bgColor:_,fontColor:d,shadowColor:C,longfgColor:D,shortfgColor:g}=v;if(o.scale(s,s),o.clearRect(0,0,l,t),o.fillStyle=_,o.fillRect(0,0,l,t),a){const u=(n-e)*p,y=a*p;o.fillStyle=C,i?o.fillRect(u,0,y,t*3/8):o.fillRect(0,u,l*3/8,y)}const b=Wo(p),S=b*p,k=b*10,O=k*p,B=Math.floor(e/b)*b,U=Math.floor(e/k)*k,H=(B-e)/b*S,c=(U-e)/k*O,f=e+Math.ceil((i?l:t)/p);o.beginPath(),o.fillStyle=d,o.strokeStyle=D;for(let u=U,y=0;u<f;u+=k,y++){const R=c+y*O+.5;i?o.moveTo(R,0):o.moveTo(0,R),o.save(),i?o.translate(R,t*.4):o.translate(l*.4,R),i||o.rotate(-Math.PI/2),o.scale(Ve/s,Ve/s),o.fillText(u.toString(),4*s,7*s),o.restore(),i?o.lineTo(R,t*9/16):o.lineTo(l*9/16,R)}o.stroke(),o.closePath(),o.beginPath(),o.strokeStyle=g;for(let u=B,y=0;u<f;u+=b,y++){const R=H+y*S+.5;i?o.moveTo(R,0):o.moveTo(0,R),u%k!==0&&(i?o.lineTo(R,t/4):o.lineTo(l/4,R))}o.stroke(),o.closePath(),o.setTransform(1,0,0,1,0,0)},Yo=N({__name:"index",props:{showIndicator:{type:Boolean},valueNum:{},scale:{},ratio:{},palette:{},vertical:{type:Boolean},start:{},width:{},height:{},selectStart:{},selectLength:{}},emits:["onAddLine","update:showIndicator","update:valueNum"],setup(o,{emit:e}){const n=o,a=ne({canvasContext:null});let r=1;const i=$(null);oe(()=>{r=n.ratio||window.devicePixelRatio||1,p(),l(r),t(r)});const p=()=>{a.canvasContext=i.value&&i.value.getContext("2d")},l=v=>{if(i.value){i.value.width=n.width*v,i.value.height=n.height*v;const _=a.canvasContext;_&&(_.font=`${12*v}px -apple-system,
                "Helvetica Neue", ".SFNSText-Regular",
                "SF UI Text", Arial, "PingFang SC", "Hiragino Sans GB",
                "Microsoft YaHei", "WenQuanYi Zen Hei", sans-serif`,_.lineWidth=1,_.textBaseline="middle")}},t=v=>{const _={scale:n.scale,width:n.width,height:n.height,palette:n.palette,ratio:v};a.canvasContext&&Xo(a.canvasContext,n.start,n.selectStart,n.selectLength,_,!n.vertical)};q(()=>n.start,()=>t(r)),q([()=>n.width,()=>n.height],()=>{l(r),t(r)});const s=(v,_)=>{const d=(g,b,S)=>Math.round(b+g/S),C=n.vertical?v.offsetY:v.offsetX,D=d(C,n.start,n.scale);switch(_){case"click":e("onAddLine",D);break;case"enter":e("update:valueNum",D),e("update:showIndicator",!0);break;default:e("update:valueNum",D);break}};return(v,_)=>(w(),I("canvas",{ref_key:"canvas",ref:i,class:"ruler",onClick:_[0]||(_[0]=d=>s(d,"click")),onMouseenter:_[1]||(_[1]=d=>s(d,"enter")),onMousemove:_[2]||(_[2]=d=>s(d,"move")),onMouseleave:_[3]||(_[3]=d=>v.$emit("update:showIndicator",!1))},null,544))}}),Go=N({__name:"RulerLine",props:{scale:{},thick:{},palette:{},index:{},start:{},vertical:{type:Boolean},value:{},isShowReferLine:{type:Boolean}},emits:["onMouseDown","onRelease","onRemove"],setup(o,{emit:e}){const n=o,a=$(0),r=$(!0);oe(()=>{a.value=n.value});const i=d=>{r.value=d>=0},p=L(()=>{const d=(a.value-n.start)*n.scale;i(d);const C=d+"px";return n.vertical?{top:C}:{left:C}}),l=L(()=>{const d=`1px ${n.palette?.lineBoardStyle||"dashed"} ${n.palette?.lineColor}`,C=n.vertical?{borderTop:d}:{borderLeft:d};return{cursor:n.isShowReferLine?n.vertical?"ns-resize":"ew-resize":"none",...C}}),t=L(()=>n.vertical?{left:n.thick+"px"}:{top:n.thick+"px"}),s=d=>{d.stopPropagation();const C=n.vertical?d.clientY:d.clientX,D=a.value;e("onMouseDown");const g=S=>{const k=n.vertical?S.clientY:S.clientX,O=Math.round(D+(k-C)/n.scale);a.value=O},b=()=>{e("onRelease",a.value,n.index),document.removeEventListener("mousemove",g,!0),document.removeEventListener("mouseup",b)};document.addEventListener("mousemove",g,!0),document.addEventListener("mouseup",b)},v=()=>{e("onRemove",n.index)},_=()=>[{text:"删除",subText:"",handler:()=>v()}];return(d,C)=>{const D=Z("contextmenu");return A((w(),I("div",{class:"line",style:W([p.value,l.value]),onMousedown:s},[M("div",{class:"action",style:W(t.value)},[M("span",{class:se({value:!0,"is-vertical":d.vertical})},ee(a.value),3)],4)],36)),[[F,r.value],[D,_,void 0,{stop:!0}]])}}}),Ko=j(Go,[["__scopeId","data-v-00c9d7ea"]]),qo={class:"lines"},Zo={class:"value"},Jo=N({__name:"RulerWrapper",props:{scale:{},ratio:{},thick:{},selectStart:{},selectLength:{},isShowReferLine:{type:Boolean},palette:{},canvasHeight:{},canvasWidth:{},vertical:{type:Boolean,default:!0},width:{default:200},height:{default:200},start:{default:0}},setup(o,{expose:e}){const n=o;Qe(g=>({"6637e487":s.value,"4a522334":v.value}));const a=$(!1),r=$(0),i=$([]),p=L(()=>n.vertical?"v-container":"h-container");e({clearLines:()=>{i.value=[]}});const t=L(()=>{const g={width:`calc(100% - ${n.thick}px)`,height:`${n.thick+1}px`,left:`${n.start}px`},b={width:`${n.thick&&n.thick+1}px`,height:`calc(100% - ${n.thick}px)`,top:`${n.start}px`};return n.vertical?b:g}),s=L(()=>n.vertical?"100vh":`${n.canvasHeight}px`),v=L(()=>n.vertical?`${n.canvasWidth}px`:"100vw"),_=L(()=>{const g=(r.value-(n.start||0))*n.scale,b=n.vertical?"top":"left",S=n.vertical?"borderBottom":"borderLeft";return{[b]:g+"px",[S]:`1px ${n.palette?.lineBoardStyle||"dashed"} ${n.palette?.lineColor}`}}),d=g=>{i.value.push(g)},C=(g,b)=>{const S=g-(n.start||0),k=(n.vertical?n.height||200:n.width||200)/n.scale;S<0||S>k?D(b):i.value[b]=g},D=g=>{i.value.splice(g,1)};return(g,b)=>(w(),I("div",{class:se(p.value),style:W(t.value)},[h(Yo,{valueNum:r.value,"onUpdate:valueNum":b[0]||(b[0]=S=>r.value=S),showIndicator:a.value,"onUpdate:showIndicator":b[1]||(b[1]=S=>a.value=S),vertical:g.vertical,scale:g.scale,width:g.width,height:g.height,start:g.start,ratio:g.ratio,"select-start":g.selectStart,"select-length":g.selectLength,palette:g.palette,onOnAddLine:d},null,8,["valueNum","showIndicator","vertical","scale","width","height","start","ratio","select-start","select-length","palette"]),A(M("div",qo,[(w(!0),I(te,null,ae(i.value,(S,k)=>(w(),T(Ko,{key:S+k,index:k,value:S>>0,scale:g.scale,start:g.start,thick:g.thick,palette:g.palette,vertical:g.vertical,"is-show-refer-line":g.isShowReferLine,onOnRemove:D,onOnRelease:C},null,8,["index","value","scale","start","thick","palette","vertical","is-show-refer-line"]))),128))],512),[[F,g.isShowReferLine]]),A(M("div",{class:"indicator",style:W(_.value)},[M("div",Zo,ee(r.value),1)],4),[[F,a.value]])],6))}}),Pe=j(Jo,[["__scopeId","data-v-e634d69a"]]),Qo={id:"mb-ruler",class:"style-ruler mb-ruler"},ea=N({__name:"Index",props:{scale:{default:1},ratio:{default:0},thick:{default:16},palette:{},startX:{},startY:{},width:{default:200},height:{default:200},shadow:{}},setup(o){const e=o,n=$(null),a=$(null),r=$(!0),i=()=>{n.value?.clearLines(),a.value?.clearLines(),r.value=!0},p=()=>[{text:"显示辅助线",subText:"",disable:r.value,handler:()=>r.value=!0},{text:"隐藏辅助线",subText:"",disable:!r.value,handler:()=>r.value=!1},{text:"清空辅助线",subText:"",disable:!r.value,handler:i}],l=L(()=>{function t(s,v){return Object.keys(s).forEach(_=>{_&&s.hasOwnProperty(_)&&(typeof v.key=="object"?s[_]=t(s[_],v[_]):v.hasOwnProperty(_)&&(s[_]=v[_]))}),s}return t({bgColor:"rgba(225,225,225, 0)",longfgColor:"#BABBBC",shortfgColor:"#C8CDD0",fontColor:"#7D8694",shadowColor:"#E8E8E8",lineColor:"#37d4cf",lineBoardStyle:"dashed",borderColor:"#DADADC",cornerActiveColor:"rgb(235, 86, 72, 0.6)",menu:{bgColor:"#fff",dividerColor:"#DBDBDB",listItem:{textColor:"#415058",hoverTextColor:"#298DF8",disabledTextColor:"rgba(65, 80, 88, 0.4)",bgColor:"#fff",hoverBgColor:"#F2F2F2"}}},e.palette||{})});return(t,s)=>{const v=Z("contextmenu");return A((w(),I("div",Qo,[h(Pe,{ref_key:"HRulerWrapperRef",ref:a,vertical:!1,width:t.width,height:16,"canvas-height":t.height,"canvas-width":t.width,"is-show-refer-line":r.value,thick:t.thick,ratio:t.ratio,start:t.startX,"select-start":t.shadow?.x||0,"select-length":t.shadow?.width||0,scale:t.scale,palette:l.value},null,8,["width","canvas-height","canvas-width","is-show-refer-line","thick","ratio","start","select-start","select-length","scale","palette"]),h(Pe,{ref_key:"VRulerWrapperRef",ref:n,vertical:!0,width:16,height:t.height,"canvas-height":t.height,"canvas-width":t.width,"is-show-refer-line":r.value,thick:t.thick,ratio:t.ratio,start:t.startY,"select-start":t.shadow?.y||0,"select-length":t.shadow?.height||0,scale:t.scale,palette:l.value},null,8,["height","canvas-height","canvas-width","is-show-refer-line","thick","ratio","start","select-start","select-length","scale","palette"])])),[[v,p,void 0,{stop:!0}]])}}}),ta=1,na=0,oa=0,aa=20,sa=N({__name:"Ruler",props:{width:{},height:{},isShowReferLine:{type:Boolean}},setup(o){const e={h:[],v:[]};return(n,a)=>(w(),T(m(ea),{thick:aa,scale:ta,width:n.width,height:n.height,startX:na,startY:oa,lines:e,isShowReferLine:n.isShowReferLine},null,8,["width","height","isShowReferLine"]))}}),ia=j(sa,[["__scopeId","data-v-1810a66a"]]),la=["onMousedown"],ca=N({__name:"Editor",setup(o){const e=ct(),n=lt(),a=V(),r=c=>$e(c,["top","left","width","height","rotate"]),i=()=>{a.clearCanvas()},p=(c,f)=>{const u=document.querySelector("#editor").getBoundingClientRect(),y=f.pageY-u.top,R=f.pageX-u.left;n.paste(!0,R,y)},l=()=>[{text:"粘贴",subText:"Ctrl + V",handler:p},{text:"清空画布",subText:"",handler:i}];oe(()=>{ke.log("进入编辑模式"),a.setEditMode(Le.EDIT),document.addEventListener("paste",C),document.addEventListener("copy",d)}),we(()=>{ke.log("进入预览模式"),a.setEditMode(Le.PREVIEW),document.removeEventListener("paste",C),document.removeEventListener("copy",d),a.clearCanvas()});const t=L(()=>a.componentData),s=L(()=>a.canvasStyleData),v=L(()=>a.curComponent),_=L(()=>{const c=Et(s.value.background),f={...s.value,...c};return $e(f,["width","height","backgroundImage","backgroundSize","backgroundColor"])}),d=()=>{a.curComponent&&n.copy(a.curComponent)},C=c=>{if(c.clipboardData){const f=c.clipboardData.getData("text");try{const u=Bt(JSON.parse(f));u&&(u.change(["position","top"],u.positionStyle.top+10,"style"),u.change(["position","left"],u.positionStyle.left+10,"style"),u.id=Ke(),n.copy(u),c.preventDefault(),c.stopPropagation(),a.appendComponent(u))}catch{}}},D=$(0),g=$(0),b=ne({x:0,y:0}),S=$(null),k=$(!0),O=c=>{a.setClickComponentStatus(!1),c.preventDefault(),c.stopPropagation(),e.setHidden();const f=S.value?.getBoundingClientRect();D.value=f.x,g.value=f.y;const u=c.clientX,y=c.clientY;b.x=(u-D.value)/a.scale,b.y=(y-g.value)/a.scale;const R=z=>{z.preventDefault(),z.stopPropagation(),z.clientX<u&&(b.x=(z.clientX-D.value)/a.scale),z.clientY<y&&(b.y=(z.clientY-g.value)/a.scale);const G=Math.abs(z.clientX-u)/a.scale,fe=Math.abs(z.clientY-y)/a.scale;e.setPostion({left:b.x,top:b.y,width:G,height:fe})},E=z=>{if(document.removeEventListener("mousemove",R),document.removeEventListener("mouseup",E),z.clientX==u&&z.clientY==y){e.setHidden();return}const G={left:Math.round(e.style.left),top:Math.round(e.style.top),right:e.style.left+e.style.width,bottom:e.style.top+e.style.height};e.setSelectComponents(G)};document.addEventListener("mousemove",R),document.addEventListener("mouseup",E)},B=async c=>{c.preventDefault(),c.stopPropagation();const f=c.dataTransfer.getData("componentName");if(f){const u=new ve[f];u.dataIntegrationMode===qe.UNIVERSAL&&u.loadDemoData();const y=document.querySelector("#editor").getBoundingClientRect(),R=(c.pageY-y.top)/a.scale,E=(c.pageX-y.left)/a.scale;u.change(["position","top"],R,"style"),u.change(["position","left"],E,"style"),a.appendComponent(u)}},U=c=>{c.preventDefault(),c.dataTransfer.dropEffect="copy"},H=()=>{a.isClickComponent||a.setCurComponent(void 0)};return(c,f)=>{const u=Z("contextmenu");return A((w(),I("div",{id:"editor",ref_key:"editor",ref:S,class:"editor edit",style:W(_.value),onMousedown:Ce(O,["left"]),onDrop:B,onDragover:U,onMouseup:H},[h(Po),h(ia,{width:s.value.width,height:s.value.height,isShowReferLine:k.value},null,8,["width","height","isShowReferLine"]),(w(!0),I(te,null,ae(t.value,(y,R)=>(w(),I(te,{key:y.id},[m(a).isEditMode&&y.display?(w(),T(m(an),{key:0,id:"shape"+y.id,defaultStyle:y.style,style:W(r(y.style)),active:y.id===(v.value||{}).id,info:y,class:se({lock:y.locked}),index:R},{default:x(()=>[(w(),T(Ot(y.component),{id:"component"+y.id,class:"component",style:W(m(Mt)(y)),component:y},null,8,["id","style","component"]))]),_:2},1032,["id","defaultStyle","style","active","info","class","index"])):me("",!0)],64))),128)),h(Fo),h(Oo)],44,la)),[[u,l,void 0,{stop:!0}]])}}}),ra=j(ca,[["__scopeId","data-v-d77b0306"]]),ua=N({__name:"Canvas",setup(o){Qe(k=>({"4e84059f":p.value,"09459163":a.value+"px"}));const e=$(0),n=$(0),a=$(35),r=$(100),i=$("100%"),p=$(1),l=V(),t=[{value:200,label:"200%"},{value:150,label:"150%"},{value:100,label:"100%"},{value:80,label:"80%"},{value:50,label:"50%"}],s=ao(),{primaryColor:v,cubicBezierEaseInOut:_}=s.value,d=L(()=>({width:e.value+"px",height:n.value+"px"})),C=k=>{const{width:O,height:B}=k.contentRect;e.value=O,n.value=B-a.value},D=k=>{i.value=`${k}%`,r.value=k,g(r.value)},g=ye(k=>{l.setScale(k),p.value=k/100},300),b=$();function S(k){const{altKey:H,metaKey:c,deltaY:f}=k;let u=r.value;(H||c)&&(k.preventDefault(),10<u&&u<200?u=f>0?u+10:u-10:u<=10&&f>0?u+=10:u>=200&&f<0&&(u-=10),D(u))}return oe(()=>{b.value.$el.addEventListener("wheel",S,!1)}),jt(()=>{b.value.$el.removeEventListener("wheel",S,!1)}),(k,O)=>{const B=Z("resize");return A((w(),T(m(re),{ref_key:"centerCanvas",ref:b},{default:x(()=>[h(m(zt),{class:"content"},{default:x(()=>[h(m(rn),{"x-scrollable":"",style:W(d.value)},{default:x(()=>[h(m(ra))]),_:1},8,["style"])]),_:1}),h(m(cn),{position:"absolute",class:"footer"},{default:x(()=>[h(m(et),{justify:"end",align:"center",style:{height:"100%","margin-right":"5px"}},{default:x(()=>[h(m(oo),{tag:"span",style:W({color:m(v),transition:`all 0.3s ${m(_)}`})},{default:x(()=>[ce(" 画布缩放: ")]),_:1},8,["style"]),h(m(nn),{value:r.value,min:10,max:200,style:{width:"120px"},"onUpdate:value":D},null,8,["value"]),h(m(Ze),{value:i.value,options:t,size:"tiny",style:{width:"90px"},"onUpdate:value":D},null,8,["value"])]),_:1})]),_:1})]),_:1})),[[B,C]])}}}),da=j(ua,[["__scopeId","data-v-72188e0c"]]),pa=N({__name:"Designer",props:{toolbars:{default:()=>[]}},setup(o,{expose:e}){const n=V(),a=$(!1),r=$(!1);return At("HOOKS",Vt(on)),e({setLayoutData:p=>{n.setLayoutData(p)}}),we(()=>{n.clearCanvas()}),(p,l)=>(w(),T(m(re),{class:"home"},{default:x(()=>[h(m(Pt),{class:"header"},{default:x(()=>[h(m(Eo),{toolbars:p.toolbars},null,8,["toolbars"])]),_:1}),h(m(re),{"has-sider":"",class:"main"},{default:x(()=>[h(m(Re),{class:"left",width:"200",collapsed:a.value,"native-scrollbar":!1,bordered:"","collapse-mode":"width","show-trigger":"",onCollapse:l[2]||(l[2]=t=>a.value=!0),onExpand:l[3]||(l[3]=t=>a.value=!1)},{default:x(()=>[h(m(vo),{iscollapsed:a.value,"onUpdate:iscollapsed":[l[0]||(l[0]=t=>a.value=t),l[1]||(l[1]=t=>{a.value=t})]},null,8,["iscollapsed"])]),_:1},8,["collapsed"]),h(m(re),{"has-sider":"","sider-placement":"right"},{default:x(()=>[h(da),h(m(Re),{class:"right",width:"240",collapsed:r.value,"native-scrollbar":!1,bordered:"","collapsed-width":35,"collapse-mode":"width","show-trigger":"arrow-circle",onCollapse:l[6]||(l[6]=t=>r.value=!0),onExpand:l[7]||(l[7]=t=>r.value=!1)},{default:x(()=>[h(m(Io),{iscollapsed:r.value,"onUpdate:iscollapsed":[l[4]||(l[4]=t=>r.value=t),l[5]||(l[5]=t=>{r.value=t})]},null,8,["iscollapsed"])]),_:1},8,["collapsed"])]),_:1})]),_:1})]),_:1}))}}),ma=j(pa,[["__scopeId","data-v-b4275b0d"]]),Ct=Ft(),K=V(),fa=async()=>{const o=await Ct.lastRecord();o?K.setLayoutData({canvasData:o.canvasData,canvasStyle:o.canvasStyle}):X.warning("没有快照了")},ha=async()=>{const o=await Ct.nextRecord();o?K.setLayoutData({canvasData:o.canvasData,canvasStyle:o.canvasStyle}):X.warning("没有快照了")},va=()=>{K.toggleShowEm()},_a=o=>{const e=`${K.name}`||"OpenDataV";Ut(`${e}.json`,JSON.stringify({id:o,name:e,canvasData:K.layoutData,canvasStyle:K.canvasStyleData}))},ga=()=>{Ht(ya,".json")},ya=o=>{if(o.target&&o.target.result){const e=JSON.parse(o.target.result);e&&K.setComponentData(e.canvasData)}},ba="2946854",xa="方向",Ca="iconfont",wa="icon-",Sa="",Da=[{icon_id:"11291350",name:"组",font_class:"zu",unicode:"e854",unicode_decimal:59476},{icon_id:"1817751",name:"柱形图",font_class:"zhuxingtu",unicode:"e626",unicode_decimal:58918},{icon_id:"3868284",name:"仪表盘",font_class:"yibiaopan",unicode:"eb67",unicode_decimal:60263},{icon_id:"4354243",name:"图表-饼图",font_class:"tubiao-bingtu",unicode:"eb95",unicode_decimal:60309},{icon_id:"4354246",name:"图表-卡片",font_class:"tubiao-qiapian",unicode:"eb96",unicode_decimal:60310},{icon_id:"4354248",name:"图表-折线图",font_class:"tubiao-zhexiantu",unicode:"eb97",unicode_decimal:60311},{icon_id:"4906240",name:"按钮组",font_class:"anniuzu",unicode:"e782",unicode_decimal:59266},{icon_id:"5383645",name:"导航",font_class:"daohang",unicode:"e77d",unicode_decimal:59261},{icon_id:"5961366",name:"列表",font_class:"liebiao",unicode:"ec6b",unicode_decimal:60523},{icon_id:"5971297",name:"采煤机",font_class:"caimeiji",unicode:"e603",unicode_decimal:58883},{icon_id:"7040619",name:"其他",font_class:"qita",unicode:"e63b",unicode_decimal:58939},{icon_id:"7556180",name:"定制",font_class:"dingzhi",unicode:"e609",unicode_decimal:58889},{icon_id:"9752796",name:"基础",font_class:"jichu",unicode:"e60f",unicode_decimal:58895},{icon_id:"9921108",name:"chart",font_class:"chartt",unicode:"e60a",unicode_decimal:58890},{icon_id:"14475731",name:"装饰装修",font_class:"zhuangshizhuangxiu",unicode:"e6a6",unicode_decimal:59046},{icon_id:"16562592",name:"温度计",font_class:"wenduji",unicode:"e6de",unicode_decimal:59102},{icon_id:"22712019",name:"条形进度图",font_class:"tiaoxingjindutu",unicode:"e66b",unicode_decimal:58987},{icon_id:"22761375",name:"边框",font_class:"biankuang",unicode:"e6b7",unicode_decimal:59063},{icon_id:"22885432",name:"进度图",font_class:"jindutu",unicode:"f24b",unicode_decimal:62027},{icon_id:"124495",name:"警告",font_class:"jinggao1",unicode:"e601",unicode_decimal:58881},{icon_id:"1846445",name:"预警灯",font_class:"yujingdeng",unicode:"e67f",unicode_decimal:59007},{icon_id:"2239579",name:"自动系统警告灯",font_class:"zidongxitongjinggaodeng1",unicode:"e605",unicode_decimal:58885},{icon_id:"4988542",name:"预警",font_class:"yujing1",unicode:"e644",unicode_decimal:58948},{icon_id:"9974390",name:"预警",font_class:"yujing3",unicode:"e6fe",unicode_decimal:59134},{icon_id:"10817515",name:"警告灯",font_class:"jinggaodeng",unicode:"e64b",unicode_decimal:58955},{icon_id:"14151833",name:"报警",font_class:"baojing1",unicode:"e630",unicode_decimal:58928},{icon_id:"16965399",name:"警告灯",font_class:"hong",unicode:"e60d",unicode_decimal:58893},{icon_id:"20379044",name:"预警灯",font_class:"yujingdeng1",unicode:"e623",unicode_decimal:58915},{icon_id:"23819336",name:"报警 警告 预警 警告灯",font_class:"a-baojingjinggaoyujingjinggaodeng",unicode:"e628",unicode_decimal:58920},{icon_id:"24312218",name:"light",font_class:"light",unicode:"e63a",unicode_decimal:58938},{icon_id:"24614518",name:"告警灯",font_class:"gaojingdeng9",unicode:"e664",unicode_decimal:58980},{icon_id:"25567211",name:"警告灯",font_class:"jinggaodeng1",unicode:"e613",unicode_decimal:58899},{icon_id:"12041083",name:"预警",font_class:"yujing5",unicode:"e671",unicode_decimal:58993},{icon_id:"577357",name:"删除",font_class:"shanchu",unicode:"e74b",unicode_decimal:59211},{icon_id:"1986988",name:"删除",font_class:"shanchu1",unicode:"e625",unicode_decimal:58917},{icon_id:"12795401",name:"首页",font_class:"shouye",unicode:"e62d",unicode_decimal:58925},{icon_id:"201556",name:"查看",font_class:"chakan",unicode:"e600",unicode_decimal:58880},{icon_id:"201638",name:"编辑",font_class:"bianji",unicode:"e602",unicode_decimal:58882},{icon_id:"11729723",name:"复制",font_class:"fuzhi",unicode:"e608",unicode_decimal:58888},{icon_id:"7269302",name:"首页-默认",font_class:"shouye-moren",unicode:"e619",unicode_decimal:58905},{icon_id:"658044",name:"解锁",font_class:"jiesuo",unicode:"e669",unicode_decimal:58985},{icon_id:"10097949",name:"旋转",font_class:"xuanzhuan",unicode:"e680",unicode_decimal:59008},{icon_id:"374774",name:"开关",font_class:"kaiguan",unicode:"e61f",unicode_decimal:58911},{icon_id:"122162",name:"时钟",font_class:"clock",unicode:"e63e",unicode_decimal:58942},{icon_id:"1242185",name:"反馈信息",font_class:"fankuixinxi",unicode:"e660",unicode_decimal:58976},{icon_id:"2468505",name:"37类建筑修理x16",font_class:"leijianzhuxiulix",unicode:"e695",unicode_decimal:59029},{icon_id:"11747267",name:"时间",font_class:"weibiaoti-",unicode:"e618",unicode_decimal:58904},{icon_id:"14794143",name:"sds_第37类 建筑修理",font_class:"sds_di37leijianzhuxiuli",unicode:"e61e",unicode_decimal:58910},{icon_id:"17762035",name:"联动控制",font_class:"liandongkongzhi",unicode:"e624",unicode_decimal:58916},{icon_id:"18165278",name:"锁,密码,开锁,解锁",font_class:"unlock-full",unicode:"e882",unicode_decimal:59522},{icon_id:"288554",name:"ascend",font_class:"ascend",unicode:"e6b4",unicode_decimal:59060},{icon_id:"288556",name:"falling",font_class:"falling",unicode:"e6b6",unicode_decimal:59062},{icon_id:"815867",name:"按钮-关",font_class:"buttonoff",unicode:"e614",unicode_decimal:58900},{icon_id:"815872",name:"按钮-开",font_class:"buttonon",unicode:"e615",unicode_decimal:58901},{icon_id:"2674878",name:"箭头 上",font_class:"jiantoushang",unicode:"e62c",unicode_decimal:58924},{icon_id:"2674928",name:"箭头 右",font_class:"jiantouyou",unicode:"e632",unicode_decimal:58930},{icon_id:"2674929",name:"箭头 下",font_class:"jiantouxia",unicode:"e633",unicode_decimal:58931},{icon_id:"7594038",name:"24gl-next",font_class:"24gl-next",unicode:"ea6b",unicode_decimal:60011},{icon_id:"7594046",name:"24gl-pauseCircle",font_class:"24gl-pauseCircle",unicode:"ea6f",unicode_decimal:60015},{icon_id:"7594068",name:"24gl-previous",font_class:"24gl-previous",unicode:"ea73",unicode_decimal:60019},{icon_id:"7594086",name:"24gl-stopCircle",font_class:"24gl-stopCircle",unicode:"ea79",unicode_decimal:60025},{icon_id:"10268256",name:"按钮_开启",font_class:"anniu_kaiqi",unicode:"e659",unicode_decimal:58969},{icon_id:"10268257",name:"按钮_关闭",font_class:"anniu_guanbi",unicode:"e65b",unicode_decimal:58971},{icon_id:"25807963",name:"箭头 上",font_class:"jiantoushangzuo-copy",unicode:"ec63",unicode_decimal:60515},{icon_id:"25808146",name:"向右2",font_class:"xiangzuo2-copy",unicode:"ec64",unicode_decimal:60516},{icon_id:"166602",name:"关闭播放",font_class:"guanbibofang",unicode:"e61d",unicode_decimal:58909},{icon_id:"577396",name:"向上3",font_class:"xiangshang3",unicode:"e76f",unicode_decimal:59247},{icon_id:"577401",name:"向下5",font_class:"xiangxia5",unicode:"e774",unicode_decimal:59252},{icon_id:"577403",name:"向右2",font_class:"xiangyou2",unicode:"e776",unicode_decimal:59254},{icon_id:"1159910",name:"右播放",font_class:"youbofang",unicode:"e62e",unicode_decimal:58926},{icon_id:"1159911",name:"左播放",font_class:"zuobofang",unicode:"e62f",unicode_decimal:58927},{icon_id:"1185945",name:"播放",font_class:"bofang2",unicode:"e606",unicode_decimal:58886},{icon_id:"1488892",name:"播放",font_class:"bofang5",unicode:"e607",unicode_decimal:58887},{icon_id:"1727559",name:"323向左交换",font_class:"xiangzuojiaohuan",unicode:"e8f8",unicode_decimal:59640},{icon_id:"1727561",name:"324向右交换",font_class:"xiangyoujiaohuan",unicode:"e8f9",unicode_decimal:59641},{icon_id:"2076218",name:"播放2",font_class:"bofang6",unicode:"e87c",unicode_decimal:59516},{icon_id:"7594051",name:"24gl-playCircle",font_class:"24gl-playCircle",unicode:"ea6e",unicode_decimal:60014},{icon_id:"11121478",name:"向上",font_class:"xiangshang7",unicode:"e63c",unicode_decimal:58940},{icon_id:"16388177",name:"播放",font_class:"bofang26",unicode:"e60e",unicode_decimal:58894},{icon_id:"18176557",name:"播放",font_class:"play1",unicode:"ea8d",unicode_decimal:60045},{icon_id:"24267227",name:"播放-快退",font_class:"bofang-kuaitui",unicode:"e68a",unicode_decimal:59018},{icon_id:"24267260",name:"播放09",font_class:"bofang09",unicode:"e690",unicode_decimal:59024},{icon_id:"24268374",name:"播放-快进",font_class:"bofang-kuaijin",unicode:"e6d8",unicode_decimal:59096},{icon_id:"25807740",name:"向上",font_class:"xiangxia7",unicode:"ec62",unicode_decimal:60514}],ka={id:ba,name:xa,font_family:Ca,css_prefix_text:wa,description:Sa,glyphs:Da},La={class:"icon-list"},$a=["onClick"],Ra=N({__name:"IconFont",setup(o){const e=L(()=>ka.glyphs.map(i=>`icon-${i.font_class}`)),n=$(!0),a=()=>{n.value=!1},r=i=>{Wt(i),X.success(`复制图标: ${i}`)};return(i,p)=>(w(),T(nt,null,{default:x(()=>[h(m(tt),{class:"show-card",show:n.value,preset:"card",title:`图标数量${e.value.length}`,style:{width:"50%","max-width":"800px"},onMaskClick:a,onClose:a,"onUpdate:show":p[0]||(p[0]=l=>n.value=!1)},{default:x(()=>[M("ul",La,[(w(!0),I(te,null,ae(e.value,l=>(w(),I("li",{key:l,class:"dib",onClick:t=>r(l)},[M("span",{class:se(`icon iconfont ${l}`)},null,2)],8,$a))),128))])]),_:1},8,["show","title"])]),_:1}))}});const Ia=j(Ra,[["__scopeId","data-v-5f644279"]]),Na=()=>{const o=h(Ia,{},null),e=document.createElement("div"),n=document.querySelector("#app");ot(o,e),n?.appendChild(e)},Ta=Na,Ea=N({__name:"SavePage",props:{index:{}},setup(o){const e=o,n=V(),a=$(!0),r=ne({name:n.name,thumbnail:n.thumbnail}),i=ne({name:[{required:!0,message:"请输入页面名称",trigger:"blur"}]}),p=async l=>{const{name:t,thumbnail:s}=r;if(!t){X.error("请输入页面名称");return}const v={name:t,thumbnail:s,canvasData:n.layoutData,canvasStyle:n.canvasStyleData};if(l==="update")try{(await qt(e.index,v)).status===200&&(X.success("修改成功"),n.name!==t&&n.setName(t))}catch{X.error("保存失败，请导出到本地，并重新进入此页面")}finally{a.value=!1}else try{const _=await Zt(v);_.status===201&&(X.success("保存成功"),await Xt.push({name:"Editor",params:{index:_.data.id}}))}catch(_){X.error(`保存失败，失败信息:${_?.message||_}`)}finally{a.value=!1}};return(l,t)=>(w(),T(nt,null,{default:x(()=>[h(m(tt),{show:a.value,"mask-closable":!1,preset:"card",center:"",title:"保存当前布局",style:{width:"30%","min-width":"600px"},size:"medium","onUpdate:show":t[6]||(t[6]=s=>a.value=!1)},{footer:x(()=>[h(m(et),null,{default:x(()=>[h(m(he),{onClick:t[3]||(t[3]=s=>a.value=!1)},{default:x(()=>[ce("取消")]),_:1}),l.index?(w(),T(m(he),{key:1,type:"primary",onClick:t[5]||(t[5]=s=>p("update"))},{default:x(()=>[ce("更新")]),_:1})):(w(),T(m(he),{key:0,type:"primary",onClick:t[4]||(t[4]=s=>p("new"))},{default:x(()=>[ce("新增")]),_:1}))]),_:1})]),default:x(()=>[h(m(Je),{model:r,rules:i,onSubmit:t[2]||(t[2]=Ce(()=>{},["prevent"]))},{default:x(()=>[h(m(ge),{label:"页面名称",prop:"name"},{default:x(()=>[h(m(Ie),{value:r.name,"onUpdate:value":t[0]||(t[0]=s=>r.name=s),placeholder:"请输入页面名称"},null,8,["value"])]),_:1}),h(m(ge),{label:"页面缩略图",prop:"thumbnail"},{default:x(()=>[h(m(Ie),{value:r.thumbnail,"onUpdate:value":t[1]||(t[1]=s=>r.thumbnail=s),placeholder:"请输入缩略图地址"},null,8,["value"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["show"])]),_:1}))}}),Ba=o=>{const e=h(Ea,{index:o},null),n=document.createElement("div");ot(e,n)},Oa=Ba,Ma=N({__name:"ThemeIcon",setup(o){const e=Fe("DarkTheme",L(()=>!0)),n=L(()=>e.value?"sun":"moon");return(a,r)=>{const i=pe("x-icon");return w(),T(i,{name:n.value},null,8,["name"])}}}),le=Yt(),ja=()=>{le.setNavTheme(le.darkTheme?"dark":"light"),le.setDarkTheme(!le.darkTheme)};function za(o,e){return[{label:"首页",action:async n=>{await o.push({name:"Pages"})},icon:()=>P(ln,{width:"40px"}),divider:!0},{label:"保存",action:()=>Oa(e.params.index),icon:"save"},{label:"预览",action:n=>{const{href:a}=o.resolve("/preview");window.open(a,"_blank")},icon:"preview"},{label:"撤销",action:fa,icon:"back"},{label:"恢复",action:ha,icon:"next"},{label:"导出",action:()=>_a(e.params.index||""),icon:"download"},{label:"导入",action:ga,icon:"upload"},{label:"全屏",action:()=>{const n=document.querySelector("#editor");document.fullscreenEnabled&&n&&n.requestFullscreen()},icon:"fullScreen"},{label:"坐标",action:va,icon:"axis"},{label:"图标",action:Ta,icon:"cube",location:"right"},{label:"主题",action:ja,icon:()=>P(Ma),location:"right"},{label:"GitHub",action:()=>{window.open("https://github.com/AnsGoo/openDataV","_blank")},icon:"github",location:"right"}]}const qa=N({__name:"View",setup(o){const e=Gt(),n=Kt(),a=za(n,e),r=$(null);oe(async()=>{const p=e.params.index;p&&await i(p)});const i=async p=>{const l=await Jt(p);l.data&&r.value.setLayoutData(l.data)};return(p,l)=>(w(),T(m(ma),{ref_key:"designer",ref:r,toolbars:m(a)},null,8,["toolbars"]))}});export{qa as default};
