import{d as a,r as e,am as t,aq as s,o as l,c as n,w as u,f as d,a as c,I as o,az as i,ab as r,a0 as v,aA as p,at as f,u as m,aE as _,g as h,e as g,bF as y,aZ as b,aa as w,p as x,v as C,F as S,E as k,L as N,D as j,a7 as E,N as I,b as J,a8 as O,bG as U,y as T,bH as z}from"./index-40170f2c.js";import{a as R}from"./index.esm-44336620.js";import{a as F}from"./index-63f72026.js";import{N as H}from"./Input-a9564eda.js";import{N as K,a as L}from"./Space-244346c3.js";import{N as P,a as Y,T as Z}from"./Toolbar-9b72c1df.js";import{N as $,a as q,b as A,c as D}from"./li-47eba7d2.js";import"./LogoView-3805b629.js";const G={class:"buttons"},V={class:"footer"},W=r(a({__name:"Editor",props:{value:{},config:{default:()=>({height:"600px",tabSize:4,indentWithTab:!0,autofocus:!0,disabled:!1})},mode:{default:"use"}},emits:["update:value","change"],setup(a,{emit:r}){const v=e(!0),p=a,f=r,m=e(p.value),_=()=>{f("update:value",m.value),f("change",m.value)},h=e(null),g=()=>{const a=h.value.handleRedo;a&&a()},y=()=>{const a=h.value.handleUndo;a&&a()};return t((()=>p.value),(()=>{p.value&&(m.value=p.value)})),(a,e)=>{const t=s("x-icon"),r=s("OCodeEditor");return l(),n(r,{ref_key:"cm",ref:h,value:m.value,"onUpdate:value":[e[0]||(e[0]=a=>m.value=a),_]},{"tool-bar":u((()=>[d("div",null,[d("div",G,[c(t,{class:"item button",name:"back",onClick:y}),c(t,{class:"item button",name:"next",onClick:g})])])])),footer:u((()=>[d("div",V,[d("div",{class:o(["saved-status",v.value?"save":"unsave"])},i(v.value?"已保存":"未保存"),3)])])),_:1},8,["value"])}}}),[["__scopeId","data-v-daca5e4b"]]),X={class:"static-data"},B=r(a({__name:"Conetent",setup(a){const t=v({id:"",title:"",code:""}),o=e(JSON.stringify({},null,"\t")),i=a=>{o.value=a},r=async a=>{t.code=a};p(f.SRCIPT_KEY,(async a=>{await S(a)}));const x=e(""),C=()=>{const a=t.code?R("Javascript",t.code,["resp","options"]):void 0;if(a&&a.handler)try{x.value=JSON.stringify(a.handler(JSON.parse(o.value),{}),null,"\t")}catch(e){x.value=e.message||e}else x.value=JSON.stringify(o.value,null,"\t")},S=async a=>{try{const e=await(async a=>F.get({url:`/dataset/script/${a}/`}))(a);if(200===e.status){const a=e.data;t.id=a.id,t.title=a.name,t.code=a.code}}catch(e){w.log(e||e.message)}},k=async()=>{try{const a=await(async a=>F.post({url:"/dataset/script/",data:a}))({code:t.code,name:t.title||"未命名"});if(201===a.status){const e=a.data;t.id=e.id,t.title=e.name,t.code=e.code,b.info("数据保存成功")}else b.warning("数据保存失败")}catch(a){b.warning("数据保存失败")}},N=async()=>{if(t.id)try{200===(await(async(a,e)=>F.put({url:`/dataset/script/${a}/`,data:{...e,id:a}}))(t.id,{code:t.code,name:t.title||"未命名"})).status?b.info("数据更新成功"):b.warning("数据更新失败")}catch(a){b.warning("数据更新失败")}};return(a,e)=>{const v=s("x-icon"),p=s("OCodeEditor");return l(),n(m(g),null,{default:u((()=>[d("div",X,[c(m(H),{value:t.title,"onUpdate:value":e[0]||(e[0]=a=>t.title=a),class:"title"},{prefix:u((()=>[c(v,{name:"code"})])),_:1},8,["value"]),c(m(K),null,{default:u((()=>[c(m(L),{class:"save"},{default:u((()=>[c(m(_),{type:"success",onClick:C},{default:u((()=>[h("运行")])),_:1})])),_:1})])),_:1}),c(m(K),null,{default:u((()=>[c(m(L),{class:"save"},{default:u((()=>[c(m(_),{onClick:e[1]||(e[1]=a=>t.id?N():k())},{default:u((()=>[h("保存")])),_:1})])),_:1})])),_:1})]),c(m(g),null,{default:u((()=>[c(m(P),null,{default:u((()=>[c(m(Y),{name:"脚本"},{default:u((()=>[c(W,{value:t.code,class:"content","onUpdate:value":r},null,8,["value"])])),_:1}),c(m(Y),{name:"入参"},{default:u((()=>[c(p,{value:o.value,"onUpdate:value":[e[2]||(e[2]=a=>o.value=a),i]},null,8,["value"])])),_:1})])),_:1}),c(m(y),{"title-placement":"left"},{default:u((()=>[h(" 输出 ")])),_:1}),c(p,{value:x.value,"onUpdate:value":[e[3]||(e[3]=a=>x.value=a),r],class:"content",disable:!0},null,8,["value"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-a8910412"]]),M={class:"rest-detail"},Q=r(a({__name:"History",setup(a){const t=e([]),s=async()=>{try{const a=await(async()=>F.get({url:"/dataset/script/"}))();200===a.status&&(t.value=a.data)}catch(a){w.log(a||a.message)}};return x((async()=>{await s()})),(a,e)=>(l(),n(m(g),{title:"脚本",size:"small"},{default:u((()=>[c(m(H),{placeholder:"请输入搜索条件"}),c(m(P),null,{default:u((()=>[c(m(Y),{name:"脚本列表"},{default:u((()=>[c(m($),{"align-text":""},{default:u((()=>[(l(!0),C(S,null,k(t.value,(a=>(l(),n(m(q),{key:a.id,class:"data-item",onClick:e=>{return t=a.id,void N.emit(f.SRCIPT_KEY,t);var t}},{default:u((()=>[d("div",M,[d("div",null,[c(m(A),{type:"success",style:{"font-weight":"800"}},{default:u((()=>[h(i("JS"))])),_:1}),h(" "+i(a.name),1)])])])),_:2},1032,["onClick"])))),128))])),_:1})])),_:1})])),_:1})])),_:1}))}}),[["__scopeId","data-v-a5c9f2ec"]]),aa=r(a({__name:"Scripts",setup(a){const t=e(!1),s=e(0),d=e(0),o=j((()=>({width:s.value+"px",height:d.value+"px"}))),i=a=>{const{width:e,height:t}=a.contentRect;s.value=e,d.value=t};return(a,e)=>{const s=E("resize");return l(),n(m(J),{class:"home"},{default:u((()=>[c(m(I),{class:"header"},{default:u((()=>[c(m(Z))])),_:1}),c(m(J),{"has-sider":"","sider-placement":"right",class:"main"},{default:u((()=>[O((l(),n(m(U),{class:"content"},{default:u((()=>[c(m(D),{"x-scrollable":"",style:T(o.value)},{default:u((()=>[c(B)])),_:1},8,["style"])])),_:1})),[[s,i]]),c(m(z),{class:"right",width:"240",collapsed:t.value,"native-scrollbar":!1,bordered:"","collapsed-width":35,"collapse-mode":"width","show-trigger":"arrow-circle",onCollapse:e[0]||(e[0]=a=>t.value=!0),onExpand:e[1]||(e[1]=a=>t.value=!1)},{default:u((()=>[c(Q)])),_:1},8,["collapsed"])])),_:1})])),_:1})}}}),[["__scopeId","data-v-15420552"]]);export{aa as default};
