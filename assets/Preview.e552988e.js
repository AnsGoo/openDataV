var W=Object.defineProperty,x=Object.defineProperties;var B=Object.getOwnPropertyDescriptors;var S=Object.getOwnPropertySymbols;var z=Object.prototype.hasOwnProperty,F=Object.prototype.propertyIsEnumerable;var f=(a,o,e)=>o in a?W(a,o,{enumerable:!0,configurable:!0,writable:!0,value:e}):a[o]=e,h=(a,o)=>{for(var e in o||(o={}))z.call(o,e)&&f(a,e,o[e]);if(S)for(var e of S(o))F.call(o,e)&&f(a,e,o[e]);return a},w=(a,o)=>x(a,B(o));var y=(a,o,e)=>new Promise((m,p)=>{var n=s=>{try{i(e.next(s))}catch(t){p(t)}},l=s=>{try{i(e.throw(s))}catch(t){p(t)}},i=s=>s.done?m(s.value):Promise.resolve(s.value).then(n,l);i((e=e.apply(a,o)).next())});import{C as L}from"./ComponentWrapper.4873f1f2.js";import{_ as O,t as P,u as A,f as C,n as v,D as I,p as N}from"./index.395efaf1.js";import{d as R,k as b,r as T,e as j,y as q,O as _,X as k,F as G,_ as H,P as J,G as D,R as M}from"./@vue.a2815691.js";import"./vue-router.c997c3e8.js";import"./pinia.6e1173f7.js";import"./vue-demi.b3a9cad9.js";import"./mitt.550594b0.js";import"./naive-ui.6ffd8c7f.js";import"./date-fns.3c009aaa.js";import"./axios.744bc20e.js";import"./seemly.50a99b79.js";import"./vueuc.e50d3fb2.js";import"./evtd.9eee5233.js";import"./@css-render.8efa119b.js";import"./vooks.5c35c0ee.js";import"./vdirs.9c42edfb.js";import"./@juggle.37ed2144.js";import"./css-render.d5050412.js";import"./@emotion.6322e2ae.js";import"./treemate.80cdf2c2.js";import"./date-fns-tz.851ed5df.js";import"./async-validator.fb49d0f5.js";import"./lodash-es.5f1bdab1.js";import"./dexie.78e6a997.js";import"./nprogress.5b68415b.js";import"./@icon-park.b1426ebe.js";const U=R({__name:"Preview",setup(a){const o=P(),e=A(),m=[],p=b(()=>e.componentData),n=T({width:0,height:0,scale:0,dataWs:"",image:"/images/bg.jpg"}),l=b(()=>{const t=w(h({},n.value),{backgroundImage:n.value.image,backgroundSize:"cover"});return C(t,["width","height","backgroundImage","backgroundSize"])});j(()=>y(this,null,function*(){const t=yield o.undo();t&&e.setLayoutData({canvasData:t.canvasData,canvasStyle:t.canvasStyle}),n.value=e.canvasStyleData,n.value.dataWs&&m.push(i("actual",n.value.dataWs)),s(),window.addEventListener("resize",s)}));const i=(t,u)=>{const r=new WebSocket(u);return r.onopen=()=>{console.log("websocket\u8FDE\u63A5\u6210\u529F")},r.onclose=()=>{console.log("websocket\u8FDE\u63A5\u88AB\u5173\u95ED")},r.onmessage=d=>{const c=JSON.parse(d.data);v.emit(t,c),I.forEach((E,g)=>{E.isRegExp?new RegExp(t).test(c.TagName)&&v.emit(g,c):g===c.TagName&&v.emit(g,c)})},r};q(()=>{window.removeEventListener("resize",s),m.forEach(t=>{console.log("\u5173\u95EDwebsocket"),t.close()})});const s=()=>{const t=document.querySelector(".screen");if(t){const u=n.value.width,r=n.value.height;N(t,u,r)}};return(t,u)=>(_(),k("div",{class:"bg",style:M(D(l))},[(_(!0),k(G,null,H(D(p),(r,d)=>(_(),J(L,{key:d,component:r},null,8,["component"]))),128))],4))}});var ye=O(U,[["__scopeId","data-v-c2cd97e0"]]);export{ye as default};
