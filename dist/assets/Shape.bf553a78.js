var gt=Object.defineProperty;var U=Object.getOwnPropertySymbols;var _t=Object.prototype.hasOwnProperty,wt=Object.prototype.propertyIsEnumerable;var V=(t,n,e)=>n in t?gt(t,n,{enumerable:!0,configurable:!0,writable:!0,value:e}):t[n]=e,R=(t,n)=>{for(var e in n||(n={}))_t.call(n,e)&&V(t,e,n[e]);if(U)for(var e of U(n))wt.call(n,e)&&V(t,e,n[e]);return t};import{q as j,I as tt,J as Q,K as Dt,L as bt,M,N as et,O as $,P as nt,Q as St,h as zt,R as m,d as Lt,i as O,r as P,S as Et,a as Pt,T as kt,w as T,U as A,V as Z,W as X,X as It,z as H,F as Rt,Y as N,f as Mt}from"./index.56a9069f.js";import{e as At}from"./useEventBus.22ed4fd9.js";const C=j(),Yt=tt({id:"compose",state:()=>({style:{top:0,left:0,width:0,height:0},components:[]}),getters:{canCompose(){return this.components.length>1}},actions:{isActived(t){return this.components.findIndex(n=>n.id===t.id)!==-1},setAreaData(t,n){this.style=t||{},this.components=n||[]},appendComponent(t){this.components.findIndex(n=>n.id===t.id)===-1&&(this.components.push(t),this.components.length>1&&(this.style=R(R({},this.style),Q(this.components))))},compose(){this.style.width===0&&(this.style=R(R({},this.style),Q(this.components)));const t=Dt.Group,n=new t;for(const s in this.style)n.change(s,this.style[s]);n.addComponent(this.components,!0),bt(n),this.batchDeleteComponent(this.components),C.appendComponent(n);const e=C.componentData.length-1;C.setCurComponent(C.componentData[e],e.toString()),this.components=[]},batchDeleteComponent(t){t.forEach(n=>{for(let e=0,s=C.componentData.length;e<s;e++)if(n.id===C.componentData[e].id){C.componentData.splice(e,1);break}})},flushRight(){const{right:t,items:n}=M(this.components);n.forEach(e=>{const s=t-e.right;e.component.change("left",e.component.positionStyle.left+s)}),C.saveComponentData()},flushLeft(){const{left:t,items:n}=M(this.components);n.forEach(e=>{const s=e.left-t;e.component.change("left",e.component.positionStyle.left-s)}),C.saveComponentData()},flushTop(){const{top:t,items:n}=M(this.components);n.forEach(e=>{const s=e.top-t;e.component.change("top",e.component.positionStyle.top-s)}),C.saveComponentData()},flushBottom(){const{bottom:t,items:n}=M(this.components);n.forEach(e=>{const s=t-e.bottom;e.component.change("top",e.component.positionStyle.top+s)}),C.saveComponentData()},flushRow(){const{top:t,bottom:n,items:e}=M(this.components);e.forEach(s=>{const c=(n+t)/2-s.center.y;s.component.change("top",s.component.positionStyle.top+c)}),C.saveComponentData()},flushColumn(){const{left:t,right:n,items:e}=M(this.components);e.forEach(s=>{const c=(t+n)/2-s.center.x;s.component.change("left",s.component.positionStyle.left+c)}),C.saveComponentData()}}}),Tt=()=>Yt(et),Xt=tt({id:"copy",state:()=>({copyData:void 0,isCut:!1}),actions:{copy(t){this.copyData=$(t),this.copyData.parent=void 0,this.copyData.groupStyle=void 0,nt(JSON.stringify(this.copyData.toJson()))},paste(t,n,e){if(!this.copyData){St.info("\u8BF7\u9009\u62E9\u7EC4\u4EF6");return}const s=j();t?(this.copyData.change("top",e),this.copyData.change("left",n)):(this.copyData.change("top",this.copyData.style.top+10),this.copyData.change("left",this.copyData.style.left+10));const c=$(this.copyData);c.id=zt(),s.appendComponent(c)}}});function Bt(){return Xt(et)}const Wt={lt:Ot,t:Ft,rt:Jt,r:Gt,rb:qt,b:jt,lb:Nt,l:Ht};function L(t){const{top:n,left:e,height:s,width:c}=t;return{y:n+s/2,x:e+c/2}}function ot(t,n,e){return t*(e-n.x)+n.y}function st(t,n,e){return n.x-(n.y-e)/t}function Ot(t,n){const{top:e,left:s,rotate:c,width:u,height:d}=t,h=L(t),l={x:s+u,y:e+d},i=m(l,h,c),a={x:(i.x+n.x)/2,y:(i.y+n.y)/2},f=m(n,a,-c),y=m(i,a,-c),x=y.y-f.y,g=y.x-f.x;return{top:f.y,left:f.x,width:g,height:x}}function Ht(t,n){const{left:e,rotate:s,width:c,height:u,top:d}=t,h=L(t),l={x:e+c,y:d+u/2},i=m(l,h,s);if(s%180!=90){const g=(h.y-i.y)/(h.x-i.x),E=ot(g,h,n.x);n.y=E}else n.x=h.x;const a={x:(i.x+n.x)/2,y:(i.y+n.y)/2},f=m(n,a,-s),x=m(i,a,-s).x-f.x;return{top:a.y-u/2,left:f.x,width:x,height:u}}function Nt(t,n){const{top:e,left:s,rotate:c,width:u}=t,d=L(t),h={x:s+u,y:e},l=m(h,d,c),i={x:(l.x+n.x)/2,y:(l.y+n.y)/2},a=m(n,i,-c),f=m(l,i,-c),y=a.y-f.y,x=f.x-a.x;return{top:a.y-y,left:a.x,width:x,height:y}}function jt(t,n){const{top:e,left:s,rotate:c,width:u}=t,d=L(t),h={x:s+u/2,y:e},l=m(h,d,c);if(c%180!=90){const x=(d.y-l.y)/(d.x-l.x),g=st(x,d,n.y);n.x=g}else n.y=d.y;const i={x:(l.x+n.x)/2,y:(l.y+n.y)/2},a=m(n,i,-c),f=m(l,i,-c),y=a.y-f.y;return{top:a.y-y,left:i.x-u/2,width:u,height:y}}function Ft(t,n){const{top:e,left:s,rotate:c,width:u,height:d}=t,h=L(t),l={x:s+u/2,y:e+d},i=m(l,h,c);if(c%180!=90){const g=(h.y-i.y)/(h.x-i.x),E=st(g,h,n.y);n.x=E}else n.y=h.y;const a={x:(i.x+n.x)/2,y:(i.y+n.y)/2},f=m(n,a,-c),x=m(i,a,-c).y-f.y;return{top:f.y,left:a.x-u/2,width:u,height:x}}function Jt(t,n){const{top:e,left:s,rotate:c,height:u}=t,d=L(t),h={x:s,y:e+u},l=m(h,d,c),i={x:(l.x+n.x)/2,y:(l.y+n.y)/2},a=m(n,i,-c),f=m(l,i,-c),y=f.y-a.y,x=a.x-f.x;return{top:a.y,left:f.x,width:x,height:y}}function qt(t,n){const{top:e,left:s,rotate:c}=t,u=L(t),h=m({x:s,y:e},u,c),l={x:(h.x+n.x)/2,y:(h.y+n.y)/2},i=m(n,l,-c),a=m(h,l,-c),f=i.y-a.y,y=i.x-a.x;return{top:a.y,left:a.x,width:y,height:f}}function Gt(t,n){const{top:e,left:s,rotate:c,height:u}=t,d=L(t),h={x:s,y:e+u/2},l=m(h,d,c);if(c%180!=90){const x=(d.y-l.y)/(d.x-l.x),g=ot(x,d,n.x);n.y=g}else n.x=d.x;const i={x:(l.x+n.x)/2,y:(l.y+n.y)/2},a=m(n,i,-c),f=m(l,i,-c),y=a.x-f.x;return{top:f.y-u/2,left:f.x,width:y,height:u}}function Kt(t,n,e){const{top:s,left:c,width:u,height:d}=Wt[t](n,e);return{top:Math.round(s),left:Math.round(c),width:Math.round(u),height:Math.round(d)}}const Ut="_shape_s93dy_1",Vt="_error-info_s93dy_7",Qt="_active_s93dy_12",$t="_shape-point_s93dy_16",Zt="_rotation_s93dy_21",te="_icon-jiesuo_s93dy_33",ee="_lt_s93dy_39",ne="_rotate-0_s93dy_39",oe="_rb_s93dy_40",se="_l_s93dy_39",re="_rotate-45_s93dy_41",ce="_r_s93dy_21",ie="_lb_s93dy_43",ae="_rotate-90_s93dy_43",le="_rt_s93dy_44",fe="_t_s93dy_45",ue="_rotate-135_s93dy_45",de="_b_s93dy_46",k={shape:Ut,"error-info":"_error-info_s93dy_7",errorInfo:Vt,active:Qt,"shape-point":"_shape-point_s93dy_16",shapePoint:$t,rotation:Zt,"icon-jiesuo":"_icon-jiesuo_s93dy_33",iconJiesuo:te,lt:ee,"rotate-0":"_rotate-0_s93dy_39",rotate0:ne,rb:oe,l:se,"rotate-45":"_rotate-45_s93dy_41",rotate45:re,r:ce,lb:ie,"rotate-90":"_rotate-90_s93dy_43",rotate90:ae,rt:le,t:fe,"rotate-135":"_rotate-135_s93dy_45",rotate135:ue,b:de},ye=Lt({props:{active:{type:Boolean,default:!1},isInner:{type:Boolean,default:!1},info:Object,defaultStyle:Object,index:Number},setup(t,{slots:n}){const e=j(),s=Tt(),c=Bt(),u=()=>{c.copy(e.curComponent)},d=()=>{e.removeComponent(t.index,t.info.parent)},h=()=>{e.upComponent(t.index,t.info.parent)},l=()=>{e.downComponent(t.index,t.info.parent)},i=()=>{e.topComponent(t.index,t.info.parent)},a=()=>{const o=e.curComponent.id;nt(o)},f=()=>{e.bottomComponent(t.index,t.info.parent)},y=()=>{e.decompose()},x=(o,r)=>{var p;if(e.curComponent&&e.curComponent.id===t.info.id)r.stopPropagation();else if(!e.curComponent&&!t.info.parent)e.setCurComponent(t.info,t.index.toString()),r.stopPropagation();else return;return[{text:"\u62C6\u5206",subText:"",disable:((p=e.curComponent)==null?void 0:p.component)!=="Group",handler:y},{divider:!0},{text:"\u590D\u5236",subText:"Ctrl + C",handler:u},{text:"\u590D\u5236ID",subText:"",handler:a},{text:"\u5220\u9664",subText:"Ctr + Delete",handler:d},{divider:!0},{text:"\u7F6E\u4E8E\u9876\u5C42",handler:i,children:[{text:"\u7F6E\u4E8E\u9876\u5C42",handler:i},{text:"\u4E0A\u79FB\u4E00\u5C42",handler:h}]},{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:f,children:[{text:"\u7F6E\u4E8E\u5E95\u5C42",handler:f},{text:"\u4E0B\u79FB\u4E00\u5C42",handler:l}]}]},g=O(()=>e.isShowEm),E=P(null),F=P({}),rt=P("0px"),ct=P("#fff0"),it=P("none"),J=P(!1),B=P("");Et((o,r,p)=>{if(console.log(o),p==="render function"){if(e.isEditMode){if(r){const{name:_}=r.component||{};B.value=`\u7EC4\u4EF6[${_}]\u6E32\u67D3\u5F02\u5E38`}else B.value="\u7EC4\u4EF6\u6E32\u67D3\u5F02\u5E38";rt.value="5px",ct.value="red",it.value="dashed",J.value=!0}return!1}else return!0});const W=O(()=>t.active&&!t.info.locked||s.isActived(t.info)),at=()=>{s.appendComponent(t.info)},lt=o=>{if(o.preventDefault(),t.info.parent||o.stopPropagation(),!e.curComponent||t.info.id!==e.curComponent.id||t.info.locked)return;o.stopPropagation(),F.value=q();let{top:r,left:p}=t.defaultStyle;const _=o.clientY,S=o.clientX,b=r,w=p,v=N(D=>{const I=D.clientX;r=(D.clientY-_)/e.scale+b,p=(I-S)/e.scale+w,e.syncComponentLoction({top:r,left:p},t.info.parent,!1)}),z=()=>{At.emit("unmove"),document.removeEventListener("mousemove",v),document.removeEventListener("mouseup",z),t.info&&t.info.parent&&e.resizeAutoComponent(t.info.parent),e.saveComponentData()};document.addEventListener("mousemove",v),document.addEventListener("mouseup",z)},ft=o=>{var r,p;if(o.ctrlKey){at();return}o.preventDefault(),t.isInner?((r=t.info.parent)==null?void 0:r.id)===((p=e.benchmarkComponent)==null?void 0:p.id)&&(o.stopPropagation(),e.setCurComponent(t.info,t.index.toString())):(o.stopPropagation(),e.setCurComponent(t.info,t.index.toString()))},ut=o=>{var r;!t.isInner||(o.preventDefault(),t.info&&(!t.info.parent||((r=t.info.parent)==null?void 0:r.active))&&(o.stopPropagation(),e.setCurComponent(t.info,t.index.toString())))},dt=(o,r)=>{if(r.button!==0||!(e.curComponent&&t.info.id===e.curComponent.id))return;r.stopPropagation(),r.preventDefault();const p={top:t.defaultStyle.top,left:t.defaultStyle.left,height:t.defaultStyle.height,width:t.defaultStyle.width,rotate:t.defaultStyle.rotate},_=document.querySelector("#editor").getBoundingClientRect(),S=N(w=>{const v={x:(w.clientX-_.left)/e.scale,y:(w.clientY-_.top)/e.scale},{top:z,left:D,width:I,height:Y}=Kt(o,p,v);e.syncComponentLoction({top:z,left:D,width:I,height:Y},t.info.parent,!1)}),b=()=>{document.removeEventListener("mousemove",S),document.removeEventListener("mouseup",b),t.info&&e.resizeAutoComponent(t.info.parent),e.saveComponentData()};document.addEventListener("mousemove",S),document.addEventListener("mouseup",b)},ht=o=>{if(o.button!==0||!E.value||(o.preventDefault(),o.stopPropagation(),!(e.curComponent&&t.info.id===e.curComponent.id))||t.info.locked)return;let{rotate:r}=R({},t.defaultStyle);const p=o.clientY,_=o.clientX,S=r,b=E.value.getBoundingClientRect(),w=b.left+b.width/2,v=b.top+b.height/2,z=Math.atan2(p-v,_-w)/(Math.PI/180),D=N(Y=>{const xt=Y.clientX,Ct=Y.clientY,vt=Math.atan2(Ct-v,xt-w)/(Math.PI/180);r=S+vt-z,e.syncComponentLoction({rotate:r},t.info.parent,!1)}),I=()=>{document.removeEventListener("mousemove",D),document.removeEventListener("mouseup",I),t.info&&e.resizeAutoComponent(t.info.parent),e.saveComponentData()};document.addEventListener("mousemove",D),document.addEventListener("mouseup",I)},q=()=>{if(!e.curComponent)return{};const o=Z(e.curComponent.style.rotate),r={};let p=-1;const _=[{start:338,end:23,cursor:"nw"},{start:23,end:68,cursor:"n"},{start:68,end:113,cursor:"ne"},{start:113,end:158,cursor:"e"},{start:158,end:203,cursor:"se"},{start:203,end:248,cursor:"s"},{start:248,end:293,cursor:"sw"},{start:293,end:338,cursor:"w"}],S={lt:0,t:45,rt:90,r:135,rb:180,b:225,lb:270,l:315};return["lt","t","rt","r","rb","b","lb","l"].forEach(w=>{const v=Z(S[w]+o),z=_.length;for(;;){p=(p+1)%z;const D=_[p];if(v<23||v>=338){r[w]="nw-resize";return}if(D.start<=v&&v<D.end){r[w]=D.cursor+"-resize";return}}}),r},mt=O(()=>{const o="rotate-",r=t.defaultStyle.rotate;return r>-22.5&&r<=22.5?o+0:r>22.5&&r<=67.5?o+45:r>67.5&&r<=112.5?o+90:r>112.5&&r<=157.5?o+135:r>157.5||r<=-157.5?o+0:r>-157.5&&r<=-112.5?o+45:r>-112.5&&r<=-67.5?o+90:r>-67.5&&r<=-22.5?o+135:o+0}),G=o=>{if(document.addEventListener("keyup",K),!!(e.curComponent&&t.info.id===e.curComponent.id)&&(o.stopPropagation(),t.info&&o.ctrlKey))switch(o.key){case"ArrowLeft":o.preventDefault(),e.syncComponentLoction({left:t.info.positionStyle.left-1},t.info.parent,!1);break;case"ArrowUp":o.preventDefault(),e.syncComponentLoction({top:t.info.positionStyle.top-1},t.info.parent,!1);break;case"ArrowRight":o.preventDefault(),e.syncComponentLoction({left:t.info.positionStyle.left+1},t.info.parent,!1);break;case"ArrowDown":o.preventDefault(),e.syncComponentLoction({top:t.info.positionStyle.top+1},t.info.parent,!1);break;case"Delete":o.preventDefault(),d();break;default:return}},K=o=>{!(e.curComponent&&t.info.id===e.curComponent.id)||(o.stopPropagation(),t.info&&e.resizeAutoComponent(t.info.parent),e.saveComponentData(),document.removeEventListener("keyup",K))};Pt(()=>{F.value=q()}),kt(()=>e.curComponent,o=>{o&&t.info.id===o.id?document.addEventListener("keydown",G):document.removeEventListener("keydown",G)});const pt=[{top:"0%",left:"0%",direction:"lt"},{top:"0%",left:"50%",direction:"t"},{top:"0%",left:"100%",direction:"rt"},{top:"50%",left:"100%",direction:"r"},{top:"100%",left:"100%",direction:"rb"},{top:"100%",left:"50%",direction:"b"},{top:"100%",left:"0%",direction:"lb"},{top:"50%",left:"0%",direction:"l"}],yt=()=>A(Rt,null,[T(A("span",{class:k.errorInfo},[B.value]),[[X,J.value]]),T(A(It,{class:k.rotation,name:"one-third-rotation",onMousedown:ht},null),[[X,W.value]]),T(A("em",null,[H("("),t.defaultStyle.left,H(","),t.defaultStyle.top,H(")")]),[[X,g.value]]),pt.map(o=>T(A("div",{class:[k.shapePoint,k[o.direction],k[mt.value]],style:{top:o.top,left:o.left},onMousedown:r=>dt(o.direction,r)},null),[[X,W.value]])),n.default&&n.default()]);return()=>T(A("div",{ref:E,class:[k.shape,W.value||t.active?k.active:""],onDblclick:o=>ut(o),onClick:o=>ft(o),onMousedown:o=>lt(o)},[yt()]),[[Mt("contextmenu"),(o,r)=>x(o,r)]])}});export{ye as S,Tt as a,Bt as u};
